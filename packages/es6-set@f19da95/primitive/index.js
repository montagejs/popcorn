"use strict";var callable=require("es5-ext/object/valid-callable"),clear=require("es5-ext/object/clear"),setPrototypeOf=require("es5-ext/object/set-prototype-of"),d=require("d"),iterator=require("es6-iterator/valid-iterable"),forOf=require("es6-iterator/for-of"),Set=require("../polyfill"),Iterator=require("../lib/primitive-iterator"),isNative=require("../is-native-implemented"),create=Object.create,defineProperties=Object.defineProperties,defineProperty=Object.defineProperty,getPrototypeOf=Object.getPrototypeOf,hasOwnProperty=Object.prototype.hasOwnProperty,PrimitiveSet;module.exports=PrimitiveSet=function(){var e,t=arguments[0],r=arguments[1];if(!(this instanceof PrimitiveSet))throw new TypeError("Constructor requires 'new'");return e=isNative&&setPrototypeOf?setPrototypeOf(new Set,getPrototypeOf(this)):this,null!=t&&iterator(t),void 0!==r&&(callable(r),defineProperty(e,"_serialize",d("",r))),defineProperties(e,{__setData__:d("c",create(null)),__size__:d("w",0)}),t?(forOf(t,function(t){var r=e._serialize(t);if(null==r)throw new TypeError(t+" cannot be serialized");hasOwnProperty.call(e.__setData__,r)||(e.__setData__[r]=t,++e.__size__)}),e):e},setPrototypeOf&&setPrototypeOf(PrimitiveSet,Set),PrimitiveSet.prototype=create(Set.prototype,{constructor:d(PrimitiveSet),_serialize:d(function(e){return e&&"function"!=typeof e.toString?null:String(e)}),add:d(function(e){var t=this._serialize(e);if(null==t)throw new TypeError(e+" cannot be serialized");return hasOwnProperty.call(this.__setData__,t)?this:(this.__setData__[t]=e,++this.__size__,this.emit("_add",t),this)}),clear:d(function(){this.__size__&&(clear(this.__setData__),this.__size__=0,this.emit("_clear"))}),"delete":d(function(e){var t=this._serialize(e);return null!=t&&(!!hasOwnProperty.call(this.__setData__,t)&&(delete this.__setData__[t],--this.__size__,this.emit("_delete",t),!0))}),entries:d(function(){return new Iterator(this,"key+value")}),get:d(function(e){if(e=this._serialize(e),null!=e)return this.__setData__[e]}),has:d(function(e){var t=this._serialize(e);return null!=t&&hasOwnProperty.call(this.__setData__,t)}),size:d.gs(function(){return this.__size__}),values:d(function(){return new Iterator(this)})});