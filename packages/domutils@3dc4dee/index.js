function getChildren(t){return t.children}function getParent(t){return t.parent}function getSiblings(t){var e=getParent(t);return e?getChildren(e):[t]}function getAttributeValue(t,e){return t.attribs&&t.attribs[e]}function hasAttrib(t,e){return hasOwnProperty.call(t.attribs,e)}function getName(t){return t.name}function find(t,e,n,r){for(var i,a=[],l=0,o=e.length;l<o&&!(t(e[l])&&(a.push(e[l]),--r<=0))&&(i=getChildren(e[l]),!(n&&i&&i.length>0&&(i=find(t,i,n,r),a=a.concat(i),r-=i.length,r<=0)));l++);return a}function findOneChild(t,e){for(var n=0,r=e.length;n<r;n++)if(t(e[n]))return e[n];return null}function findOne(t,e){for(var n=null,r=0,i=e.length;r<i&&!n;r++)t(e[r])?n=e[r]:e[r].children&&e[r].children.length>0&&(n=findOne(t,e[r].children));return n}function findAll(t,e){for(var n=[],r=0,i=e.length;r<i;r++){t(e[r])&&n.push(e[r]);var a=getChildren(e[r]);a&&a.length&&(n=n.concat(findAll(t,a)))}return n}function filter(t,e,n,r){return Array.isArray(e)||(e=[e]),"number"==typeof r&&isFinite(r)?1===r?(e=n===!1?findOneChild(t,e):findOne(t,e),e?[e]:[]):find(t,e,n!==!1,r):n===!1?e.filter(t):findAll(t,e)}function getAttribCheck(t,e){return"function"==typeof e?function(n){return n.attribs&&e(n.attribs[t])}:function(n){return n.attribs&&n.attribs[t]===e}}var ElementType=require("domelementtype"),DomUtils=module.exports,isTag=DomUtils.isTag=ElementType.isTag;DomUtils.getChildren=getChildren,DomUtils.getParent=getParent,DomUtils.getAttributeValue=getAttributeValue,DomUtils.hasAttrib=hasAttrib,DomUtils.getName=getName,DomUtils.getSiblings=getSiblings,DomUtils.findOne=findOne,DomUtils.findAll=findAll,DomUtils.filter=filter,DomUtils.testElement=function(t,e){for(var n in t)if(t.hasOwnProperty(n)){if("tag_name"===n){if(!isTag(e)||!t.tag_name(e.name))return!1}else if("tag_type"===n){if(!t.tag_type(e.type))return!1}else if("tag_contains"===n){if(isTag(e)||!t.tag_contains(e.data))return!1}else if(!e.attribs||!t[n](e.attribs[n]))return!1}else;return!0};var Checks={tag_name:function(t){return"function"==typeof t?function(e){return isTag(e)&&t(e.name)}:"*"===t?isTag:function(e){return isTag(e)&&e.name===t}},tag_type:function(t){return"function"==typeof t?function(e){return t(e.type)}:function(e){return e.type===t}},tag_contains:function(t){return"function"==typeof type?function(e){return!isTag(e)&&t(e.data)}:function(e){return!isTag(e)&&e.data===t}}};DomUtils.getElements=function(t,e,n,r){var i=[];for(var a in t)t.hasOwnProperty(a)&&(a in Checks?i.push(Checks[a](t[a])):i.push(getAttribCheck(a,t[a])));return 0===i.length?[]:1===i.length?filter(i[0],e,n,r):filter(function(t){return i.some(function(e){return e(t)})},e,n,r)},DomUtils.getElementById=function(t,e,n){return Array.isArray(e)||(e=[e]),findOne(getAttribCheck("id",t),e,n!==!1)},DomUtils.getElementsByTagName=function(t,e,n,r){return filter(Checks.tag_name(t),e,n,r)},DomUtils.getElementsByTagType=function(t,e,n,r){return filter(Checks.tag_type(t),e,n,r)},DomUtils.removeElement=function(t){if(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.parent){var e=t.parent.children;e.splice(e.lastIndexOf(t),1)}},DomUtils.replaceElement=function(t,e){if(t.prev&&(t.prev.next=e,e.prev=t.prev),t.next&&(t.next.prev=e,e.next=t.next),t.parent){var n=t.parent.children;n.splice(n.lastIndexOf(t),1,e),e.parent=t.parent}},DomUtils.getInnerHTML=function(t){if(!t.children)return"";for(var e=t.children,n=e.length,r="",i=0;i<n;i++)r+=DomUtils.getOuterHTML(e[i]);return r};var booleanAttribs={__proto__:null,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,defer:!0,disabled:!0,hidden:!0,loop:!0,multiple:!0,open:!0,readonly:!0,required:!0,scoped:!0,selected:!0,"/":!0},emptyTags={__proto__:null,area:!0,base:!0,basefont:!0,br:!0,col:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,link:!0,meta:!0,param:!0,embed:!0};DomUtils.getOuterHTML=function(t){var e=t.type;if(e===ElementType.Text)return t.data;if(e===ElementType.Comment)return"<!--"+t.data+"-->";if(e===ElementType.Directive)return"<"+t.data+">";if(e===ElementType.CDATA)return"<!CDATA "+DomUtils.getInnerHTML(t)+"]]>";var n="<"+t.name;if("attribs"in t)for(var r in t.attribs)if(t.attribs.hasOwnProperty(r)){n+=" "+r;var i=t.attribs[r];i?n+='="'+i+'"':r in booleanAttribs||(n+='=""')}return t.name in emptyTags&&0===t.children.length?n+" />":n+">"+DomUtils.getInnerHTML(t)+"</"+t.name+">"},DomUtils.getText=function t(e){return Array.isArray(e)?e.map(t).join(""):isTag(e)||e.type===ElementType.CDATA?t(e.children):e.type===ElementType.Text?e.data:""};