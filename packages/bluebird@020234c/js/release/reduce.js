"use strict";module.exports=function(e,t,i,a,n,l){function s(t,i,a,l){this.constructor$(t);var s=h();this._fn=null===s?i:_.domainBind(s,i),void 0!==a&&(a=e.resolve(a),a._attachCancellationCallback(this)),this._initialValue=a,this._currentCancellable=null,l===n?this._eachValues=Array(this._length):0===l?this._eachValues=null:this._eachValues=void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function o(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function r(e,t,a,n){if("function"!=typeof t)return i("expecting a function but got "+_.classString(t));var l=new s(e,t,a,n);return l.promise()}function u(t){this.accum=t,this.array._gotAccum(t);var i=a(this.value,this.array._promise);return i instanceof e?(this.array._currentCancellable=i,i._then(c,void 0,void 0,this,void 0)):c.call(this,i)}function c(t){var i=this.array,a=i._promise,n=v(i._fn);a._pushContext();var s;s=void 0!==i._eachValues?n.call(a._boundValue(),t,this.index,this.length):n.call(a._boundValue(),this.accum,t,this.index,this.length),s instanceof e&&(i._currentCancellable=s);var o=a._popContext();return l.checkForgottenReturns(s,o,void 0!==i._eachValues?"Promise.each":"Promise.reduce",a),s}var h=e._getDomain,_=require("./util"),v=_.tryCatch;_.inherits(s,t),s.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==n&&this._eachValues.push(e)},s.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},s.prototype._resultCancelled=function(t){return t===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel()))},s.prototype._iterate=function(t){this._values=t;var i,a,n=t.length;if(void 0!==this._initialValue?(i=this._initialValue,a=0):(i=e.resolve(t[0]),a=1),this._currentCancellable=i,!i.isRejected())for(;a<n;++a){var l={accum:null,value:t[a],index:a,length:n,array:this};i=i._then(u,void 0,void 0,l,void 0)}void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0)),i._then(o,o,void 0,i,this)},e.prototype.reduce=function(e,t){return r(this,e,t,null)},e.reduce=function(e,t,i,a){return r(e,t,i,a)}};