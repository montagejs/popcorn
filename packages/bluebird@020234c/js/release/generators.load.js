montageDefine("020234c","js/release/generators",{dependencies:["./errors","./util"],factory:function(e,t,i){"use strict";i.exports=function(t,i,n,r,o,s){function a(e,i,n){for(var o=0;o<i.length;++o){n._pushContext();var s=p(i[o])(e);if(n._popContext(),s===h){n._pushContext();var a=t.reject(h.e);return n._popContext(),a}var l=r(s,n);if(l instanceof t)return l}return null}function l(e,i,r,o){if(s.cancellation()){var a=new t(n),l=this._finallyPromise=new t(n);this._promise=a.lastly(function(){return l}),a._captureStackTrace(),a._setOnCancel(this)}else{var c=this._promise=new t(n);c._captureStackTrace()}this._stack=o,this._generatorFunction=e,this._receiver=i,this._generator=void 0,this._yieldHandlers="function"==typeof r?[r].concat(f):f,this._yieldedPromise=null,this._cancellationPhase=!1}var c=e("./errors"),_=c.TypeError,u=e("./util"),h=u.errorObj,p=u.tryCatch,f=[];u.inherits(l,o),l.prototype._isResolved=function(){return null===this._promise},l.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},l.prototype._promiseCancelled=function(){if(!this._isResolved()){var e,i="undefined"!=typeof this._generator["return"];if(i)this._promise._pushContext(),e=p(this._generator["return"]).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=p(this._generator["throw"]).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},l.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=p(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=p(this._generator["throw"]).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},l.prototype._continue=function(e){var i=this._promise;if(e===h)return this._cleanup(),this._cancellationPhase?i.cancel():i._rejectCallback(e.e,!1);var n=e.value;if(e.done===!0)return this._cleanup(),this._cancellationPhase?i.cancel():i._resolveCallback(n);var o=r(n,this._promise);if(!(o instanceof t)&&(o=a(o,this._yieldHandlers,this._promise),null===o))return void this._promiseRejected(new _("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var s=o._bitField;0===(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!==(33554432&s)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!==(16777216&s)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()},t.coroutine=function(e,t){if("function"!=typeof e)throw new _("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(t).yieldHandler,n=l,r=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new n((void 0),(void 0),i,r),s=o.promise();return o._generator=t,o._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new _("expecting a function but got "+u.classString(e));f.push(e)},t.spawn=function(e){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return i("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new l(e,this),r=n.promise();return n._run(t.spawn),r}}}});