montageDefine("020234c","js/release/debuggability",{dependencies:["./errors","./util","./es5"],factory:function(t,e,n){"use strict";n.exports=function(e,n){function r(t,e){return{promise:e}}function o(){return!1}function a(t,e,n){var r=this;try{t(e,n,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+A.toString(t));r._attachCancellationCallback(t)})}catch(o){return o}}function i(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?A.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function c(){return this._onCancelField}function s(t){this._onCancelField=t}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function u(t,e){if(0!==(1&e)){this._cancellationParent=t;var n=t._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function f(t,e){0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function d(){var t=this._boundTo;return void 0!==t&&t instanceof e?t.isFulfilled()?t.value():void 0:t}function p(){this._trace=new L(this._peekContext())}function h(t,e){if(H(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var r=w(t);A.notEnumerableProp(t,"stack",r.message+"\n"+r.stack.join("\n")),A.notEnumerableProp(t,"__stackCleaned__",!0)}}}function v(){this._trace=void 0}function _(t,e,n,r,o){if(void 0===t&&null!==e&&J){if(void 0!==o&&o._returnedNonUndefined())return;if(0===(65535&r._bitField))return;n&&(n+=" ");var a="",i="";if(e._trace){for(var c=e._trace.stack.split("\n"),s=E(c),l=s.length-1;l>=0;--l){var u=s[l];if(!$.test(u)){var f=u.match(q);f&&(a="at "+f[1]+":"+f[2]+":"+f[3]+" ");break}}if(s.length>0)for(var d=s[0],l=0;l<c.length;++l)if(c[l]===d){l>0&&(i="\n"+c[l-1]);break}}var p="a promise was created in a "+n+"handler "+a+"but was not returned from it, see http://goo.gl/rRqMUw"+i;r._warn(p,!0,e)}}function g(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),y(n)}function y(t,n,r){if(ct.warnings){var o,a=new P(t);if(n)r._attachExtraTrace(a);else if(ct.longStackTraces&&(o=e._peekContext()))o.attachExtraTrace(a);else{var i=w(a);a.stack=i.message+"\n"+i.stack.join("\n")}nt("warning",a)||C(a,"",!0)}}function m(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}function k(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function b(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],o=e.length-1,a=e[o],i=-1,c=r.length-1;c>=0;--c)if(r[c]===a){i=c;break}for(var c=i;c>=0;--c){var s=r[c];if(e[o]!==s)break;e.pop(),o--}e=r}}function E(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],o="    (No stack trace)"===r||M.test(r),a=o&&ot(r);o&&!a&&(V&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function T(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||M.test(r))break}return n>0&&"SyntaxError"!=t.name&&(e=e.slice(n)),e}function w(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?T(t):["    (No stack trace)"],{message:n,stack:"SyntaxError"==t.name?e:E(e)}}function C(t,e,n){if("undefined"!=typeof console){var r;if(A.isObject(t)){var o=t.stack;r=e+Q(o,t)}else r=e+String(t);"function"==typeof D?D(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function R(t,e,n,r){var o=!1;try{"function"==typeof e&&(o=!0,"rejectionHandled"===t?e(r):e(n,r))}catch(a){O.throwLater(a)}"unhandledRejection"===t?nt(t,n,r)||o||C(n,"Unhandled rejection "):nt(t,r)}function S(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():A.toString(t);var n=/\[object [a-zA-Z0-9$_]+\]/;if(n.test(e))try{var r=JSON.stringify(t);e=r}catch(o){}0===e.length&&(e="(empty array)")}return"(<"+j(e)+">, no stack trace)"}function j(t){var e=41;return t.length<e?t:t.substr(0,e-3)+"..."}function U(){return"function"==typeof it}function F(t){var e=t.match(at);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function N(t,e){if(U()){for(var n,r,o=(t.stack||"").split("\n"),a=(e.stack||"").split("\n"),i=-1,c=-1,s=0;s<o.length;++s){var l=F(o[s]);if(l){n=l.fileName,i=l.line;break}}for(var s=0;s<a.length;++s){var l=F(a[s]);if(l){r=l.fileName,c=l.line;break}}i<0||c<0||!n||!r||n!==r||i>=c||(ot=function(t){if(W.test(t))return!0;var e=F(t);return!!(e&&e.fileName===n&&i<=e.line&&e.line<=c)})}}function L(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);it(this,L),e>32&&this.uncycle()}var B,I,D,x=e._getDomain,O=e._async,P=t("./errors").Warning,A=t("./util"),G=t("./es5"),H=A.canAttachTrace,W=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,$=/\((?:timers\.js):\d+:\d+\)/,q=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,M=null,Q=null,V=!1,K=!(0==A.env("BLUEBIRD_DEBUG")||!A.env("BLUEBIRD_DEBUG")&&"development"!==A.env("NODE_ENV")),X=!(0==A.env("BLUEBIRD_WARNINGS")||!K&&!A.env("BLUEBIRD_WARNINGS")),z=!(0==A.env("BLUEBIRD_LONG_STACK_TRACES")||!K&&!A.env("BLUEBIRD_LONG_STACK_TRACES")),J=0!=A.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(X||!!A.env("BLUEBIRD_W_FORGOTTEN_RETURN"));e.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=t._bitField&-1048577|524288},e.prototype._ensurePossibleRejectionHandled=function(){if(0===(524288&this._bitField)){this._setRejectionIsUnhandled();var t=this;setTimeout(function(){t._notifyUnhandledRejection()},1)}},e.prototype._notifyUnhandledRejectionIsHandled=function(){R("rejectionHandled",B,void 0,this)},e.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},e.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),R("unhandledRejection",I,t,this)}},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},e.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},e.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},e.prototype._warn=function(t,e,n){return y(t,e,n||this)},e.onPossiblyUnhandledRejection=function(t){var e=x();I="function"==typeof t?null===e?t:A.domainBind(e,t):void 0},e.onUnhandledRejectionHandled=function(t){var e=x();B="function"==typeof t?null===e?t:A.domainBind(e,t):void 0};var Y=function(){};e.longStackTraces=function(){if(O.haveItemsQueued()&&!ct.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!ct.longStackTraces&&U()){var t=e.prototype._captureStackTrace,r=e.prototype._attachExtraTrace,o=e.prototype._dereferenceTrace;ct.longStackTraces=!0,Y=function(){if(O.haveItemsQueued()&&!ct.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");e.prototype._captureStackTrace=t,e.prototype._attachExtraTrace=r,e.prototype._dereferenceTrace=o,n.deactivateLongStackTraces(),O.enableTrampoline(),ct.longStackTraces=!1},e.prototype._captureStackTrace=p,e.prototype._attachExtraTrace=h,e.prototype._dereferenceTrace=v,n.activateLongStackTraces(),O.disableTrampolineIfNecessary()}},e.hasLongStackTraces=function(){return ct.longStackTraces&&U()};var Z=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return A.global.dispatchEvent(t),function(t,e){var n={detail:e,cancelable:!0};G.defineProperty(n,"promise",{value:e.promise}),G.defineProperty(n,"reason",{value:e.reason});var r=new CustomEvent(t.toLowerCase(),n);return!A.global.dispatchEvent(r)}}if("function"==typeof Event){var t=new Event("CustomEvent");return A.global.dispatchEvent(t),function(t,e){var n=new Event(t.toLowerCase(),{cancelable:!0});return n.detail=e,G.defineProperty(n,"promise",{value:e.promise}),G.defineProperty(n,"reason",{value:e.reason}),!A.global.dispatchEvent(n)}}var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),A.global.dispatchEvent(t),function(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t.toLowerCase(),!1,!0,e),!A.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),tt=function(){return A.isNode?function(){return process.emit.apply(process,arguments)}:A.global?function(t){var e="on"+t.toLowerCase(),n=A.global[e];return!!n&&(n.apply(A.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),et={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:r},nt=function(t){var e=!1;try{e=tt.apply(null,arguments)}catch(n){O.throwLater(n),e=!0}var r=!1;try{r=Z(t,et[t].apply(null,arguments))}catch(n){O.throwLater(n),r=!0}return r||e};e.config=function(t){if(t=Object(t),"longStackTraces"in t&&(t.longStackTraces?e.longStackTraces():!t.longStackTraces&&e.hasLongStackTraces()&&Y()),"warnings"in t){var n=t.warnings;ct.warnings=!!n,J=ct.warnings,A.isObject(n)&&"wForgottenReturn"in n&&(J=!!n.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!ct.cancellation){if(O.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");e.prototype._clearCancellationData=l,e.prototype._propagateFrom=u,e.prototype._onCancel=c,e.prototype._setOnCancel=s,e.prototype._attachCancellationCallback=i,e.prototype._execute=a,rt=u,ct.cancellation=!0}return"monitoring"in t&&(t.monitoring&&!ct.monitoring?(ct.monitoring=!0,e.prototype._fireEvent=nt):!t.monitoring&&ct.monitoring&&(ct.monitoring=!1,e.prototype._fireEvent=o)),e},e.prototype._fireEvent=o,e.prototype._execute=function(t,e,n){try{t(e,n)}catch(r){return r}},e.prototype._onCancel=function(){},e.prototype._setOnCancel=function(t){},e.prototype._attachCancellationCallback=function(t){},e.prototype._captureStackTrace=function(){},e.prototype._attachExtraTrace=function(){},e.prototype._dereferenceTrace=function(){},e.prototype._clearCancellationData=function(){},e.prototype._propagateFrom=function(t,e){};var rt=f,ot=function(){return!1},at=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;A.inherits(L,Error),n.CapturedTrace=L,L.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],n={},r=0,o=this;void 0!==o;++r)e.push(o),o=o._parent;t=this._length=r;for(var r=t-1;r>=0;--r){var a=e[r].stack;void 0===n[a]&&(n[a]=r)}for(var r=0;r<t;++r){var i=e[r].stack,c=n[i];if(void 0!==c&&c!==r){c>0&&(e[c-1]._parent=void 0,e[c-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var s=r>0?e[r-1]:this;c<t-1?(s._parent=e[c+1],s._parent.uncycle(),s._length=s._parent._length+1):(s._parent=void 0,s._length=1);for(var l=s._length+1,u=r-2;u>=0;--u)e[u]._length=l,l++;return}}}},L.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=w(t),n=e.message,r=[e.stack],o=this;void 0!==o;)r.push(E(o.stack.split("\n"))),o=o._parent;b(r),k(r),A.notEnumerableProp(t,"stack",m(n,r)),A.notEnumerableProp(t,"__stackCleaned__",!0)}};var it=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():S(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,M=t,Q=e;var n=Error.captureStackTrace;return ot=function(t){return W.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return M=/@/,Q=e,V=!0,function(t){t.stack=(new Error).stack};var o;try{throw new Error}catch(a){o="stack"in a}return"stack"in r||!o||"number"!=typeof Error.stackTraceLimit?(Q=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?S(e):e.toString()},null):(M=t,Q=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(D=function(t){console.warn(t)},A.isNode&&process.stderr.isTTY?D=function(t,e){var n=e?"[33m":"[31m";console.warn(n+t+"[0m\n")}:A.isNode||"string"!=typeof(new Error).stack||(D=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var ct={warnings:X,longStackTraces:!1,cancellation:!1,monitoring:!1};return z&&e.longStackTraces(),{longStackTraces:function(){return ct.longStackTraces},warnings:function(){return ct.warnings},cancellation:function(){return ct.cancellation},monitoring:function(){return ct.monitoring},propagateFromFunction:function(){return rt},boundValueFunction:function(){return d},checkForgottenReturns:_,setBounds:N,warn:y,deprecated:g,CapturedTrace:L,fireDomEvent:Z,fireGlobalEvent:tt}}}});