"use strict";module.exports=function(t,n,e){function i(t){this.handle=t}function o(t){return clearTimeout(this.handle),t}function r(t){throw clearTimeout(this.handle),t}var a=require("./util"),c=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var u=function(t){return l(+this).thenReturn(t)},l=t.delay=function(o,r){var a,c;return void 0!==r?(a=t.resolve(r)._then(u,null,null,o,void 0),e.cancellation()&&r instanceof t&&a._setOnCancel(r)):(a=new t(n),c=setTimeout(function(){a._fulfill()},+o),e.cancellation()&&a._setOnCancel(new i(c)),a._captureStackTrace()),a._setAsyncGuaranteed(),a};t.prototype.delay=function(t){return l(t,this)};var s=function(t,n,e){var i;i="string"!=typeof n?n instanceof Error?n:new c("operation timed out"):new c(n),a.markAsOriginatingFromRejection(i),t._attachExtraTrace(i),t._reject(i),null!=e&&e.cancel()};t.prototype.timeout=function(t,n){t=+t;var a,c,u=new i(setTimeout(function(){a.isPending()&&s(a,n,c)},t));return e.cancellation()?(c=this.then(),a=c._then(o,r,void 0,u,void 0),a._setOnCancel(u)):a=this._then(o,r,void 0,u,void 0),a}};