montageDefine("020234c","js/release/reduce",{dependencies:["./util"],factory:function(e,t,i){"use strict";i.exports=function(t,i,n,a,l,s){function o(e,i,n,a){this.constructor$(e);var s=_();this._fn=null===s?i:v.domainBind(s,i),void 0!==n&&(n=t.resolve(n),n._attachCancellationCallback(this)),this._initialValue=n,this._currentCancellable=null,a===l?this._eachValues=Array(this._length):0===a?this._eachValues=null:this._eachValues=void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function r(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function c(e,t,i,a){if("function"!=typeof t)return n("expecting a function but got "+v.classString(t));var l=new o(e,t,i,a);return l.promise()}function u(e){this.accum=e,this.array._gotAccum(e);var i=a(this.value,this.array._promise);return i instanceof t?(this.array._currentCancellable=i,i._then(h,void 0,void 0,this,void 0)):h.call(this,i)}function h(e){var i=this.array,n=i._promise,a=d(i._fn);n._pushContext();var l;l=void 0!==i._eachValues?a.call(n._boundValue(),e,this.index,this.length):a.call(n._boundValue(),this.accum,e,this.index,this.length),l instanceof t&&(i._currentCancellable=l);var o=n._popContext();return s.checkForgottenReturns(l,o,void 0!==i._eachValues?"Promise.each":"Promise.reduce",n),l}var _=t._getDomain,v=e("./util"),d=v.tryCatch;v.inherits(o,i),o.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==l&&this._eachValues.push(e)},o.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},o.prototype._init=function(){},o.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},o.prototype.shouldCopyValues=function(){return!1},o.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},o.prototype._resultCancelled=function(e){return e===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))},o.prototype._iterate=function(e){this._values=e;var i,n,a=e.length;if(void 0!==this._initialValue?(i=this._initialValue,n=0):(i=t.resolve(e[0]),n=1),this._currentCancellable=i,!i.isRejected())for(;n<a;++n){var l={accum:null,value:e[n],index:n,length:a,array:this};i=i._then(u,void 0,void 0,l,void 0)}void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0)),i._then(r,r,void 0,i,this)},t.prototype.reduce=function(e,t){return c(this,e,t,null)},t.reduce=function(e,t,i,n){return c(e,t,i,n)}}}});