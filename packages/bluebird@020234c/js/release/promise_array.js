"use strict";module.exports=function(e,t,i,s,r){function n(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function o(i){var s=this._promise=new e(t);i instanceof e&&s._propagateFrom(i,3),s._setOnCancel(this),this._values=i,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var l=require("./util");l.isArray;return l.inherits(o,r),o.prototype.length=function(){return this._length},o.prototype.promise=function(){return this._promise},o.prototype._init=function a(t,r){var o=i(this._values,this._promise);if(o instanceof e){o=o._target();var u=o._bitField;if(this._values=o,0===(50397184&u))return this._promise._setAsyncGuaranteed(),o._then(a,this._reject,void 0,this,r);if(0===(33554432&u))return 0!==(16777216&u)?this._reject(o._reason()):this._cancel();o=o._value()}if(o=l.asArray(o),null===o){var _=s("expecting an array or an iterable object but got "+l.classString(o)).reason();return void this._promise._rejectCallback(_,!1)}return 0===o.length?void(r===-5?this._resolveEmptyArray():this._resolve(n(r))):void this._iterate(o)},o.prototype._iterate=function(t){var s=this.getActualLength(t.length);this._length=s,this._values=this.shouldCopyValues()?new Array(s):this._values;for(var r=this._promise,n=!1,o=null,l=0;l<s;++l){var a=i(t[l],r);a instanceof e?(a=a._target(),o=a._bitField):o=null,n?null!==o&&a.suppressUnhandledRejections():null!==o?0===(50397184&o)?(a._proxy(this,l),this._values[l]=a):n=0!==(33554432&o)?this._promiseFulfilled(a._value(),l):0!==(16777216&o)?this._promiseRejected(a._reason(),l):this._promiseCancelled(l):n=this._promiseFulfilled(a,l)}n||r._setAsyncGuaranteed()},o.prototype._isResolved=function(){return null===this._values},o.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},o.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},o.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},o.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var i=++this._totalResolved;return i>=this._length&&(this._resolve(this._values),!0)},o.prototype._promiseCancelled=function(){return this._cancel(),!0},o.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},o.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var i=0;i<t.length;++i)t[i]instanceof e&&t[i].cancel()}},o.prototype.shouldCopyValues=function(){return!0},o.prototype.getActualLength=function(e){return e},o};