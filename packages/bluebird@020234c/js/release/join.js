"use strict";module.exports=function(e,n,r,t,o,a){var i,s=require("./util"),c=s.canEvaluate,l=s.tryCatch,u=s.errorObj;if(c){for(var p=function(e){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))},h=function(e){return new Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,e))},f=function(n){for(var r=new Array(n),t=0;t<r.length;++t)r[t]="this.p"+(t+1);var a=r.join(" = ")+" = null;",i="var promise;\n"+r.map(function(e){return"                                                         \n                promise = "+e+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "}).join("\n"),s=r.join(", "),c="Holder$"+n,p="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";return p=p.replace(/\[TheName\]/g,c).replace(/\[TheTotal\]/g,n).replace(/\[ThePassedArguments\]/g,s).replace(/\[TheProperties\]/g,a).replace(/\[CancellationCode\]/g,i),new Function("tryCatch","errorObj","Promise","async",p)(l,u,e,o)},d=[],m=[],v=[],y=0;y<8;++y)d.push(f(y+1)),m.push(p(y+1)),v.push(h(y+1));i=function(e){this._reject(e)}}e.join=function(){var o,l=arguments.length-1;if(l>0&&"function"==typeof arguments[l]&&(o=arguments[l],l<=8&&c)){var u=new e(t);u._captureStackTrace();for(var p=d[l-1],h=new p(o),f=m,y=0;y<l;++y){var _=r(arguments[y],u);if(_ instanceof e){_=_._target();var C=_._bitField;0===(50397184&C)?(_._then(f[y],i,void 0,u,h),v[y](_,h),h.asyncNeeded=!1):0!==(33554432&C)?f[y].call(u,_._value(),h):0!==(16777216&C)?u._reject(_._reason()):u._cancel()}else f[y].call(u,_,h)}if(!u._isFateSealed()){if(h.asyncNeeded){var T=a();null!==T&&(h.fn=s.domainBind(T,h.fn))}u._setAsyncGuaranteed(),u._setOnCancel(h)}return u}for(var g=arguments.length,j=new Array(g),w=0;w<g;++w)j[w]=arguments[w];o&&j.pop();var u=new n(j).promise();return void 0!==o?u.spread(o):u}};