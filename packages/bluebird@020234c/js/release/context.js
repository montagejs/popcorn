"use strict";module.exports=function(t){function e(){this._trace=new e.CapturedTrace(p())}function o(){if(r)return new e}function p(){var t=n.length-1;if(t>=0)return n[t]}var r=!1,n=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=n.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},e.CapturedTrace=null,e.create=o,e.deactivateLongStackTraces=function(){},e.activateLongStackTraces=function(){var o=t.prototype._pushContext,n=t.prototype._popContext,i=t._peekContext,u=t.prototype._peekContext,a=t.prototype._promiseCreated;e.deactivateLongStackTraces=function(){t.prototype._pushContext=o,t.prototype._popContext=n,t._peekContext=i,t.prototype._peekContext=u,t.prototype._promiseCreated=a,r=!1},r=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=p,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},e};