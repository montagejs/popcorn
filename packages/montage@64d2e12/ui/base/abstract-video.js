var Component=require("../component").Component,MediaController=require("../../core/media-controller").MediaController,AbstractVideo=exports.AbstractVideo=Component.specialize({constructor:{value:function e(){if(this.constructor===e)throw new Error("AbstractVideo cannot be instantiated.")}},_mediaElement:{value:null},mediaElement:{get:function(){return this._mediaElement},set:function(e){this._mediaElement=e,this.videoController&&(this.videoController.mediaElement=this.mediaElement)}},_videoController:{value:null},videoController:{get:function(){return this._videoController},set:function(e){e&&(this._videoController=e,this.mediaElement&&(this.videoController.mediaElement=this.mediaElement))}},_src:{value:null},src:{get:function(){return this._src},set:function(e){this._src=e}},_sources:{value:[]},sources:{get:function(){return this._sources},set:function(e){if(e&&e.length){for(var t=this.element.ownerDocument.createElement("video"),n=0;n<e.length;n++){var i=e[n].src,l=e[n].type;if(l&&t.canPlayType(l)){this.src=i;break}}this._sources=e}}},loadMedia:{value:function(){this.mediaElement.src=this.src,this.mediaElement.load()}},_repeat:{value:!1},repeat:{get:function(){return this._repeat},set:function(e){e!==this._repeat&&(this._repeat=e,e?this.mediaElement.setAttribute("loop","true"):this.mediaElement.removeAttribute("loop"),this.needsDraw=!0)}},toggleRepeat:{value:function(){this.repeat=!this.repeat}},_posterSrc:{value:null},posterSrc:{get:function(){return this._posterSrc},set:function(e){this._posterSrc=e}},showPoster:{value:function(){this.posterSrc&&this.mediaElement&&(this.mediaElement.poster=this.posterSrc)}},supportsFullScreen:{value:!0},_isFullScreen:{value:!1},isFullScreen:{get:function(){return this._isFullScreen}},toggleFullScreen:{value:function(){this.supportsFullScreen&&(this._isFullScreen=!this._isFullScreen,this._isFullScreen?this.element.webkitEnterFullScreen?this.element.webkitEnterFullScreen():this.element.webkitRequestFullScreen&&this.element.webkitRequestFullScreen():this.element.webkitExitFullscreen?this.element.webkitExitFullscreen():this.element.webkitCancelFullScreen?this.element.webkitCancelFullScreen():this.element.ownerDocument.webkitCancelFullScreen&&this.element.ownerDocument.webkitCurrentFullScreenElement===this.element&&this.element.ownerDocument.webkitCancelFullScreen(),this.needsDraw=!0)}},handleControllerStatusChange:{value:function(){this.needsDraw=!0}},handleControllerVolumeChange:{value:function(){this.needsDraw=!0}},enterDocument:{value:function(e){if(e){if(this.originalElement.hasAttribute("src")&&this.originalElement.getAttribute("src"))this.src=this.originalElement.getAttribute("src");else for(var t,n,i=this.originalElement.getElementsByTagName("source"),l=0;l<i.length;l++)if(t=i[l].getAttribute("src"),n=i[l].getAttribute("type"),!n||this.mediaElement.canPlayType(n)){this.src=t;break}for(var r=this.originalElement.getElementsByTagName("track"),s=0;s<r.length;s++){var o=r[s].getAttribute("kind");if("captions"===o||"subtitles"===o){var a=document.createElement("track");a.kind=o,a.label=r[s].getAttribute("label"),a.src=r[s].getAttribute("src"),a.srclang=r[s].getAttribute("srclang"),a["default"]=r[s].hasAttribute("default"),this.mediaElement.appendChild(a),this.mediaElement.textTracks[this.mediaElement.textTracks.length-1].mode="showing"}}this.addPathChangeListener("videoController.status",this,"handleControllerStatusChange"),this.addPathChangeListener("videoController.volume",this,"handleControllerVolumeChange"),this.videoController||(this.videoController=new MediaController),this.videoController.mediaElement=this.mediaElement}}}});