var List=require("../list.reel").List;exports.VirtualList=List.specialize({templateDidLoad:{value:function(){this["super"]();var t=this,e=this.flow.didDraw;this.flow.didDraw=function(){t.flow._repetition._drawnIterations[0]&&(t.needsDraw=!0,t.flow.didDraw=e)},this._scrollBars.opacity=0}},enterDocument:{value:function(t){this["super"](t),this.flow._flowTranslateComposer.addEventListener("translateStart",this,!1),this.flow._flowTranslateComposer.addEventListener("translateEnd",this,!1),window.addEventListener("resize",this,!1)}},exitDocument:{value:function(){this["super"](),this.flow._flowTranslateComposer.removeEventListener("translateStart",this,!1),this.flow._flowTranslateComposer.removeEventListener("translateEnd",this,!1),window.removeEventListener("resize",this,!1)}},__scroll:{value:0},_scroll:{get:function(){return this.__scroll},set:function(t){this.__scroll=t,this._scrollBars.verticalScroll=this._calculateScrollBarsVerticalScroll(t,this._height,this._rowHeight,this.flow._numberOfIterations,this._scrollBars.verticalLength)}},handleResize:{value:function(){this.needsDraw=!0}},handleTranslateStart:{value:function(){this._scrollBars.verticalLength<1&&(this._scrollBars.opacity=.5)}},handleTranslateEnd:{value:function(){this._scrollBars.opacity=0}},_measureHeight:{value:function(){return this.element.clientHeight}},_measureWidth:{value:function(){return this.element.clientWidth}},_measureRowHeight:{value:function(){return this.flow._repetition._drawnIterations[0].firstElement.scrollHeight}},_calculateLinearScrollingVector:{value:function(t,e){return[0,-500*e/t,0]}},_calculateScrollBarsVerticalLength:{value:function(t,e,i){var r=t/e/i;return r>1?1:r}},_calculateFlowPath:{value:function(t,e){return[{knots:[{knotPosition:[0,0,0],nextHandlerPosition:[0,1e3*e,0],nextDensity:3e3,previousDensity:3e3},{knotPosition:[0,3e3*e,0],previousHandlerPosition:[0,2e3*e,0],nextDensity:3e3,previousDensity:3e3}],units:{},headOffset:1,tailOffset:t/e}]}},_calculateCameraPosition:{value:function(t,e,i){return[t/2,e/2+i,e/2]}},_calculateCameraTargetPoint:{value:function(t,e,i){return[t/2,e/2+i,0]}},_calculateScrollBarsVerticalScroll:{value:function(t,e,i,r,s){return 1===s?0:t*(1-s)/(r-e/i)}},willDraw:{value:function(){if(this["super"](),this.flow._repetition._drawnIterations[0]){if(0===(this._rowHeight=this._measureRowHeight()))return;this._width=this._measureWidth(),this._height=this._measureHeight(),this.flow.linearScrollingVector=this._calculateLinearScrollingVector(this._height,this._rowHeight),this.flow.paths=this._calculateFlowPath(this._height,this._rowHeight),this.flow.cameraTargetPoint=this._calculateCameraTargetPoint(this._width,this._height,this._rowHeight),this.flow.cameraPosition=this._calculateCameraPosition(this._width,this._height,this._rowHeight),this.flow.cameraFov=90,this._scrollBars.displayHorizontal=!1,this._scrollBars.displayVertical=!0,this._scrollBars.verticalLength=this._calculateScrollBarsVerticalLength(this._height,this._rowHeight,this.flow._numberOfIterations)}}},draw:{value:function(){0===this._rowHeight&&(this.needsDraw=!0)}}});