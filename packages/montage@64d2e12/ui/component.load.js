montageDefine("64d2e12","ui/component",{dependencies:["../core/core","../core/meta/module-object-descriptor","../core/target","../core/template","../core/document-resources","../core/gate","../core/promise","../core/event/event-manager","../core/serialization/alias","../core/drag/drag-manager","../core/logger","../core/logger","../core/logger","../core/logger","../core/logger","collections/weak-map","collections/map","collections/set","../core/application","../core/core","../core/core"],factory:function(e,t,n){function i(e){return e?e._montage_metadata.objectName+":"+Object.hash(e)+" id: "+e.identifier:"NIL"}var s,o,a=e("../core/core").Montage,r=e("../core/meta/module-object-descriptor").ModuleObjectDescriptor.getObjectDescriptorWithModuleId,l=e("../core/target").Target,u=e("../core/template").Template,m=e("../core/document-resources").DocumentResources,h=e("../core/gate").Gate,d=e("../core/promise").Promise,c=e("../core/event/event-manager").defaultEventManager,p=e("../core/serialization/alias").Alias,_=e("../core/drag/drag-manager").DragManager,f=e("../core/logger").logger("component"),g=e("../core/logger").logger("Drawing performance").color.green(),v=e("../core/logger").logger("drawing list").color.blue(),D=e("../core/logger").logger("drawing needsDraw").color.violet(),w=e("../core/logger").logger("drawing").color.blue(),b=e("collections/weak-map"),C=e("collections/map"),A=e("collections/set"),T="data-montage-le-component",L="data-montage-le-arg",O="data-montage-le-arg-begin",y="data-montage-le-arg-end",E=a.specialize({component:{value:null},fromCssClass:{value:null},cssClass:{value:null},toCssClass:{value:null},hasOneFrameDelay:{value:!1},_animationAndTransitionProperties:{value:["-webkit-animation","-moz-animation","-ms-animation","animation","-webkit-transition","-moz-transition","-ms-transition","transition"]},_emptyArray:{value:[]},_parseComputedStyleTimeValue:{value:function(e){var t,n;if("string"!=typeof e||""===e)return this._emptyArray;for(t=e.replace(/s| /g,"").split(","),n=0;n<t.length;n++)t[n]=+t[n];return t}},_getMaxAnimationTime:{value:function(){var e,t,n,i,s,o,a,r=0;if(this.component&&this.component.element){for(e=global.getComputedStyle(this.component.element),o=0;o<this._animationAndTransitionProperties.length;o++)for(t=this._parseComputedStyleTimeValue(e.getPropertyValue(this._animationAndTransitionProperties[o]+"-duration")),n=this._parseComputedStyleTimeValue(e.getPropertyValue(this._animationAndTransitionProperties[o]+"-delay")),s=Math.max(t.length,n.length),a=0;a<s;a++)i="undefined"==typeof t[a]?t[0]||0:t[a],i+="undefined"==typeof n[a]?n[0]||0:n[a],i>r&&(r=i);r>0&&(r+=.3)}return r}},_onAnimationsCompletedTimeout:{value:null},_cancelOnAnimationsCompletedEvent:{value:function(){clearTimeout(this._onAnimationsCompletedTimeout)}},_onAnimationsCompleted:{value:function(e){var t,n=this._getMaxAnimationTime();return n?(t=this,this._cancelOnAnimationsCompletedEvent(),void(this._onAnimationsCompletedTimeout=setTimeout(function(){e.call(t)},1e3*n))):void e.call(this)}},_needsToMeasureAnimationTimeOnNextDraw:{value:!1},_needsToMeasureAnimationTime:{value:!1},handleDidDraw:{value:function(e){this._needsToMeasureAnimationTimeOnNextDraw?(this.fromCssClass&&this.component.classList.remove(this.fromCssClass),this.cssClass&&this.component.classList.add(this.cssClass),this.toCssClass&&this.component.classList.add(this.toCssClass),this._needsToMeasureAnimationTimeOnNextDraw=!1,this._needsToMeasureAnimationTime=!0,this.component.needsDraw=!0):this._needsToMeasureAnimationTime&&(this._onAnimationsCompleted(function(){this._finishedDeferred&&(this._finishedDeferred.resolve(),this._finishedDeferred=null)}),this.component.removeEventListener("didDraw",this,!1),this._needsToMeasureAnimationTime=!1)}},_finishedDeferred:{value:null},finished:{get:function(){return this._finishedDeferred||(this._finishedDeferred=d.pending()),this._finishedDeferred.promise}},play:{value:function(){this.component&&(this._finishedDeferred&&!this._cancelled||(this._cancelled=!1,this._finishedDeferred=d.pending()),this.component.needsDraw=!0,this.fromCssClass?(this.fromCssClass&&this.component.classList.add(this.fromCssClass),this.cssClass&&this.component.classList.remove(this.cssClass),this.toCssClass&&this.component.classList.remove(this.toCssClass),this._needsToMeasureAnimationTime=!1,this._needsToMeasureAnimationTimeOnNextDraw=!0):this.hasOneFrameDelay?(this._needsToMeasureAnimationTime=!1,this._needsToMeasureAnimationTimeOnNextDraw=!0):(this.cssClass&&this.component.classList.add(this.cssClass),this.toCssClass&&this.component.classList.add(this.toCssClass),this._needsToMeasureAnimationTime=!0,this._needsToMeasureAnimationTimeOnNextDraw=!1),this.component.addEventListener("didDraw",this,!1))}},_cancelled:{value:!1},cancel:{value:function(){this._cancelled=!0,this.fromCssClass&&this.component.classList.remove(this.fromCssClass),this.cssClass&&this.component.classList.remove(this.cssClass),this.toCssClass&&this.component.classList.remove(this.toCssClass),this.component.removeEventListener("didDraw",this,!1),this._finishedDeferred&&this._finishedDeferred.reject()}}}),I=t.Component=l.specialize({DOM_ARG_ATTRIBUTE:{value:"data-arg"},drawListLogger:{value:v},delegate:{value:null},_templateObjects:{serializable:!1,value:null},templateObjects:{serializable:!1,get:function(){return this._templateObjects||(this._templateObjects=Object.create(null)),!this._setupTemplateObjectsCompleted&&this._templateDocumentPart&&this._setupTemplateObjects(this._templateDocumentPart.objects),this._templateObjects},set:function(e){this._templateObjects=e}},getResources:{value:function(){if(!this._setupTemplateObjectsCompleted&&this._templateDocumentPart)return this._templateDocumentPart.template.getResources()._resources}},_nextTarget:{value:null},nextTarget:{get:function(){return this._nextTarget||this.parentComponent},set:function(e){this._nextTarget=e}},_ownerDocumentPart:{value:null},_templateDocumentPart:{value:null},_domArguments:{value:void 0},_domArgumentNames:{value:void 0},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new h).initWithDelegate(this),this._canDrawGate.setField("componentTreeLoaded",!1)),this._canDrawGate},enumerable:!1},_blockDrawGate:{value:null},blockDrawGate:{enumerable:!1,get:function(){return this._blockDrawGate||(this._blockDrawGate=(new h).initWithDelegate(this),this._blockDrawGate.setField("element",!1),this._blockDrawGate.setField("drawRequested",!1)),this._blockDrawGate}},_firstDraw:{enumerable:!1,value:!0},_completedFirstDraw:{enumerable:!1,value:!1},originalElement:{value:null},_element:{enumerable:!1,value:null},element:{get:function(){return this._element},set:function(e){if(null===e||void 0===e)return void console.warn("Tried to set element of ",this," to ",e);if(e.component&&e.component!==this)throw new Error("Element "+e+" is already assigned to another component: "+e.component);if(global._montage_le_flag&&e.setAttribute(T,a.getInfoForObject(this).moduleId),this.isDeserializing)this.eventManager.registerEventHandlerForElement(this,e),this._isTemplateInstantiated?this._templateElement||(this._templateElement=e):(this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0));else{if(!this._firstDraw)return void console.error("Cannot change element of ",this," after it has been set");this.eventManager.registerEventHandlerForElement(this,e),this._element=e,!this.blockDrawGate.value&&this._element&&this.blockDrawGate.setField("element",!0)}this._initializeClassListFromElement(e)}},getElementId:{value:function(){var e=this._element;if(e)return e.getAttribute("data-montage-id")}},_initDomArguments:{value:function(){var e,t,n,i,s=this.element;e=s.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"]"),e.length&&(t={});e:for(var o,a=0;o=e[a];a++){for(i=o;(i=i.parentNode)!==s;)if(i.component)continue e;this._findAndDetachComponents(o),o.parentNode.removeChild(o),n=o.getAttribute(this.DOM_ARG_ATTRIBUTE),o.removeAttribute(this.DOM_ARG_ATTRIBUTE),t[n]=o}this._domArguments=t}},_sharedEmptyArray:{value:[]},getDomArgumentNames:{value:function(){return void 0===this._domArgumentNames&&(this._domArgumentNames=this._domArguments?Object.keys(this._domArguments):this._sharedEmptyArray),this._domArgumentNames}},extractDomArgument:{value:function(e){if(this._domArguments){var t;return t=this._domArguments[e],this._domArguments[e]=null,t}return null}},_getTemplateDomArgument:{value:function(e){var t,n,i,s,o,a,r=this._ownerDocumentPart.template;i=r.getElementById(this.getElementId()),t=i.querySelectorAll("*["+this.DOM_ARG_ATTRIBUTE+"='"+e+"']");e:for(var l,u=0;l=t[u];u++){for(n=l;(n=n.parentNode)!==i;)if(s=r.getElementId(n),s&&(o=r.getSerialization(),a=o.getSerializationLabelsWithElements(s),a.length>0))continue e;return l}}},dragManager:{get:function(){return s||(s=new _).initWithComponent(this.rootComponent)}},getTemplateArgumentElement:{value:function(e){if(this._ownerDocumentPart){var t,n,i,s,o,a=this._ownerDocumentPart.template;return global._montage_le_flag&&(t=this.ownerComponent._montage_metadata.moduleId,o=this._montage_metadata.label),"*"===e?(n=a.getElementById(this.getElementId()),i=a.document.createRange(),i.selectNodeContents(n),s=i.cloneContents(),global._montage_le_flag&&n.children.length>0&&this._leTagStarArgument(t,o,s)):(s=this._getTemplateDomArgument(e).cloneNode(!0),s.removeAttribute(this.DOM_ARG_ATTRIBUTE),global._montage_le_flag&&this._leTagNamedArgument(t,o,s,e)),s}}},getTemplateArgumentSerialization:{value:function(e){var t=this._ownerDocumentPart.template;return t._createSerializationWithElementIds(e)}},resolveTemplateArgumentTemplateProperty:{value:function(e){var t,n,i,s,o=e.indexOf(":"),r=e.slice(0,o),l=e.slice(o),u=this._templateDocumentPart;if(a.getInfoForObject(this).label===r)return u&&(i=u.objects[l]),i instanceof p&&(n=u.objects[i.componentLabel],t=i.value.slice(1),s=n.resolveTemplateArgumentTemplateProperty(t),s||(s=t)),s}},setElementWithParentComponent:{value:function(e,t){this._alternateParentComponent=t,this.element!==e&&(this.element=e)}},_application:{value:null},application:{enumerable:!1,get:function(){return this._application||(I.prototype._application=e("../core/application").application)}},eventManager:{enumerable:!1,get:function(){return c}},rootComponent:{enumerable:!1,get:function(){return t.__root__}},elementControllerFromEvent:{enumerable:!1,value:function(e,t){return t}},_alternateParentComponent:{value:null},__parentComponent:{value:null},_parentComponent:{set:function(e){this.__parentComponent=e,this.dispatchOwnPropertyChange("parentComponent",e)},get:function(){return this.__parentComponent}},parentComponent:{enumerable:!1,get:function(){return this._parentComponent}},findParentComponent:{value:function(){var e,t=this.element,n=this.eventManager;if(t){for(;(e=t.parentNode)&&!n.eventHandlerForElement(e);)t=e;return e?n.eventHandlerForElement(e):this._alternateParentComponent}}},querySelectorComponent:{value:function(e){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var t=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!t)throw'querySelectorComponent: Syntax error "'+e+'"';var n,i,s,o=this.childComponents,r=t[1],l=(t[2]||" ",t[3]),u=t[4];if(r)for(u=l?"@"+l+u:"",i=0,s;s=o[i];i++){if(r===a.getInfoForObject(s).label)return u?s.querySelectorComponent(u):s;if(n=s.querySelectorComponent(e))return n}else for(i=0,s;s=o[i];i++)if(l===a.getInfoForObject(s).label)return u?s.querySelectorComponent(u):s;return null}},querySelectorAllComponent:{value:function(e,t){if("string"!=typeof e)throw"querySelectorComponent: Selector needs to be a string.";var n=e.match(/^\s*(?:@([^>\s]+))?(?:\s*(>)?\s*@([^>\s]+)(.*))?$/);if(!n)throw'querySelectorComponent: Syntax error "'+e+'"';var i,s,o=this.childComponents,r=n[1],l=(n[2]||" ",n[3]),u=n[4],m=[];if(r)for(u=l?"@"+l+u:"",i=0,s;s=o[i];i++)r!==a.getInfoForObject(s).label||t&&t!==s.ownerComponent?m=m.concat(s.querySelectorAllComponent(e,t)):u?m=m.concat(s.querySelectorAllComponent(u)):m.push(s);else for(i=0,s;s=o[i];i++)l!==a.getInfoForObject(s).label||t&&t!==s.ownerComponent||(u?m=m.concat(s.querySelectorAllComponent(u,t)):m.push(s));return m}},template:{enumerable:!1,value:null},hasTemplate:{enumerable:!1,value:!0},_templateModuleId:{serializable:!1,value:null},_template:{value:null},_treeLevel:{value:0},_addChildComponent:{value:function(e){return this.addChildComponent(e)}},addChildComponent:{value:function(e){this.childComponents.indexOf(e)===-1&&(this.childComponents.push(e),e._parentComponent=this,e._prepareForEnterDocument(),e.needsDraw&&!this.rootComponent.isComponentWaitingNeedsDraw(e)&&e._addToParentsDrawList()),e._shouldBuildIn=!0}},attachToParentComponent:{value:function(){this.detachFromParentComponent(),this._parentComponent=null;var e,t,n=this.findParentComponent();if(n){e=n.childComponents;for(var i=0;t=e[i];i++){var s=t.findParentComponent();s===this&&(n.removeChildComponent(t),s.addChildComponent(t))}n.addChildComponent(this)}}},detachFromParentComponent:{value:function(){var e=this.parentComponent;e&&e.removeChildComponent(this)}},removeChildComponent:{value:function(e){var t=this.childComponents,n=t.indexOf(e);n>-1&&(e._exitDocument(),t.splice(n,1),e._parentComponent=null,e._alternateParentComponent=null,e._addedToDrawList&&(e._addedToDrawList=!1,n=this._drawList.indexOf(e),this._drawList.splice(n,1)),this.rootComponent.removeFromCannotDrawList(e))}},_childComponents:{value:null},childComponents:{enumerable:!1,get:function(){return this._childComponents||(this._childComponents=[])}},_needsEnterDocument:{value:!1},_inDocument:{value:!1},__exitDocument:{value:function(){this.draggable&&this.unregisterDraggable(),this.droppable&&this.unregisterDroppable(),this._inDocument&&"function"==typeof this.exitDocument&&(this.exitDocument(),this._inDocument=!1)}},_exitDocument:{value:function(){var e;this._needsEnterDocument?this._needsEnterDocument=!1:(e=function(t){for(var n,i=t.childComponents,s=0;n=i[s];s++)n._isComponentExpanded&&e(n);t._inDocument&&t.__exitDocument()})(this)}},exitDocument:{value:function(){this.isActiveTarget&&(c.activeTarget=this.nextTarget)}},_prepareForEnterDocument:{value:function(){this._firstDraw?this._needsEnterDocument=!0:(this.needsDraw=!0,this.traverseComponentTree(function(e){return!e._needsEnterDocument&&(e._needsEnterDocument=!0,void(e.needsDraw=!0))}))}},draggable:{value:!1},droppable:{value:!1},ownerComponent:{enumerable:!1,value:null},components:{enumerable:!1,value:{}},_isComponentExpanded:{enumerable:!1,value:!1},_isTemplateLoaded:{enumerable:!1,value:!1},_isTemplateInstantiated:{enumerable:!1,value:!1},cleanupDeletedComponentTree:{value:function(e){e&&this.cancelBindings(),this.needsDraw=!1,this.traverseComponentTree(function(t){e&&t.cancelBindings(),t.needsDraw=!1})}},_newDomContent:{enumerable:!1,value:null},_elementsToAppend:{value:null},domContent:{serializable:!1,get:function(){return this._element?Array.prototype.slice.call(this._element.childNodes,0):null},set:function(e){var t,n,i,s=[];if(this._elementsToAppend||(this._elementsToAppend=[]),this._newDomContent=e,this.needsDraw=!0,null===this._newDomContent&&(this._shouldClearDomContentOnNextDraw=!0),"function"==typeof this.contentWillChange&&this.contentWillChange(e),t=this.childComponents,e)for(this._componentsPendingBuildOut||(this._componentsPendingBuildOut=[]),n=t.length-1;n>=0;n--)this._componentsPendingBuildOut.indexOf(t[n])===-1&&this._componentsPendingBuildOut.push(t[n]);else for(this._componentsPendingBuildOut=[],n=t.length-1;n>=0;n--)t[n]._shouldBuildOut=!0;if(e instanceof Element)this._elementsToAppend.push(e),this._findAndDetachComponents(e,s);else if(e&&e[0])for(n=0;n<e.length;n++)this._elementsToAppend.push(e[n]),this._findAndDetachComponents(e[n],s);for(n=0;i=s[n];n++)this.addChildComponent(i)}},_shouldClearDomContentOnNextDraw:{value:!1},_findAndDetachComponents:{value:function(e,t){var n,i=e.component;if(t||(t=[]),i)i.detachFromParentComponent(),t.push(i);else{n=e.children||e.childNodes;for(var s,o=0;s=n[o];o++)this._findAndDetachComponents(s,t)}return t}},clonesChildComponents:{writable:!1,value:!1},_innerTemplate:{value:null},innerTemplate:{serializable:!1,get:function(){var e,t,n,i,s,o,a,r=this._innerTemplate;if(!r&&(e=this._ownerDocumentPart)){t=e.template,n=this.getElementId(),r=t.createTemplateFromElementContents(n),i=r.getSerialization(),s=i.getExternalObjectLabels(),o=e.objects,a=Object.create(null);for(var l,u=0;l=s[u];u++)a[l]=o[l];r.setInstances(a),this._innerTemplate=r}return r},set:function(e){this._innerTemplate=e}},canDraw:{value:function(){return this._canDraw}},_canDraw:{get:function(){return!this._canDrawGate||this._canDrawGate.value},set:function(e){o.componentCanDraw(this,e)},enumerable:!1},_prepareCanDraw:{enumerable:!1,value:function(){if(!this._isComponentTreeLoaded)return this.loadComponentTree()}},_blocksOwnerComponentDraw:{value:!1},_updateOwnerCanDrawGate:{value:function(){this._blocksOwnerComponentDraw&&this.ownerComponent&&this.ownerComponent.canDrawGate.setField(this,this.canDrawGate.value)}},_isComponentTreeLoaded:{value:!1},shouldLoadComponentTree:{value:!0},_loadComponentTreeDeferred:{value:null},loadComponentTree:{value:function(){if(!this._loadComponentTreeDeferred){this.canDrawGate.setField("componentTreeLoaded",!1),(this.needsDraw||this.hasTemplate)&&(this._canDraw=!1);var e=this;this._loadComponentTreeDeferred=this.expandComponent().then(function(){if(e.hasTemplate||e.shouldLoadComponentTree){var t,n,i=e._childComponents;if(i&&i.length){t=[];for(var s=0;n=i[s];s++)t.push(n.loadComponentTree());return d.all(t)}return d.resolve(null)}}).then(function(){e._isComponentTreeLoaded=!0,e._needsEnterDocument&&(e.needsDraw=!0),e.canDrawGate.setField("componentTreeLoaded",!0)})["catch"](function(e){console.error(e)})}return this._loadComponentTreeDeferred}},traverseComponentTree:{value:function(e,t){function n(){var n,s,o=i.childComponents;if(e&&e(i)===!1)return void(t&&t());if(0===(s=o.length))return void(t&&t());for(var a=function(){0===--s&&t&&t()},r=0;n=o[r];r++)n.traverseComponentTree(e,a)}var i=this;this._isComponentExpanded?n():t&&t()}},_expandComponentPromise:{value:null},expandComponent:{value:function(){if(!this._expandComponentPromise)if(this.hasTemplate){var e=this;this._expandComponentPromise=this._instantiateTemplate().then(function(){e._isComponentExpanded=!0,e._addTemplateStylesIfNeeded(),e.needsDraw=!0})["catch"](function(e){console.error(e)})}else this._isComponentExpanded=!0,this._expandComponentPromise=d.resolve();return this._expandComponentPromise}},_templateObjectDescriptor:{value:{enumerable:!0,configurable:!0}},_setupTemplateObjects:{value:function(e){return this._templateObjects=this._templateObjects||Object.create(null),this._addTemplateObjects(e),this._setupTemplateObjectsCompleted=!0,this._templateObjects}},_setupTemplateObjectsCompleted:{value:!1},_addTemplateObjects:{value:function(e){var t,n,i=this._templateObjectDescriptor,s=this._templateObjects;for(t in e)n=e[t],null!==n&&void 0!==n&&(I.prototype.isPrototypeOf(n)&&n!==this&&n.parentComponent!==this?(i.get=this._makeTemplateObjectGetter(this,t,n),Object.defineProperty(s,t,i)):s[t]=n)}},_makeTemplateObjectGetter:{value:function(e,t,n){var i,s,o,a="@"+t;return function(){if(i)return e.querySelectorAllComponent(a,e);if(s=e.querySelectorAllComponent(a,e),1===s.length)for(o=s[0];o=o.parentComponent;){if(o===e)return Object.defineProperty(this,t,{value:s[0]}),s[0];if(o.clonesChildComponents)break}else if(0===s.length)return n;return i=!0,s}}},_instantiateTemplate:{value:function(){var e=this;return this._loadTemplate().then(function(t){if(!e._element)return d.reject(new Error("Cannot instantiate template without an element.",e));var n=null,i=e._element.ownerDocument;return n||(n=Object.create(null)),n.owner=e,e._isTemplateInstantiated=!0,t.instantiateWithInstances(n,i).then(function(t){t.parentDocumentPart=e._ownerDocumentPart,e._templateDocumentPart=t,t.fragment=null,n=null},function(e){throw new Error(t.getBaseUrl()+":"+e.stack||e)})})}},_templateDidLoad:{value:function(e){this._templateDocumentPart=e,this._templateObjects&&this._setupTemplateObjects(e.objects),this.addOwnPropertyChangeListener("draggable",this),this.addOwnPropertyChangeListener("droppable",this)}},_loadTemplatePromise:{value:null},_loadTemplate:{value:function(){var e;if(!this._loadTemplatePromise){var t=this;e=a.getInfoForObject(this),this._loadTemplatePromise=u.getTemplateWithModuleId(this.templateModuleId,e.require).then(function(e){return t._template=e,t._isTemplateLoaded=!0,e})}return this._loadTemplatePromise}},templateModuleId:{get:function(){return this._templateModuleId||this._getDefaultTemplateModuleId()}},_getDefaultTemplateModuleId:{value:function(){var e,t,n,i;return i=a.getInfoForObject(this),n=i.moduleId,t=n.lastIndexOf("/"),e=n+"/"+n.slice(t===-1?0:t+1,-5)+".html"}},deserializedFromSerialization:{value:function(){this.attachToParentComponent()}},_deserializedFromTemplate:{value:function(e,t,n){a.getInfoForObject(this).label=t,this._ownerDocumentPart=n,this.hasOwnProperty("identifier")||(this.identifier=t),this.ownerComponent||(I.prototype.isPrototypeOf(e)?this.ownerComponent=e:this.ownerComponent=this.rootComponent,this._updateOwnerCanDrawGate()),this._needsDrawInDeserialization&&(this.needsDraw=!0)}},blueprintModuleId:{serializable:!1,enumerable:!1,get:function(){return this.objectDescriptorModuleId}},blueprint:e("../core/core")._objectDescriptorDescriptor,objectDescriptor:e("../core/core")._objectDescriptorDescriptor,objectDescriptorModuleId:{serializable:!1,enumerable:!1,get:function(){var e=a.getInfoForObject(this),t=e&&!e.isInstance?this:Object.getPrototypeOf(this);if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptorModuleId")||!t._objectDescriptorModuleId){e=a.getInfoForObject(t);var n=e.moduleId,i=n.lastIndexOf("/"),s=n.lastIndexOf(".");i=i===-1?0:i+1,s=s===-1?n.length:s,s=s<i?n.length:s;var o;o=s<n.length&&".reel"===n.slice(s,n.length)?n+"/"+n.slice(i,s)+".meta":n.slice(0,s)+".meta",a.defineProperty(t,"_objectDescriptorModuleId",{value:o})}return t._objectDescriptorModuleId}},gateDidBecomeTrue:{value:function(e){e===this._canDrawGate?(this._canDraw=!0,this._updateOwnerCanDrawGate()):e===this._blockDrawGate&&(o.componentBlockDraw(this),this._prepareCanDraw())},enumerable:!1},gateDidBecomeFalse:{value:function(e){e===this._canDrawGate&&this._updateOwnerCanDrawGate()},enumerable:!1},_canDrawGate:{enumerable:!1,value:null},preparedForActivationEvents:{enumerable:!1,value:!1},_arrayObjectPool:{value:{pool:null,size:200,ix:0}},_getArray:{value:function(){if(!this._arrayObjectPool.pool){this._arrayObjectPool.pool=[];for(var e=0;e<this._arrayObjectPool.size;e++)this._arrayObjectPool.pool[e]=[]}return this._arrayObjectPool.ix<this._arrayObjectPool.size?this._arrayObjectPool.pool[this._arrayObjectPool.ix++]:[]}},_disposeArray:{value:function(e){this._arrayObjectPool.ix>0&&(e.length=0,this._arrayObjectPool.pool[--this._arrayObjectPool.ix]=e)}},_drawIfNeeded:{enumerable:!1,value:function(e){var t,n,s,o,a=this._firstDraw;if(this._treeLevel=e,a&&(this.originalElement=this.element),this.needsDraw&&this.rootComponent.addToDrawCycle(this),this._needsEnterDocument&&(this._needsEnterDocument=!1,this._willEnterDocument(),this._enterDocument(a),"function"==typeof this.enterDocument&&this.enterDocument(a)),a&&(this.originalElement=null),null!==this._drawList&&this._drawList.length>0){for(n=this._drawList,this._drawList=this._getArray(),o=n.length,s=0;s<o;s++)t=n[s],t._addedToDrawList=!1,t.canDraw()?t._drawIfNeeded(e+1):w.isDebug&&w.debug(i(t)+" can't draw.");this._disposeArray(n)}}},_updateComponentDom:{value:function(){if(this._firstDraw){if(this._prepareForDraw(),this._composerList)for(var e,t=0,n=this._composerList.length;t<n;t++)e=this._composerList[t],e.lazyLoad||this.loadComposer(e);this._firstDraw=!1}(null!==this._newDomContent||this._shouldClearDomContentOnNextDraw)&&(w.isDebug&&f.debug("Component content changed: component ",this._montage_metadata.objectName,this.identifier," newDomContent",this._newDomContent),this._performDomContentChanges())}},_replaceElementWithTemplate:{enumerable:!1,value:function(){var e,t,n,i,s,o=this.element,a=this._templateElement,r=this.element.attributes;for(n=0;i=r[n];n++)e=i.nodeName,global._montage_le_flag&&e===T?t=i.nodeValue:"id"===e||"data-montage-id"===e?t=i.nodeValue:(s=a.getAttribute(e)||"",t=s?s+("style"===e?"; ":" ")+i.nodeValue:i.nodeValue),a.setAttribute(e,t);this._initializeClassListFromElement(a),o.parentNode?o.parentNode.replaceChild(a,o):this._canDrawOutsideDocument||console.warn("Warning: Trying to replace element ",o," which has no parentNode"),this.eventManager.unregisterEventHandlerForElement(o),this.eventManager.registerEventHandlerForElement(this,a),this._element=a,this._templateElement=null,this._newDomContent&&(this._newDomContent=null,this._shouldClearDomContentOnNextDraw=!1)}},_addTemplateStylesIfNeeded:{value:function(){var e=this._templateDocumentPart;e&&this.rootComponent.addStyleSheetsFromTemplate(e.template)}},_prepareForDraw:{value:function(){f.isDebug&&f.debug(this,"_templateElement: "+this._templateElement);var e;global._montage_le_flag&&(e=this.element.children.length>0),this._initDomArguments(),e&&this._leTagArguments(),this._templateElement&&(this._bindTemplateParametersToArguments(),this._replaceElementWithTemplate())},enumerable:!1},_leTagArguments:{value:function(){if(this!==this.rootComponent){var e=this.ownerComponent._montage_metadata.moduleId,t=this._montage_metadata.label,n=this.getDomArgumentNames();if(n&&0!==n.length)for(var i,s=0;i=n[s];s++)this._leTagNamedArgument(e,t,this._domArguments[i],i);else this._leTagStarArgument(e,t,this.element)}}},_getNodeFirstElement:{value:function(e){var t=e.firstElementChild;if(!t){t=e.firstChild;do if(t.nodeType===Node.ELEMENT_NODE)break;while(t=t.nextSibling)}return t}},_getNodeLastElement:{value:function(e){var t=e.lastElementChild;if(!t){t=e.lastChild;do if(t.nodeType===Node.ELEMENT_NODE)break;while(t=t.previousSibling)}return t}},_leTagStarArgument:{value:function(e,t,n){var i=this._getNodeFirstElement(n),s=this._getNodeLastElement(n);i.setAttribute(O,(i.getAttribute(O)||"")+" "+e+","+t),s.setAttribute(y,(s.getAttribute(y)||"")+" "+e+","+t)}},_leTagNamedArgument:{value:function(e,t,n,i){n.setAttribute(L,e+","+t+","+i)}},_bindTemplateParametersToArguments:{value:function(){var e,t,n,i,s,o,a,r=this._templateDocumentPart?this._templateDocumentPart.parameters:null,l=this._domArguments;if(n=this._validateTemplateArguments(l,r))throw n;for(var u in r)if(r.hasOwnProperty(u)&&(e=r[u],t=l?l[u]:void 0,"*"===u?0!==this._element.childElementCount||this._element.firstChild&&this._element.firstChild.data&&this._element.firstChild.data.trim()?(o=this._element.ownerDocument.createRange(),o.selectNodeContents(this._element),i=o.extractContents()):e&&e.childElementCount>0?(o=this._element.ownerDocument.createRange(),o.selectNodeContents(e),e.parentNode.replaceChild(o.extractContents(),e)):e.parentNode.removeChild(e):i=t,i)){var m,h;if(i instanceof Element){var d=e.classList,c=i.component?i.component.classList:i.classList;for(m=0,h=d.length;m<h;m++)c.add(d[m])}for(s=this._findAndDetachComponents(i),e.parentNode.replaceChild(i,e),m=0;a=s[m];m++)a.attachToParentComponent()}}},_validateTemplateArguments:{value:function(e,t){var n,i=t?Object.keys(t):void 0;if(i&&0!==i.length){for(n in e)if("*"!==n&&!(n in t))return new Error('"'+n+'" parameter does not exist in '+this.templateModuleId);var s=t["*"];if(s)for(n in t)if("*"!==n&&s.contains(t[n]))return new Error('"'+n+'" parameter cannot be used within an element with the star parameter')}}},prepareForActivationEvents:{enumerable:!1,value:null},_prepareForActivationEvents:{value:function(){if("function"==typeof this.prepareForActivationEvents&&this.prepareForActivationEvents(),this._composerList)for(var e,t=0,n=this._composerList.length;t<n;t++)e=this._composerList[t],e.lazyLoad&&this.loadComposer(e);this.preparedForActivationEvents=!0}},_performDomContentChanges:{value:function(){var e,t,n,i=this._newDomContent;if(i||this._shouldClearDomContentOnNextDraw){for(e=this._element,n=e.childNodes.length-1;n>=0;n--)e.childNodes[n].component||e.removeChild(e.childNodes[n]);if(this._elementsToAppend)for(;this._elementsToAppend.length;)t=this._elementsToAppend.shift(),e.contains(t)||e.appendChild(t);this._newDomContent=null,"function"==typeof this.contentDidChange&&this.contentDidChange(),this._shouldClearDomContentOnNextDraw=!1}}},prepareForDraw:{enumerable:!1,value:null},draw:{enumerable:!1,value:Function.noop},willDraw:{enumerable:!1,value:null},didDraw:{enumerable:!1,value:Function.noop},_addedToDrawList:{value:!1},_addToParentsDrawList:{enumerable:!1,value:function(){if(!this._addedToDrawList){var e=this._parentComponent;e?(e._addToDrawList(this),this.drawListLogger.isDebug&&this.drawListLogger.debug(i(this)+" added to "+i(e)+"'s drawList")):this.drawListLogger.isDebug&&this.drawListLogger.debug(this,"parentComponent is null")}}},_needsDraw:{value:!1},_needsDrawInDeserialization:{value:!1},needsDraw:{enumerable:!1,get:function(){return this._needsDraw},set:function(e){return this.isDeserializing?void(this._needsDrawInDeserialization=!0):(e=!!e,void(this._needsDraw!==e&&(D.isDebug&&D.debug("needsDraw toggled "+e+" for "+this._montage_metadata.objectName),this._needsDraw=e,e&&(this.canDrawGate.value?this._addToParentsDrawList():this.blockDrawGate.setField("drawRequested",!0)))))}},_drawList:{value:null},__addToDrawList:{enumerable:!1,value:function(e){null===this._drawList?(this._drawList=[e],e._addedToDrawList=!0):this._drawList.indexOf(e)===-1&&(this._drawList.push(e),e._addedToDrawList=!0)}},_addToDrawList:{enumerable:!1,value:function(e){this.__addToDrawList(e),this._addToParentsDrawList()}},_templateElement:{enumerable:!1,value:null},surrenderPointer:{value:function(e,t){return!0}},_composerList:{value:null,serializable:!1},composerList:{get:function(){return this._composerList||(this._composerList=[]),this._composerList},serializable:!1},addComposer:{value:function(e){this.addComposerForElement(e,e.element)}},addComposerForElement:{value:function(e,t){e.component=this,e.element=t,this.composerList.push(e),this._firstDraw||(e.lazyLoad?this.preparedForActivationEvents&&this.loadComposer(e):this.loadComposer(e))}},loadComposer:{value:function(e){this._composerList&&this._composerList.indexOf(e)>-1&&l.prototype.loadComposer.call(this,e)}},unloadComposer:{value:function(e){this._composerList&&this._composerList.indexOf(e)>-1&&l.prototype.unloadComposer.call(this,e)}},scheduleComposer:{value:function(e){this.rootComponent.addToComposerList(e)}},removeComposer:{value:function(e){if(this._composerList)for(var t=0,n=this._composerList.length;t<n;t++)if(this._composerList[t]===e){this.unloadComposer(this._composerList[t]),this._composerList.splice(t,1);break}}},clearAllComposers:{value:function(){if(this._composerList){for(var e=this._composerList,t=0,n=e.length;t<n;t++)this.unloadComposer(e[t]);e.length=0}}},localizer:{value:null},_waitForLocalizerMessages:{value:!1},waitForLocalizerMessages:{enumerable:!1,get:function(){return this._waitForLocalizerMessages},set:function(e){if(this._waitForLocalizerMessages!==e)if(e!==!0||this.localizer.messages)this._waitForLocalizerMessages=!1,this.canDrawGate.setField("messages",!0);else{if(!this.localizer)throw"Cannot wait for messages on localizer if it is not set";this._waitForLocalizerMessages=!0,f.debug(this,"waiting for messages from localizer"),this.canDrawGate.setField("messages",!1);var t=this;this.localizer.messagesPromise.then(function(e){f.isDebug&&f.debug(t,"got messages from localizer"),t.canDrawGate.setField("messages",!0)})}}},handleDraggableChange:{value:function(e){e?this.registerDraggable():this.unregisterDraggable()}},handleDroppableChange:{value:function(e){e?this.registerDroppable():this.unregisterDroppable()}},registerDraggable:{
value:function(){this.dragManager.registerDraggable(this),this.classList.add("montage-draggable")}},unregisterDraggable:{value:function(){this.dragManager.unregisterDraggable(this),this.classList.remove("montage-draggable")}},registerDroppable:{value:function(){this.dragManager.registerDroppable(this),this.classList.add("montage-droppable")}},unregisterDroppable:{value:function(){this.dragManager.unregisterDroppable(this),this.classList.remove("montage-droppable")}},_draggableContainer:{value:null},draggableContainer:{set:function(e){e&&(e instanceof Element?this._draggableContainer=e:e.element instanceof Element&&(this._draggableContainer=e.element))},get:function(){return this._draggableContainer}},__elementAttributeValues:{value:null},_elementAttributeValues:{get:function(){return this.__elementAttributeValues||(this.__elementAttributeValues={})}},_elementAttributeDescriptors:{value:null},_getElementAttributeDescriptor:{value:function(e){for(var t,n=this;n&&n._elementAttributeDescriptors&&!(t=n._elementAttributeDescriptors[e]);)n=Object.getPrototypeOf(n);return t}},__shouldBuildIn:{value:!0},_shouldBuildIn:{get:function(){return this.__shouldBuildIn},set:function(e){var t;e=!!e,this.__shouldBuildIn=e,e&&(this.parentComponent&&this.parentComponent._componentsPendingBuildOut&&(t=this.parentComponent._componentsPendingBuildOut.indexOf(this),t!==-1&&this.parentComponent._componentsPendingBuildOut.splice(t,1)),this._shouldBuildOut=!1,this._inDocument&&this._buildIn())}},__shouldBuildOut:{value:!1},_shouldBuildOut:{get:function(){return this.__shouldBuildOut},set:function(e){e=!!e,this.__shouldBuildOut=e,e&&(this._shouldBuildIn=!1,this._inDocument&&this._buildOut())}},buildInInitialAnimation:{get:function(){var e=null;return this._activeBuildInAnimation&&"object"==typeof this._activeBuildInAnimation&&"undefined"!=typeof this._activeBuildInAnimation.cssClass&&(e=new E,e.component=this,e.fromCssClass=this._activeBuildInAnimation.fromCssClass,e.cssClass=this._activeBuildInAnimation.cssClass,e.toCssClass=this._activeBuildInAnimation.toCssClass),e}},buildInSwitchAnimation:{get:function(){var e=null;return this._activeBuildInAnimation&&"object"==typeof this._activeBuildInAnimation&&"undefined"!=typeof this._activeBuildInAnimation.cssClass&&(e=new E,e.component=this,e.cssClass=this._activeBuildInAnimation.cssClass,e.toCssClass=this._activeBuildInAnimation.toCssClass),e}},buildOutInitialAnimation:{get:function(){var e=null;return this._activeBuildOutAnimation&&"object"==typeof this._activeBuildOutAnimation&&"undefined"!=typeof this._activeBuildOutAnimation.cssClass&&(e=new E,e.component=this,e.hasOneFrameDelay=!0,e.fromCssClass=this._activeBuildOutAnimation.fromCssClass,e.cssClass=this._activeBuildOutAnimation.cssClass,e.toCssClass=this._activeBuildOutAnimation.toCssClass),e}},buildOutSwitchAnimation:{get:function(){var e=null;return this._activeBuildOutAnimation&&"object"==typeof this._activeBuildOutAnimation&&"undefined"!=typeof this._activeBuildOutAnimation.cssClass&&(e=new E,e.component=this,e.cssClass=this._activeBuildOutAnimation.cssClass,e.toCssClass=this._activeBuildOutAnimation.toCssClass),e}},buildInAnimation:{value:null},buildOutAnimation:{value:null},buildInAnimationOverride:{value:null},buildOutAnimationOverride:{value:null},_activeBuildInAnimation:{value:null},_activeBuildOutAnimation:{value:null},_updateActiveBuildAnimations:{value:function(){this.buildInAnimationOverride?this._activeBuildInAnimation=this.buildInAnimationOverride:this._activeBuildInAnimation=this.buildInAnimation,this.buildOutAnimationOverride?this._activeBuildOutAnimation=this.buildOutAnimationOverride:this._activeBuildOutAnimation=this.buildOutAnimation}},_currentBuildAnimation:{value:null},_buildIn:{value:function(){var e=this;this._currentBuildAnimation&&this._currentBuildAnimation.cancel(),this._element&&this._element.parentNode&&this._element.parentNode.component&&(this._isElementAttachedToParent?this._currentBuildAnimation=this.buildInSwitchAnimation:(this._updateActiveBuildAnimations(),this._currentBuildAnimation=this.buildInInitialAnimation),this._currentBuildAnimation&&(this._currentBuildAnimation.play(),this._currentBuildAnimation.finished.then(function(){e._currentBuildAnimation.cancel(),e._currentBuildAnimation=null,e.dispatchEventNamed("buildInEnd",!0,!0)},function(){})))}},_buildOut:{value:function(){var e=this;this._currentBuildAnimation?(this._currentBuildAnimation.cancel(),this._currentBuildAnimation=this.buildOutSwitchAnimation):(this._updateActiveBuildAnimations(),this._currentBuildAnimation=this.buildOutInitialAnimation),this._element&&this._element.parentNode&&this._element.parentNode.component&&(this._currentBuildAnimation?(this._currentBuildAnimation.play(),this._currentBuildAnimation.finished.then(function(){var t=e.parentComponent;e._currentBuildAnimation.cancel(),e._currentBuildAnimation=null,e.detachFromParentComponent(),e.buildInAnimationOverride=null,e.buildOutAnimationOverride=null,e._element.parentNode.component&&e._element.parentNode.removeChild(e._element),e._isElementAttachedToParent=!1,t.dispatchEventNamed("buildOutEnd",!0,!0)},function(){})):(this.detachFromParentComponent(),this.buildInAnimationOverride=null,this.buildOutAnimationOverride=null,this._isElementAttachedToParent&&(this._element.parentNode&&this._element.parentNode.component&&this._element.parentNode.removeChild(this._element),this._isElementAttachedToParent=!1)))}},_willEnterDocument:{value:function(){var e;e=new CustomEvent("willEnterDocument",{details:{component:this},bubbles:!1}),this.dispatchEvent(e),this._inDocument=!0,this.parentComponent&&this.parentComponent._childWillEnterDocument(),this.__shouldBuildIn&&this._buildIn(),this._isElementAttachedToParent=!0,this.__shouldBuildOut&&this._buildOut()}},_childWillEnterDocument:{value:function(){if(this._componentsPendingBuildOut)for(;this._componentsPendingBuildOut.length;)this._componentsPendingBuildOut.pop()._shouldBuildOut=!0}},_enterDocument:{value:function(e){var t;if(this.draggable&&this.registerDraggable(),this.droppable&&this.registerDroppable(),e){t=this.originalElement;var n,i,s,o,a,r,l;if(n=t.attributes)for(s=n.length,i=0;i<s;i++)o=n[i].name,a=n[i].value,l=this._getElementAttributeDescriptor(o,this),(l||"undefined"!=typeof this[o])&&"undefined"==typeof this._elementAttributeValues[o]&&(this._elementAttributeValues[o]=a,null!==this[o]&&void 0!==this[o]||(this[o]=a));if(l=this._getElementAttributeDescriptor("textContent",this)){var u=t.textContent;"undefined"==typeof this._elementAttributeValues.textContent&&(this._elementAttributeValues.textContent=u,null!==this.textContent&&void 0!==this.textContent||(this.textContent=u))}if(this._elementAttributeDescriptors)for(r in this._elementAttributeDescriptors)if(this._elementAttributeDescriptors.hasOwnProperty(r)){l=this._elementAttributeDescriptors[r];var m="_"+r;null===this[m]&&null!==l&&"value"in l&&(this[m]=l.value)}}}},_draw:{value:function(){var e,t=this.element;if(null!==this.__elementAttributeValues)for(var n in this._elementAttributeValues)if(this._elementAttributeValues.hasOwnProperty(n)){var i=this[n];e=this._getElementAttributeDescriptor(n,this),e&&("boolean"===e.dataType?i===!0?(t[n]=!0,t.setAttribute(n,n.toLowerCase())):(t[n]=!1,t.removeAttribute(n)):"undefined"!=typeof i&&("textContent"===n?t.textContent=i:t.setAttribute(n,i))),delete this._elementAttributeValues[n]}this._drawClassListIntoComponent()}},_classList:{value:null},_classListDirty:{value:!1},classList:{get:function(){return null===this._classList&&(this._classList=new A,this._subscribeToToClassListChanges(),this._initializeClassListFromElement(this.element)),this._classList}},_initializeClassListFromElement:{value:function(e){if(e&&e.classList&&e.classList.length>0){this._classList?this._unsubscribeToClassListChanges&&this._unsubscribeToClassListChanges():this._classList=new A;for(var t=e.classList,n=0,i=t.length;n<i;n++)this._classList.add(t[n]);this._subscribeToToClassListChanges()}}},_unsubscribeToClassListChanges:{value:null},_subscribeToToClassListChanges:{value:function(){this._unsubscribeToClassListChanges=this._classList.addRangeChangeListener(this,"classList")}},handleClassListRangeChange:{value:function(e,t){this._classListDirty=!0,this.needsDraw=!0}},_drawClassListIntoComponent:{value:function(){if(this._classListDirty){for(var e,t=this.element.classList,n=this._classList,i=0,s=t.length;i<s;i++)e=t.item(i),n.has(e)||(t.remove(e),i--,s--);this._classList.forEach(function(e){t.add(e)}),this._classListDirty=!1}}},dispose:{value:function(){this.cancelBindings(),this.detachFromParentComponent(),this._element&&(c.unregisterEventHandlerForElement(this._element),this._element=null),this.childComponents.forEach(function(e){e.dispose()})}},loadUserInterfaceDescriptor:{value:function(t){var n,i,s,o,l,u,m=this;return this.canDrawGate.setField(this.constructor.userInterfaceDescriptorLoadedField,!1),"object"==typeof t&&(l=t.constructor)&&l.objectDescriptorModuleId&&(i=l.objectDescriptorModuleId),n=this.callDelegateMethod("componentWillUseObjectDescriptorModuleIdForObject",this,i,t),n&&(o=a.getInfoForObject(this.delegate),i=n),i?(s=n?r(i,o?o.require:e):l.objectDescriptor,u=s):u=d.resolve(),u=u.then(function(n){var i,s,r=a.getInfoForObject(m),l=r.require.packageDescription.name,u=l+"/"+r.moduleId;return n&&n.userInterfaceDescriptorModules&&(i=n.userInterfaceDescriptorModules[u],i||(i=n.userInterfaceDescriptorModules["*"])),s=m.callDelegateMethod("componentWillUseUserInterfaceDescriptorModuleIdForObject",m,i,t),!n||!i||s!==i&&s?s?(o=o||a.getInfoForObject(m.delegate),(o.require||e).async(s).then(function(e){return e.montageObject})):void 0:i===n.userInterfaceDescriptorModules["*"]?n.userInterfaceDescriptor:n.userInterfaceDescriptors[u]}),u["finally"](function(){m.canDrawGate.setField(m.constructor.userInterfaceDescriptorLoadedField,!0)})}}},{userInterfaceDescriptorLoadedField:{value:"userInterfaceDescriptorLoaded"},addAttributes:{value:function(e){var t,n,i;this.prototype._elementAttributeDescriptors=e;for(n in e)e.hasOwnProperty(n)&&(i=e[n],null===i||"string"==typeof i?(t={value:i,dataType:"string"},e[n]=t):t=i,"undefined"==typeof this[n]&&this.defineAttribute(n,t))}},defineAttributeSetter:{value:function(e,t,n){return function(e,t,n){return function(i,s){var o=this._getElementAttributeDescriptor(e,this);o&&"boolean"===o.dataType&&(i=!(!i&&""!==i)),"undefined"!=typeof i&&this[t]!==i&&(n?n.call(this,i):this[t]=i,this._elementAttributeValues[e]=i,s||(this.needsDraw=!0))}}(e,t,n.set)}},defineAttributeGetter:{value:function(e){return function(e){return function(){return this[e]}}(e)}},defineAttribute:{value:function(e,t){t=t||{};var n="_"+e,i={configurable:"undefined"==typeof t.configurable||t.configurable,enumerable:"undefined"==typeof t.enumerable||t.enumerable,set:this.defineAttributeSetter(e,n,t),get:t.get||this.defineAttributeGetter(n)};this.prototype.hasOwnProperty(n)||a.defineProperty(this.prototype,n,{value:t.value}),a.defineProperty(this.prototype,e,i)}}}),F=I.specialize({constructor:{value:function(){this._drawTree=this._drawTree.bind(this),this._readyToDrawListIndex=new C,this._addedStyleSheetsByTemplate=new b}},init:{value:function(){return this}},needsDraw:{enumerable:!0,get:function(){return!!this._needsDraw},set:function(e){if(this._needsDraw!==e&&(this._needsDraw=!!e,e))for(var t,n=this.childComponents,i=0;t=n[i];i++)D.isDebug&&D.debug(this,"needsDraw = true for: "+t._montage_metadata.exportedSymbol),t.needsDraw=!0}},canDrawGate:{get:function(){return this._canDrawGate||(this._canDrawGate=(new h).initWithDelegate(this))}},_clearNeedsDrawTimeOut:{value:null},_needsDrawList:{value:[]},_cannotDrawList:{value:null},componentBlockDraw:{value:function(e){this._cannotDrawList=this._cannotDrawList?this._cannotDrawList:new A,this._cannotDrawList.add(e),this._clearNeedsDrawTimeOut&&(clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},isComponentWaitingNeedsDraw:{value:function(e){return this._cannotDrawList.has(e)||this._needsDrawList.indexOf(e)>=0}},componentCanDraw:{value:function(e,t){if(t){if(!this._cannotDrawList)return;if(this._cannotDrawList["delete"](e),this._needsDrawList.push(e),0===this._cannotDrawList.size&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut){var n=this;this._clearNeedsDrawTimeOut=setTimeout(function(){n._clearNeedsDrawList()},0)}}else this._clearNeedsDrawTimeOut&&(clearTimeout(this._clearNeedsDrawTimeOut),this._clearNeedsDrawTimeOut=null)}},_clearNeedsDrawList:{value:function(){var e,t,n,i=this._needsDrawList;for(n=i.length,t=0;t<n;t++)e=i[t],(e.needsDraw||e._drawList&&e._drawList.length>0)&&e._addToParentsDrawList();this._clearNeedsDrawTimeOut=null,i.length=0}},removeFromCannotDrawList:{value:function(e){if(this._cannotDrawList&&(this._cannotDrawList["delete"](e),0===this._cannotDrawList.size&&this._needsDrawList.length>0&&!this._clearNeedsDrawTimeOut)){var t=this;this._clearNeedsDrawTimeOut=setTimeout(function(){t._clearNeedsDrawList()},0)}}},_cancelDrawIfScheduled:{value:function(){var e=this.requestedAnimationFrame,t=this.cancelAnimationFrame;null!==e&&(this._frameTime||(f.isDebug&&f.debug(this,"clearing draw"),t?t(e):clearTimeout(e),this.requestedAnimationFrame=null))}},_addToDrawList:{value:function(e){this.__addToDrawList(e),this.drawListLogger.isDebug&&this.drawListLogger.debug(this,this.canDrawGate.value,this.requestedAnimationFrame),this.drawTree()},enumerable:!1},addToComposerList:{value:function(e){this.composerList.push(e),w.isDebug&&w.debug(this,e,"Added to composer list"),this._scheduleComposerRequest=!0,this.drawTree()}},composerListSwap:{get:function(){return this._composerListSwap||(this._composerListSwap=[]),this._composerListSwap}},_composerListSwap:{value:null},_scheduleComposerRequest:{value:!1},requestedAnimationFrame:{value:null,enumerable:!1},requestAnimationFrame:{value:global.requestAnimationFrame||global.webkitRequestAnimationFrame||global.mozRequestAnimationFrame||global.msRequestAnimationFrame,enumerable:!1},cancelAnimationFrame:{value:global.cancelAnimationFrame||global.webkitCancelAnimationFrame||global.mozCancelAnimationFrame||global.msCancelAnimationFrame,enumerable:!1},_frameTime:{value:null},_oldSource:{value:null},_diff:{value:function(e,t){function n(e){return void 0===e||null===e}for(var i={},s={},o=0;o<t.length;o++)n(i[t[o]])&&(i[t[o]]={rows:[],o:null}),i[t[o]].rows.push(o);for(o=0;o<e.length;o++)n(s[e[o]])&&(s[e[o]]={rows:[],n:null}),s[e[o]].rows.push(o);for(o in i)1!==i[o].rows.length||n(s[o])||1!==s[o].rows.length||(t[i[o].rows[0]]={text:t[i[o].rows[0]],row:s[o].rows[0]},e[s[o].rows[0]]={text:e[s[o].rows[0]],row:i[o].rows[0]});for(o=0;o<t.length-1;o++)!n(t[o].text)&&n(t[o+1].text)&&t[o].row+1<e.length&&n(e[t[o].row+1].text)&&t[o+1]===e[t[o].row+1]&&(t[o+1]={text:t[o+1],row:t[o].row+1},e[t[o].row+1]={text:e[t[o].row+1],row:o+1});for(o=t.length-1;o>0;o--)!n(t[o].text)&&n(t[o-1].text)&&t[o].row>0&&n(e[t[o].row-1].text)&&t[o-1]===e[t[o].row-1]&&(t[o-1]={text:t[o-1],row:t[o].row-1},e[t[o].row-1]={text:e[t[o].row-1],row:o-1});return{o:e,n:t}}},_previousDrawDate:{enumerable:!1,value:0},_documentResources:{value:null},_needsStylesheetsDraw:{value:!1},_stylesheets:{value:[]},addStylesheet:{value:function(e){this._stylesheets.push(e),this._needsStylesheetsDraw=!0}},_addedStyleSheetsByTemplate:{value:null},addStyleSheetsFromTemplate:{value:function(e){if(!this._addedStyleSheetsByTemplate.has(e)){for(var t,n=e.getResources(),i=this.element.ownerDocument,s=n.createStylesForDocument(i),o=0;t=s[o];o++)this.addStylesheet(t);this._addedStyleSheetsByTemplate.set(e,!0)}}},__bufferDocumentFragment:{value:null},_bufferDocumentFragment:{get:function(){return this.__bufferDocumentFragment||(this.__bufferDocumentFragment=this._element.ownerDocument.createDocumentFragment())}},drawStylesheets:{value:function(){for(var e,t=this._documentResources,n=this._stylesheets,i=t._document.head,s=this._bufferDocumentFragment;e=n.shift();)t.addStyle(e,s);i.insertBefore(s,i.firstChild),this._needsStylesheetsDraw=!1}},drawTree:{value:function(){if(null===this.requestedAnimationFrame){var e=this.requestAnimationFrame;if(e)this.requestedAnimationFrame=e.call(window,this._drawTree);else{var t=Date.now(),n=17-t+this._previousDrawDate;n<0&&(n=0),this.requestedAnimationFrame=setTimeout(this._drawTree,n),this._previousDrawDate=t+n}this._scheduleComposerRequest=!1}},enumerable:!1},_drawTree:{value:function(e){var t;if(this._needsStylesheetsDraw&&this.drawStylesheets(),!this._documentResources.areStylesLoaded)return g.isDebug&&console.log("Draw Cycle Waiting Stylesheets: ",this._documentResources._expectedStyles.length),this.requestedAnimationFrame=null,void this.drawTree();if(g.isDebug&&(t=window.performance?window.performance.now():Date.now()),this._frameTime=e?e:Date.now(),this._clearNeedsDrawTimeOut&&this._clearNeedsDrawList(),w.isDebug){var n=document.body.innerHTML;if(this._oldSource&&n!==this._oldSource){for(var i=["DOM modified outside of the draw loop"],s=this._diff(this._oldSource.split("\n"),n.split("\n")),o=0;o<s.n.length;o++)if(void 0===s.n[o].text||null===s.n[o].text)i.push("+ "+s.n[o]);else for(var a=s.n[o].row+1;a<s.o.length&&(void 0===s.o[a].text||null===s.o[a].text);a++)i.push("- "+s.o[a]);console.warn(i.join("\n"))}console.group((e?w.toTimeString(new Date(e))+" ":"")+"Draw Fired")}if(this.drawIfNeeded(),g.isDebug){var r;r=window.performance?window.performance.now():Date.now(),console.log("Draw Cycle Time: ",r-t,", Components: ",this._lastDrawComponentsCount)}w.isDebug&&(console.groupEnd(),this._oldSource=document.body.innerHTML),this._frameTime=null,this._scheduleComposerRequest&&this.drawTree()}},_readyToDrawList:{enumerable:!1,value:[]},_readyToDrawListIndex:{enumerable:!1,value:null},addToDrawCycle:{value:function(e){var t=this._readyToDrawListIndex;return t.has(e)?void(w.isDebug&&this!==o&&w.debug(i(this)+" added to the draw cycle twice, this should not happen.")):(this._readyToDrawList.push(e),this._readyToDrawListIndex.set(e,!0),void e._updateComponentDom())}},_lastDrawComponentsCount:{value:null},_sortByLevel:{value:function(e,t){return e._treeLevel-t._treeLevel}},drawIfNeeded:{value:function(){var e,t,n,s,o,a,r=this._readyToDrawList,l=0,u=this._composerList,m=w.isDebug;if(r.length=0,this._readyToDrawListIndex.clear(),u&&(a=u.length)>0){for(this._composerList=this.composerListSwap,t=0;t<a;t++)o=u[t],o.needsFrame=!1,o.frame(this._frameTime);u.length=0,this._composerListSwap=u}for(this._drawIfNeeded(0),n=r.length,m&&console.groupCollapsed("willDraw - "+r.length+(r.length>1?" components.":" component."));l<n;){for(t=l;t<n;t++)e=r[t],"function"==typeof e.willDraw&&e.willDraw(this._frameTime),m&&w.debug("Level "+e._treeLevel+" "+i(e));this._drawIfNeeded(0),l=n,n=r.length}for(m&&(console.groupEnd(),console.group("draw - "+r.length+(r.length>1?" components.":" component."))),r.sort(this._sortByLevel),t=0;t<n;t++)e=r[t],e.needsDraw=!1;for(this.requestedAnimationFrame=null,t=n-1;t>=0;t--)e=r[t],e._draw(this._frameTime),e.draw(this._frameTime),m&&w.debug("Level "+e._treeLevel+" "+i(e));for(m&&(console.groupEnd(),console.groupCollapsed("didDraw - "+r.length+(r.length>1?" components.":" component."))),this._didDrawEvent||(this._didDrawEvent=new CustomEvent("didDraw",{bubbles:!1})),t=0;t<n;t++)e=r[t],e.dispatchEvent(this._didDrawEvent),e.didDraw(this._frameTime),e._completedFirstDraw||(s=document.createEvent("CustomEvent"),s.initCustomEvent("firstDraw",!0,!1,null),e.dispatchEvent(s),e._completedFirstDraw=!0),m&&w.debug("Level "+e._treeLevel+" "+i(e));return this._completedFirstDraw||(s=document.createEvent("CustomEvent"),s.initCustomEvent("firstDraw",!0,!1,null),this.dispatchEvent(s),this._completedFirstDraw=!0),m&&console.groupEnd(),g.isDebug&&(this._lastDrawComponentsCount=r.length),!!r.length}},element:{get:function(){return this._element},set:function(e){c.registerEventHandlerForElement(this,e),this._element=e.documentElement,this._documentResources=m.getInstanceForDocument(e)}},willDraw:{value:function(){this.dragManager.willDraw()}},draw:{value:function(){this.dragManager.draw()}}});t.__root__=o=(new F).init(),I.addAttributes({accesskey:null,contenteditable:null,contextmenu:null,dir:null,draggable:null,dropzone:null,hidden:{dataType:"boolean"},lang:null,spellcheck:null,tabindex:null,title:null})}});