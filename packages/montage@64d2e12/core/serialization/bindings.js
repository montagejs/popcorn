var Bindings=require("frb"),stringify=require("frb/stringify"),assign=require("frb/assign"),evaluate=require("frb/evaluate"),expand=require("frb/expand"),Scope=require("frb/scope"),Serializer=require("../serialization/serializer/montage-serializer").MontageSerializer,ONE_ASSIGNMENT="=",ONE_WAY="<-",TWO_WAY="<->",serializeObjectBindings=exports.serializeObjectBindings=function(e,i){for(var r,n,t=Bindings.getBindings(i),a={},s=t.keys();n=s.next().value;){var o=t.get(n),c={};if((!("serializable"in o)||o.serializable)&&o.sourceSyntax){var l,u=o.sourcePath,f=o.sourceSyntax;if(o.source&&o.source!==i){var g=e.getObjectLabel(o.source);l=new Scope({type:"component",label:g}),l.components=e,f=expand(f,l)}l=new Scope,l.components=e,u=stringify(f,l),o.twoWay?c[TWO_WAY]=u:c[ONE_WAY]=u,o.converter?c.converter=o.converter:(c.convert=o.convert,c.revert=o.revert),o.trace&&(c.trace=!0),a[n]=c,r=!0}}return r?a:void 0};Serializer.defineSerializationUnit("bindings",serializeObjectBindings);var deserializeObjectBindings=exports.deserializeObjectBindings=function(e,i,r){var n,t,a={components:e};for(n in r){if(t=r[n],"object"!=typeof t){if(n.indexOf(".")===-1)throw new Error("Binding descriptor must be an object, not "+typeof t);t={"=":""+t}}if(ONE_ASSIGNMENT in t){var s=t[ONE_ASSIGNMENT];assign(i,n,"string"==typeof s?evaluate(s,i,null,null,e):s,null,null,e)}else Bindings.defineBinding(i,n,t,a)}};