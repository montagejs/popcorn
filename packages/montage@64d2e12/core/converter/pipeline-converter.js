var Converter=require("./converter").Converter,Promise=require("core/promise").Promise,Set=require("collections/set");exports.PipelineConverter=Converter.specialize({constructor:{value:function(){this["super"](),this.addRangeAtPathChangeListener("converters",this,"_handleConvertersRangeChange")}},_handleConvertersRangeChange:{value:function(e,r,t){var n,o,i=new Set(e),v=new Set(r);for(o=0;n=r[o];++o)i.has(n)||(n.owner=null);for(o=0;n=e[o];++o)v.has(n)||(n.owner=n.owner||this)}},deserializeSelf:{value:function(e){var r;r=e.getProperty("converters"),void 0!==r&&(this.converters=r)}},serializeSelf:{value:function(e){this.converters.length>0&&e.setProperty("converters",this.converters)}},converters:{value:void 0},convert:{value:function(e){return this._convertWithConverterAtIndex(e,0)}},_convertWithConverterAtIndex:{value:function(e,r){var t,n=this,o=this.converters[r],i=o.convert(e),v=r===this.converters.length-1,s=this._isThenable(i);return r++,t=v?s?i:Promise.resolve(i):s?i.then(function(e){return n._convertWithConverterAtIndex(e,r)}):this._convertWithConverterAtIndex(i,r)}},_isThenable:{value:function(e){return!(!e||!e.then||"function"!=typeof e.then)}},revert:{value:function(e){return this._revertWithConverterAtIndex(e,this.converters.length-1)}},_revertWithConverterAtIndex:{value:function(e,r){var t,n=this,o=this.converters[r],i=o.revert(e),v=0===r,s=this._isThenable(i);return r--,t=v?s?i:Promise.resolve(i):s?i.then(function(e){return n._revertWithConverterAtIndex(e,r)}):this._revertWithConverterAtIndex(i,r)}}});