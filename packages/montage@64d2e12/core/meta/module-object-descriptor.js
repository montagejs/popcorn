function getModuleRequire(e,t){for(var r=e.resolve(t),o=e.getModuleDescriptor(r);o.redirect||o.mappingRedirect;)o.redirect?r=o.redirect:(e=o.mappingRequire,r=o.mappingRedirect),o=e.getModuleDescriptor(r);return o.require}var Montage=require("../core").Montage,Promise=require("../promise").Promise,ObjectDescriptor=require("./object-descriptor").ObjectDescriptor,Deserializer=require("../serialization/deserializer/montage-deserializer").MontageDeserializer,ModuleReference=require("../module-reference").ModuleReference,deprecate=require("../deprecate"),OBJECT_DESCRIPTOR_CACHE=Object.create(null),ModuleObjectDescriptor=exports.ModuleObjectDescriptor=ObjectDescriptor.specialize({initWithModuleAndExportName:{value:function(e,t){var r=ObjectDescriptor.prototype.initWithName.call(this,t);return r.module=e,r.exportName=t,r}},serializeSelf:{value:function(e){if(!this.module)throw new Error("Cannot serialize object descriptor without a module reference");if(!this.exportName)throw new Error("Cannot serialize object descriptor without an exportName");this["super"](e),this._setPropertyWithDefaults(e,"module",this.module),this._setPropertyWithDefaults(e,"exportName",this.exportName),this.object&&this._setPropertyWithDefaults(e,"object",this.object)}},deserializeSelf:{value:function(e){this["super"](e);var t;if(t=e.getProperty("module"),void 0!==t&&(this.module=t),t=e.getProperty("exportName")||this.exportName,void 0!==t&&(this.exportName=t),!this.module)throw new Error("Cannot deserialize object descriptor without a module reference");if(!this.exportName)throw new Error("Cannot deserialize object descriptor without an exportName");t=e.getProperty("object"),void 0!==t&&(this.object=t)}},module:{value:null},object:{value:null},exportName:{value:null},objectDescriptorInstanceModule:{serializable:!1,value:null}},{getObjectDescriptorWithModuleId:{value:function(e,t){if(e.search(/\.meta$/)===-1&&e.search(/\.mjson$/)===-1)throw new Error(e+" object descriptor module id does not end in '.meta' or '.mjson'");if(!t)throw new Error("Require needed to get object descriptor "+e);var r=t.location+"#"+e;return r in OBJECT_DESCRIPTOR_CACHE?OBJECT_DESCRIPTOR_CACHE[r]:OBJECT_DESCRIPTOR_CACHE[r]=t.async(e).then(function(r){var o=r.montageObject,i=Deserializer.getModuleRequire(t,e);if(!ModuleObjectDescriptor.prototype.isPrototypeOf(o))throw new Error("Object in "+e+" is not a module-object-descriptor");return o.objectDescriptorInstanceModule=(new ModuleReference).initWithIdAndRequire(e,t),o._parentReference?o._parentReference.promise(i).then(function(e){return o._parent=e,o}):o})}},createDefaultObjectDescriptorForObject:{value:function(e){var t=Montage.getInfoForObject(e).isInstance?Object.getPrototypeOf(e):e,r=Montage.getInfoForObject(t);return r.objectName&&r.moduleId?this["super"](e).then(function(e){return e.module=(new ModuleReference).initWithIdAndRequire(r.moduleId,r.require),e.exportName=r.objectName,e}):Promise.reject("Cannot create module-object-descriptor for an object that has no been loaded from a module")}},getBlueprintWithModuleId:{value:deprecate.deprecateMethod(void 0,function(e,t){return ModuleObjectDescriptor.getObjectDescriptorWithModuleId(e,t)},"ModuleBlueprint.getBlueprintWithModuleId","ModuleObjectDescriptor.getObjectDescriptorWithModuleId")},createDefaultBlueprintForObject:{value:deprecate.deprecateMethod(void 0,function(e){return ModuleObjectDescriptor.createDefaultObjectDescriptorForObject(e)},"ModuleBlueprint.createDefaultBlueprintForObject","ModuleObjectDescriptor.createDefaultObjectDescriptorForObject")}});