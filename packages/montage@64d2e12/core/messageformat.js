function MessageFormat(l,n){var r;if(l&&n&&(MessageFormat.locale[l]=n),r=l=l||"en",n=n||MessageFormat.locale[r=MessageFormat.Utils.getFallbackLocale(l)],!n)throw new Error("Plural Function not found for locale: "+l);this.pluralFunc=n,this.locale=l,this.fallbackLocale=r}MessageFormat.locale={en:function(l){return 1===l?"one":"other"}},MessageFormat.SafeString=function(l){this.string=l},MessageFormat.SafeString.prototype.toString=function(){return this.string.toString()},MessageFormat.Utils={numSub:function(l,n,r){return l.replace(/^#|[^\\]#/g,function(l){var e=l&&2===l.length?l.charAt(0):"";return e+'" + (function(){ var x = '+n+';\nif( isNaN(x) ){\nthrow new Error("MessageFormat: `"+lastkey_'+r+'+"` isnt a number.");\n}\nreturn x;\n})() + "'})},escapeExpression:function(l){var n={"\n":"\\n",'"':'\\"'},r=/[\n"]/g,e=/[\n"]/,u=function(l){return n[l]||"&amp;"};return l instanceof MessageFormat.SafeString?l.toString():null===l||l===!1?"":e.test(l)?l.replace(r,u):l},getFallbackLocale:function(l){for(var n=l.indexOf("-")>=0?"-":"_";!MessageFormat.locale.hasOwnProperty(l);)if(l=l.substring(0,l.lastIndexOf(n)),0===l.length)return null;return l}};var mparser=function(){var l={parse:function(l,n){function r(l,n,r){for(var e=l,u=r-l.length,t=0;t<u;t++)e=n+e;return e}function e(l){var n,e,u=l.charCodeAt(0);return u<=255?(e="x",n=2):(e="u",n=4),"\\"+e+r(u.toString(16).toUpperCase(),"0",n)}function u(l){return'"'+l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,e)+'"'}function t(l){E<N||(E>N&&(N=E,O=[]),O.push(l))}function a(){var n="whitespace@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e;return null!==l.substr(E).match(/^[   \n\r]/)?(e=l.charAt(E),E++):(e=null,A&&t("[  \\n\\r]")),I[n]={nextPos:E,result:e},e}function s(){var l="_@"+E,n=I[l];if(n)return E=n.nextPos,n.result;var r=A;A=!1;for(var e=E,u=[],s=a();null!==s;)u.push(s),s=a();var o,f=null!==u?function(l){return l.join("")}(u):null;return null!==f?o=f:(o=null,E=e),A=r,A&&null===o&&t("whitespace"),I[l]={nextPos:E,result:o},o}function o(){var n="digits@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e,u=E;null!==l.substr(E).match(/^[0-9]/)?(e=l.charAt(E),E++):(e=null,A&&t("[0-9]"));var a;if(null!==e)for(a=[];null!==e;)a.push(e),null!==l.substr(E).match(/^[0-9]/)?(e=l.charAt(E),E++):(e=null,A&&t("[0-9]"));else a=null;var s,o=null!==a?function(l){return parseInt(l.join(""),10)}(a):null;return null!==o?s=o:(s=null,E=u),I[n]={nextPos:E,result:s},s}function f(){var n="offsetPattern@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e,u=E,a=E,f=s();if(null!==f){var i;if("offset"===l.substr(E,6)?(i="offset",E+=6):(i=null,A&&t('"offset"')),null!==i){var c=s();if(null!==c){var v;if(":"===l.substr(E,1)?(v=":",E+=1):(v=null,A&&t('":"')),null!==v){var p=s();if(null!==p){var m=o();if(null!==m){var h=s();null!==h?e=[f,i,c,v,p,m,h]:(e=null,E=a)}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a;var g,F=null!==e?function(l){return l}(e[5]):null;return null!==F?g=F:(g=null,E=u),I[n]={nextPos:E,result:g},g}function i(){var n="id@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e,u=E,a=E,o=s();if(null!==o){var f;if(null!==l.substr(E).match(/^[a-zA-Z$_]/)?(f=l.charAt(E),E++):(f=null,A&&t("[a-zA-Z$_]")),null!==f){var i,c=[];for(null!==l.substr(E).match(/^[^  \n\r,.+={}]/)?(i=l.charAt(E),E++):(i=null,A&&t("[^   \\n\\r,.+={}]"));null!==i;)c.push(i),null!==l.substr(E).match(/^[^  \n\r,.+={}]/)?(i=l.charAt(E),E++):(i=null,A&&t("[^   \\n\\r,.+={}]"));if(null!==c){var v=s();null!==v?e=[o,f,c,v]:(e=null,E=a)}else e=null,E=a}else e=null,E=a}else e=null,E=a;var p,m=null!==e?function(l,n){return l+(n?n.join(""):"")}(e[1],e[2]):null;return null!==m?p=m:(p=null,E=u),I[n]={nextPos:E,result:p},p}function c(){var n="stringKey@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e,u=E,a=i(),s=null!==a?function(l){return l}(a):null;null!==s?e=s:(e=null,E=u);var f;if(null!==e)f=e;else{var c,v=E,p=E;"="===l.substr(E,1)?(c="=",E+=1):(c=null,A&&t('"="'));var m;if(null!==c){var h=o();null!==h?m=[c,h]:(m=null,E=p)}else m=null,E=p;var g,F=null!==m?function(l){return l}(m[1]):null;null!==F?g=F:(g=null,E=v),f=null!==g?g:null}return I[n]={nextPos:E,result:f},f}function v(){var n="hexDigit@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e;return null!==l.substr(E).match(/^[0-9a-fA-F]/)?(e=l.charAt(E),E++):(e=null,A&&t("[0-9a-fA-F]")),I[n]={nextPos:E,result:e},e}function p(){var n="char@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e,u=E;null!==l.substr(E).match(j)?(e=l.charAt(E),E++):(e=null,A&&t(j));var a,s=null!==e?function(l){return l}(e):null;null!==s?a=s:(a=null,E=u);var o;if(null!==a)o=a;else{var f,i=E;"\\#"===l.substr(E,2)?(f="\\#",E+=2):(f=null,A&&t('"\\\\#"'));var c,p=null!==f?function(){return"\\#"}():null;if(null!==p?c=p:(c=null,E=i),null!==c)o=c;else{var m,h=E;"\\{"===l.substr(E,2)?(m="\\{",E+=2):(m=null,A&&t('"\\\\{"'));var g,F=null!==m?function(){return"{"}():null;if(null!==F?g=F:(g=null,E=h),null!==g)o=g;else{var x,P=E;"\\}"===l.substr(E,2)?(x="\\}",E+=2):(x=null,A&&t('"\\\\}"'));var _,y=null!==x?function(){return"}"}():null;if(null!==y?_=y:(_=null,E=P),null!==_)o=_;else{var d,b=E,S=E;"\\u"===l.substr(E,2)?(d="\\u",E+=2):(d=null,A&&t('"\\\\u"'));var w;if(null!==d){var M=v();if(null!==M){var k=v();if(null!==k){var N=v();if(null!==N){var O=v();null!==O?w=[d,M,k,N,O]:(w=null,E=S)}else w=null,E=S}else w=null,E=S}else w=null,E=S}else w=null,E=S;var R,U=null!==w?function(l,n,r,e){return String.fromCharCode(parseInt("0x"+l+n+r+e))}(w[1],w[2],w[3],w[4]):null;null!==U?R=U:(R=null,E=b),o=null!==R?R:null}}}}return I[n]={nextPos:E,result:o},o}function m(){var l="chars@"+E,n=I[l];if(n)return E=n.nextPos,n.result;var r,e=E,u=p();if(null!==u)for(r=[];null!==u;)r.push(u),u=p();else r=null;var t,a=null!==r?function(l){return l.join("")}(r):null;return null!==a?t=a:(t=null,E=e),I[l]={nextPos:E,result:t},t}function h(){var l="string@"+E,n=I[l];if(n)return E=n.nextPos,n.result;var r,e=E,u=E,t=s();if(null!==t){var a,o,f,i=[],c=E,v=s();for(null!==v?(f=m(),null!==f?(a=s(),null!==a?o=[v,f,a]:(o=null,E=c)):(o=null,E=c)):(o=null,E=c);null!==o;)i.push(o),c=E,v=s(),null!==v?(f=m(),null!==f?(a=s(),null!==a?o=[v,f,a]:(o=null,E=c)):(o=null,E=c)):(o=null,E=c);null!==i?r=[t,i]:(r=null,E=u)}else r=null,E=u;var p,h=null!==r?function(l,n){for(var r=[],e=0;e<n.length;++e)for(var u=0;u<n[e].length;++u)r.push(n[e][u]);return{type:"string",val:l+r.join("")}}(r[0],r[1]):null;return null!==h?p=h:(p=null,E=e),I[l]={nextPos:E,result:p},p}function g(){var n="messageFormatElement@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e,u=E,a=E,s=i();if(null!==s){var o,f=E;","===l.substr(E,1)?(o=",",E+=1):(o=null,A&&t('","'));var c;if(null!==o){var v=k();null!==v?c=[o,v]:(c=null,E=f)}else c=null,E=f;var p=null!==c?c:"";null!==p?e=[s,p]:(e=null,E=a)}else e=null,E=a;var m,h=null!==e?function(l,n){var r={type:"messageFormatElement",argumentIndex:l};return n&&n.length?r.elementFormat=n[1]:r.output=!0,r}(e[0],e[1]):null;return null!==h?m=h:(m=null,E=u),I[n]={nextPos:E,result:m},m}function F(){var n="messageFormatPatternRight@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e,u=E,a=E;"{"===l.substr(E,1)?(e="{",E+=1):(e=null,A&&t('"{"'));var o;if(null!==e){var f=s();if(null!==f){var i=g();if(null!==i){var c=s();if(null!==c){var v;if("}"===l.substr(E,1)?(v="}",E+=1):(v=null,A&&t('"}"')),null!==v){var p=h();null!==p?o=[e,f,i,c,v,p]:(o=null,E=a)}else o=null,E=a}else o=null,E=a}else o=null,E=a}else o=null,E=a}else o=null,E=a;var m,F=null!==o?function(l,n){var r=[];return l&&r.push(l),n&&n.val&&r.push(n),{type:"messageFormatPatternRight",statements:r}}(o[2],o[5]):null;return null!==F?m=F:(m=null,E=u),I[n]={nextPos:E,result:m},m}function x(){var l="messageFormatPattern@"+E,n=I[l];if(n)return E=n.nextPos,n.result;var r,e=E,u=E,t=h();if(null!==t){for(var a=[],s=F();null!==s;)a.push(s),s=F();null!==a?r=[t,a]:(r=null,E=u)}else r=null,E=u;var o,f=null!==r?function(l,n){var r=[];l&&l.val&&r.push(l);for(var e in n)n.hasOwnProperty(e)&&r.push(n[e]);return{type:"messageFormatPattern",statements:r}}(r[0],r[1]):null;return null!==f?o=f:(o=null,E=e),I[l]={nextPos:E,result:o},o}function P(){var n="pluralForms@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e,u=E,a=E,o=s();if(null!==o){var f=c();if(null!==f){var i=s();if(null!==i){var v;if("{"===l.substr(E,1)?(v="{",E+=1):(v=null,A&&t('"{"')),null!==v){var p=s();if(null!==p){var m=x();if(null!==m){var h=s();if(null!==h){var g;"}"===l.substr(E,1)?(g="}",E+=1):(g=null,A&&t('"}"')),null!==g?e=[o,f,i,v,p,m,h,g]:(e=null,E=a)}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a;var F,P=null!==e?function(l,n){return{type:"pluralForms",key:l,val:n}}(e[1],e[5]):null;return null!==P?F=P:(F=null,E=u),I[n]={nextPos:E,result:F},F}function _(){var l="selectFormatPattern@"+E,n=I[l];if(n)return E=n.nextPos,n.result;for(var r=E,e=[],u=P();null!==u;)e.push(u),u=P();var t,a=null!==e?function(l){return{type:"selectFormatPattern",pluralForms:l}}(e):null;return null!==a?t=a:(t=null,E=r),I[l]={nextPos:E,result:t},t}function y(){var l="selectStyle@"+E,n=I[l];if(n)return E=n.nextPos,n.result;var r,e=E,u=_(),t=null!==u?function(l){return{type:"selectStyle",val:l}}(u):null;return null!==t?r=t:(r=null,E=e),I[l]={nextPos:E,result:r},r}function d(){var l="pluralFormatPattern@"+E,n=I[l];if(n)return E=n.nextPos,n.result;var r,e=E,u=E,t=f(),a=null!==t?t:"";if(null!==a){for(var s=[],o=P();null!==o;)s.push(o),o=P();null!==s?r=[a,s]:(r=null,E=u)}else r=null,E=u;var i,c=null!==r?function(l,n){var r={type:"pluralFormatPattern",pluralForms:n};return l?r.offset=l:r.offset=0,r}(r[0],r[1]):null;return null!==c?i=c:(i=null,E=e),I[l]={nextPos:E,result:i},i}function b(){var l="pluralStyle@"+E,n=I[l];if(n)return E=n.nextPos,n.result;var r,e=E,u=d(),t=null!==u?function(l){return{type:"pluralStyle",val:l}}(u):null;return null!==t?r=t:(r=null,E=e),I[l]={nextPos:E,result:r},r}function S(){var l="start@"+E,n=I[l];if(n)return E=n.nextPos,n.result;var r,e=E,u=x(),t=null!==u?function(l){return{type:"program",program:l}}(u):null;return null!==t?r=t:(r=null,E=e),I[l]={nextPos:E,result:r},r}function w(){function n(l){l.sort();for(var n=null,r=[],e=0;e<l.length;e++)l[e]!==n&&(r.push(l[e]),n=l[e]);switch(r.length){case 0:return"end of input";case 1:return r[0];default:return r.slice(0,r.length-1).join(", ")+" or "+r[r.length-1]}}var r=n(O),e=Math.max(E,N),t=e<l.length?u(l.charAt(e)):"end of input";return"Expected "+r+" but "+t+" found."}function M(){for(var n=1,r=1,e=!1,u=0;u<N;u++){var t=l.charAt(u);"\n"===t?(e||n++,r=1,e=!1):"\r"===t|"\u2028"===t||"\u2029"===t?(n++,r=1,e=!0):(r++,e=!1)}return{line:n,column:r}}var k,E=0,A=!0,N=0,O=[],I={},j="^[^{}\\\0-     \n\r]";new RegExp("/"+j+"/");k=function(){var n="elementFormat@"+E,r=I[n];if(r)return E=r.nextPos,r.result;var e,u=E,a=E,o=s();if(null!==o){var f;if("plural"===l.substr(E,6)?(f="plural",E+=6):(f=null,A&&t('"plural"')),null!==f){var i=s();if(null!==i){var c;if(","===l.substr(E,1)?(c=",",E+=1):(c=null,A&&t('","')),null!==c){var v=s();if(null!==v){var p=b();if(null!==p){var m=s();null!==m?e=[o,f,i,c,v,p,m]:(e=null,E=a)}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a}else e=null,E=a;var h,g=null!==e?function(l,n){return{type:"elementFormat",key:l,val:n.val}}(e[1],e[5]):null;null!==g?h=g:(h=null,E=u);var F,x;if(null!==h)F=h;else{var P=E,_=E,d=s();if(null!==d){var S;if("select"===l.substr(E,6)?(S="select",E+=6):(S=null,A&&t('"select"')),null!==S){var w=s();if(null!==w){var M;if(","===l.substr(E,1)?(M=",",E+=1):(M=null,A&&t('","')),null!==M){var k=s();if(null!==k){var N=y();if(null!==N){var O=s();null!==O?x=[d,S,w,M,k,N,O]:(x=null,E=_)}else x=null,E=_}else x=null,E=_}else x=null,E=_}else x=null,E=_}else x=null,E=_}else x=null,E=_;var j,R=null!==x?function(l,n){return{type:"elementFormat",key:l,val:n.val}}(x[1],x[5]):null;null!==R?j=R:(j=null,E=P),F=null!==j?j:null}return I[n]={nextPos:E,result:F},F};var R={_:s,"char":p,chars:m,digits:o,elementFormat:k,hexDigit:v,id:i,messageFormatElement:g,messageFormatPattern:x,messageFormatPatternRight:F,offsetPattern:f,pluralFormatPattern:d,pluralForms:P,pluralStyle:b,selectFormatPattern:_,selectStyle:y,start:S,string:h,stringKey:c,whitespace:a};if(void 0!==n){if(void 0===R[n])throw new Error("Invalid rule name: "+u(n)+".")}else n="start";var U=R[n]();if(null===U||E!==l.length){var C=M();throw new this.SyntaxError(w(),C.line,C.column)}return U},toSource:function(){return this._source}};return l.SyntaxError=function(l,n,r){this.name="SyntaxError",this.message=l,this.line=n,this.column=r},l.SyntaxError.prototype=Error.prototype,l}();MessageFormat.prototype.parse=function(){return mparser.parse.apply(mparser,arguments)},MessageFormat.prototype.precompile=function(l){function n(l,t){t=t||{};var a,s,o,f,i="";switch(l.type){case"program":return n(l.program);case"messageFormatPattern":for(s=0;s<l.statements.length;++s)i+=n(l.statements[s],t);return u.begin+i+u.end;case"messageFormatPatternRight":for(s=0;s<l.statements.length;++s)i+=n(l.statements[s],t);return i;case"messageFormatElement":return t.pf_count=t.pf_count||0,i+='if(!d){\nthrow new Error("MessageFormat: No data passed to function.");\n}\n',l.output?i+='r += d["'+l.argumentIndex+'"];\n':(f="lastkey_"+(t.pf_count+1),i+="var "+f+' = "'+l.argumentIndex+'";\n',i+="var k_"+(t.pf_count+1)+"=d["+f+"];\n",i+=n(l.elementFormat,t)),i;case"elementFormat":return"select"===l.key?(i+=n(l.val,t),i+="r += (pf_"+t.pf_count+"[ k_"+(t.pf_count+1)+" ] || pf_"+t.pf_count+'[ "other" ])( d );\n'):"plural"===l.key&&(i+=n(l.val,t),i+="if ( pf_"+t.pf_count+"[ k_"+(t.pf_count+1)+' + "" ] ) {\n',i+="r += pf_"+t.pf_count+"[ k_"+(t.pf_count+1)+' + "" ]( d ); \n',i+="}\nelse {\n",i+="r += (pf_"+t.pf_count+'[ MessageFormat.locale["'+r.fallbackLocale+'"]( k_'+(t.pf_count+1)+" - off_"+t.pf_count+" ) ] || pf_"+t.pf_count+'[ "other" ] )( d );\n',i+="}\n"),i;case"pluralFormatPattern":for(t.pf_count=t.pf_count||0,i+="var off_"+t.pf_count+" = "+l.offset+";\n",i+="var pf_"+t.pf_count+" = { \n",e=!0,s=0;s<l.pluralForms.length;++s)"other"===l.pluralForms[s].key&&(e=!1),o?i+=",\n":o=1,a=JSON.parse(JSON.stringify(t)),a.pf_count++,i+='"'+l.pluralForms[s].key+'" : '+n(l.pluralForms[s].val,a);if(i+="\n};\n",e)throw new Error("No 'other' form found in pluralFormatPattern "+t.pf_count);return i;case"selectFormatPattern":for(t.pf_count=t.pf_count||0,i+="var off_"+t.pf_count+" = 0;\n",i+="var pf_"+t.pf_count+" = { \n",e=!0,s=0;s<l.pluralForms.length;++s)"other"===l.pluralForms[s].key&&(e=!1),o?i+=",\n":o=1,a=JSON.parse(JSON.stringify(t)),a.pf_count++,i+='"'+l.pluralForms[s].key+'" : '+n(l.pluralForms[s].val,a);if(i+="\n};\n",e)throw new Error("No 'other' form found in selectFormatPattern "+t.pf_count);return i;case"string":return'r += "'+MessageFormat.Utils.numSub(MessageFormat.Utils.escapeExpression(l.val),"k_"+t.pf_count+" - off_"+(t.pf_count-1),t.pf_count)+'";\n';default:throw new Error("Bad AST type: "+l.type)}}var r=this,e=!1,u={begin:'function(d){\nvar r = "";\n',end:"return r;\n}"};return n(l)},MessageFormat.prototype.compile=function(l){return new Function("MessageFormat","return "+this.precompile(this.parse(l)))(MessageFormat)},module.exports=MessageFormat;