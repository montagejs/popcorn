function getAttributeProperties(e,t,r){var o=r||(t===SERIALIZABLE?_serializableAttributeProperties:UNDERSCORE+t+ATTRIBUTE_PROPERTIES);return e!==Object.prototype?e.hasOwnProperty(o)?e[o]:Object.defineProperty(e,o,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(getAttributeProperties(Object.getPrototypeOf(e),t,o))})[o]:(ObjectAttributeProperties.has(t)||ObjectAttributeProperties.set(t,{}),ObjectAttributeProperties.get(t))}function _superMethodDependenciesFor(e){var t=_superMethodDependenciesMap.get(e);return t||_superMethodDependenciesMap.set(e,t=new Set),t}function __clearSuperDepencies(e,t,r){var o,n,a,i=__superWeakMap,s=Object.getOwnPropertyDescriptor(e,t);if(s)if(typeof s.value===FUNCTION&&typeof r.value===FUNCTION)for(i["delete"](s.value),o=_superMethodDependenciesFor(s.value),n=o.values();a=n.next().value;)i["delete"](a);else{if(typeof s.get===FUNCTION&&typeof r.get===FUNCTION)for(i["delete"](s.get),o=_superMethodDependenciesFor(s.get),n=o.values();a=n.next().value;)i["delete"](a);if(typeof s.set===FUNCTION&&typeof r.set===FUNCTION)for(i["delete"](s.set),o=_superMethodDependenciesFor(s.set),n=o.values();a=n.next().value;)i["delete"](a)}if(o=_superDependenciesWeakMap.get(e))for(n=o.values();a=n.next().value;)__clearSuperDepencies(a,t,r)}function _superDependenciesFor(e){var t=_superDependenciesWeakMap.get(e);return t||_superDependenciesWeakMap.set(e,t=new Set),t}function __findSuperMethodImplementation(e,t,r,o,n,a,i){var s,p,u,c,l,g,f,d,b,h,P=global.Object,y=n,_=a,v=i;for(f=b=r?t:t.prototype;!h&&null!==b;){if(g){if(c=P.getOwnPropertyDescriptor(b,g)){if(c.hasOwnProperty("value")){l=c.value,h=!0;break}if(_&&c.hasOwnProperty("get")){l=c.get,h=!0;break}if(v&&c.hasOwnProperty("set")){l=c.set,h=!0;break}}}else for(s=o?(_propertyNames[0]=o)&&_propertyNames:P.getOwnPropertyNames(b),p=0;u=s[p];p++)if(c=P.getOwnPropertyDescriptor(b,u))if(l=c.value,void 0!==l&&null!==l){if(l===e||l.deprecatedFunction===e){g=u,y=!0;break}}else{if(l=c.get,void 0!==l&&null!==l&&(l===e||l.deprecatedFunction===e)){g=u,_=!0;break}if(l=c.set,void 0!==l&&null!==l&&(l===e||l.deprecatedFunction===e)){g=u,v=!0;break}}d=b,(b=P.getPrototypeOf(b))&&_superDependenciesFor(b).add(d)}return h&&typeof l===FUNCTION?l:Function.noop}function __super(e,t,r,o,n){if(e||t){var a=__superWeakMap.get(e);if(!a){var i=typeof this===FUNCTION;a=__findSuperMethodImplementation(e,i?this:this.constructor,i,t,r,o,n),a&&(__superWeakMap.set(e,a),_superMethodDependenciesFor(a).add(e))}return a}}function _super(){var e=_super&&_super.caller?_super.caller:arguments.callee.caller,t=__super.call(this,e);return t?t.apply(this,arguments):void 0}function _superForValue(e){var t=_superForValue&&_superForValue.caller?_superForValue.caller:arguments.callee.caller,r=__super.call(this,t,e,!0,!1,!1);return r?r.bind(this):Function.noop}function _superForGet(e){var t=_superForGet&&_superForGet.caller?_superForGet.caller:arguments.callee.caller,r=__super.call(this,t,e,!1,!0,!1);return r?r.bind(this):Function.noop}function _superForSet(e){var t=_superForSet&&_superForSet.caller?_superForSet.caller:arguments.callee.caller,r=__super.call(this,t,e,!1,!1,!0);return r?r.bind(this):Function.noop}require("collections/shim"),require("./shim/object"),require("./shim/array"),require("./extras/object"),require("./extras/date"),require("./extras/element"),require("./extras/function"),require("./extras/map"),require("./extras/regexp"),require("./extras/string"),require("./extras/set"),require("./extras/weak-map"),require("proxy-polyfill/proxy.min");var Map=require("collections/map"),WeakMap=require("collections/weak-map"),Set=require("collections/set"),ATTRIBUTE_PROPERTIES="AttributeProperties",UNDERSCORE="_",PROTO="__proto__",VALUE="value",ENUMERABLE="enumerable",SERIALIZABLE="serializable",FUNCTION="function",UNDERSCORE_UNICODE=95,ARRAY_PROTOTYPE=Array.prototype,OBJECT_PROTOTYPE=Object.prototype,hasProperty=OBJECT_PROTOTYPE.hasOwnProperty,accessorPropertyDescriptor={get:void 0,set:void 0,configurable:!1,enumerable:!1},valuePropertyDescriptor={value:void 0,configurable:!1,enumerable:!1,writable:!1},__superWeakMap=new WeakMap,_superDependenciesWeakMap=new WeakMap;if(!Object.create.name){var fnNamePrefixRegex=/^[\S\s]*?function\s*/,fnNameSuffixRegex=/[\s\(\/][\S\s]+$/;Object.defineProperty(Function.prototype,"name",{get:function(){var e="";return this===Function||this===Function.prototype.constructor?e="Function":this!==Function.prototype&&(e=(""+this).replace(fnNamePrefixRegex,"").replace(fnNameSuffixRegex,"")),e}})}var Montage=exports.Montage=function(){},PROTO_IS_SUPPORTED={}.__proto__===Object.prototype,PROTO_PROPERTIES_BLACKLIST={_montage_metadata:1,__state__:1,_hasUserDefinedConstructor:1};if(Montage.defineValueProperty=function e(t,r,o,n,a,i){e.template.value=o,e.template.configurable=n,e.template.enumerable=a,e.template.writable=i,this.defineProperty(t,r,e.template)},Montage.defineValueProperty.template=valuePropertyDescriptor,Montage.defineAccessorProperty=function t(e,r,o,n,a,i){t.template.get=o,t.template.set=n,t.template.configurable=a,t.template.enumerable=i,this.defineProperty(e,r,t.template)},Montage.defineAccessorProperty.template=accessorPropertyDescriptor,valuePropertyDescriptor.value=!1,Object.defineProperty(Montage,"_hasUserDefinedConstructor",valuePropertyDescriptor),valuePropertyDescriptor.value=function(e,t){var r,o,n,a,i,s,p,u=this,c="undefined"==typeof this.specialize;if(e=e||Object.empty,t=t||Object.empty,e.constructor&&e.constructor.value?(r=e.constructor.value,r._hasUserDefinedConstructor=!0):this._hasUserDefinedConstructor?r=function(){return this["super"]()||this}:(r=function(){return this},r.name=this.name+"Specialized"),PROTO_IS_SUPPORTED)r.__proto__=u;else{for(n=Object.getOwnPropertyNames(u),s=0,p=n.length;s<p;s++)a=n[s],PROTO_PROPERTIES_BLACKLIST.hasOwnProperty(a)||(i=Object.getOwnPropertyDescriptor(r,a),i&&!i.configurable||Montage.defineProperty(r,a,Object.getOwnPropertyDescriptor(u,a)));r.__constructorProto__=u,Montage.defineProperty(r,"isPrototypeOf",{value:function(e){for(var t;null!==e;){if(t=Object.getPrototypeOf(e),t===this)return!0;e=t}return!1},enumerable:!1})}if(o=Object.create(this.prototype),c){for(n=Object.getOwnPropertyNames(Montage),s=0,p=n.length;s<p;s++)a=n[s],i=Object.getOwnPropertyDescriptor(r,a),i&&!i.configurable||Montage.defineProperty(r,a,Object.getOwnPropertyDescriptor(Montage,a));for(n=Object.getOwnPropertyNames(Montage.prototype),s=0,p=n.length;s<p;s++)a=n[s],i=Object.getOwnPropertyDescriptor(r,a),i&&!i.configurable||Montage.defineProperty(o,a,Object.getOwnPropertyDescriptor(Montage.prototype,a))}return"objectDescriptor"in e&&Montage.defineProperty(r,"objectDescriptor",e.objectDescriptor),"blueprint"in e&&Montage.defineProperty(r,"blueprint",e.blueprint),"objectDescriptorModuleId"in e&&Montage.defineProperty(r,"objectDescriptorModuleId",e.objectDescriptorModuleId),"blueprintModuleId"in e&&Montage.defineProperty(r,"blueprintModuleId",e.blueprintModuleId),Montage.defineProperties(o,e,!0),Montage.defineProperties(r,t,!0),Montage.defineProperty(r,"__isConstructor__",{value:!0,enumerable:!1}),r.prototype=o,Montage.defineValueProperty(o,"constructor",r,!0,!1,!0),Montage.defineValueProperty(r,"constructor",r,!0,!1,!0),r},valuePropertyDescriptor.writable=!1,valuePropertyDescriptor.configurable=!0,valuePropertyDescriptor.enumerable=!1,Object.defineProperty(Montage,"specialize",valuePropertyDescriptor),!PROTO_IS_SUPPORTED){var originalGetPrototypeOf=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return typeof e===FUNCTION&&e.__constructorProto__?e.__constructorProto__:originalGetPrototypeOf.apply(Object,arguments)}}var _defaultAccessorProperty={enumerable:!0,configurable:!0,serializable:!0},_defaultObjectValueProperty={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},_defaultFunctionValueProperty={writable:!0,enumerable:!1,configurable:!0},_serializableAttributeProperties="_serializableAttributeProperties";Object.defineProperty(Montage.prototype,_serializableAttributeProperties,{enumerable:!1,configurable:!1,writable:!0,value:{}});var ObjectAttributeProperties=new Map,_superMethodDependenciesMap=new Map;valuePropertyDescriptor.writable=valuePropertyDescriptor.configurable=valuePropertyDescriptor.enumerable=!1,valuePropertyDescriptor.value=function(e,t,r,o){if("object"!=typeof e&&typeof e!==FUNCTION||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var n=VALUE in r;if(PROTO in r)r.__proto__=n?typeof r.value===FUNCTION?_defaultFunctionValueProperty:_defaultObjectValueProperty:_defaultAccessorProperty;else{var a;a=n?typeof r.value===FUNCTION?_defaultFunctionValueProperty:_defaultObjectValueProperty:_defaultAccessorProperty;for(var i in a)hasProperty.call(a,i)&&(i in r||(r[i]=a[i]))}return hasProperty.call(r,ENUMERABLE)||t.charCodeAt(0)!==UNDERSCORE_UNICODE||(r.enumerable=!1),hasProperty.call(r,SERIALIZABLE)||(r.enumerable?r.get&&!r.set?r.serializable=!1:r.writable===!1&&(r.serializable=!1):r.serializable=!1),SERIALIZABLE in r&&(getAttributeProperties(e,SERIALIZABLE)[t]=r.serializable),o||__clearSuperDepencies(e,t,r),Object.defineProperty(e,t,r)},Object.defineProperty(Montage,"defineProperty",valuePropertyDescriptor),Object.defineProperty(Montage,"defineProperties",{value:function(e,t,r){if("object"!=typeof t||null===t)throw new TypeError("Properties must be an object, not '"+t+"'");for(var o,n=Object.getOwnPropertyNames(t),a=0;o=n[a];a++)"_bindingDescriptors"!==o&&this.defineProperty(e,o,t[o],r);return e}}),Montage.defineProperty(Montage,"didCreate",{value:Function.noop});var _propertyNames=[];Montage.defineProperty(Montage,"super",{value:_super,enumerable:!1}),Montage.defineProperty(Montage.prototype,"super",{value:_super,enumerable:!1}),Montage.defineProperty(Montage,"superForValue",{value:_superForValue,enumerable:!1}),Montage.defineProperty(Montage.prototype,"superForValue",{value:_superForValue,enumerable:!1}),Montage.defineProperty(Montage,"superForGet",{value:_superForGet,enumerable:!1}),Montage.defineProperty(Montage.prototype,"superForGet",{value:_superForGet,enumerable:!1}),Montage.defineProperty(Montage,"superForSet",{value:_superForSet,enumerable:!1}),Montage.defineProperty(Montage.prototype,"superForSet",{value:_superForSet,enumerable:!1}),Montage.defineProperty(Montage,"getSerializablePropertyNames",{value:function(e){var t,r=getAttributeProperties(e,SERIALIZABLE);if(r){t=[];for(var o in r)r[o]&&t.push(o);return t}return Array.empty}}),Montage.defineProperty(Montage,"getPropertyAttribute",{value:function(e,t,r){var o=getAttributeProperties(e,r);if(o)return o[t]}}),Montage.defineProperty(Montage,"getPropertyAttributes",{value:function(e,t){var r,o=getAttributeProperties(e,t);if(o){r={};for(var n in o)hasProperty.call(o,n)?r[n]=o[n]:r[n]=o[n];return r}}});var _instanceMetadataDescriptor={isInstance:{value:!0}},_functionInstanceMetadataDescriptor={objectName:{value:"Function"},isInstance:{value:!0}};Object.defineProperty(Montage.prototype,"_montage_metadata",{enumerable:!1,writable:!0,value:void 0}),Montage.defineProperty(Montage,"getInfoForObject",{value:function(e){var t,r;if(hasProperty.call(e,"_montage_metadata")&&e._montage_metadata)return e._montage_metadata;if(t=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,r=e.constructor===Function?_functionInstanceMetadataDescriptor:_instanceMetadataDescriptor,e===Object.prototype)return Object.create(t,r);try{return e.constructor===Object?Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(t,r)})._montage_metadata:("_montage_metadata"in e.constructor.prototype||hasOwnProperty.call(e.constructor.prototype,"_montage_metadata")||Object.defineProperty(e.constructor.prototype,"_montage_metadata",{enumerable:!1,writable:!0,value:void 0}),(e._montage_metadata=Object.create(t,r))||e._montage_metadata)}catch(o){return e._montage_metadata=Object.create(t,r)}}}),Montage.defineProperty(Montage,"identifier",{value:null,serializable:!0}),Montage.defineProperty(Montage.prototype,"identifier",{value:null,serializable:!0}),Montage.defineProperty(Montage.prototype,"version",{value:1,serializable:!1}),Montage.defineProperty(Montage.prototype,"equals",{value:function(e){return!!e&&(this===e||this.uuid&&this.uuid===e.uuid)}}),Montage.defineProperty(Montage,"equals",{value:Montage.prototype.equals}),Montage.defineProperty(Montage.prototype,"callDelegateMethod",{value:function(e){var t,r=this.delegate;if(r){var o=this.identifier+e.toCapitalized();if("string"==typeof this.identifier&&typeof r[o]===FUNCTION?t=r[o]:typeof r[e]===FUNCTION&&(t=r[e]),t)return 2===arguments.length?t.call(r,arguments[1]):3===arguments.length?t.call(r,arguments[1],arguments[2]):4===arguments.length?t.call(r,arguments[1],arguments[2],arguments[3]):5===arguments.length?t.call(r,arguments[1],arguments[2],arguments[3],arguments[4]):(ARRAY_PROTOTYPE.shift.call(arguments),t.apply(r,arguments))}}});var PropertyChanges=require("collections/listen/property-changes");Object.addEach(Montage,PropertyChanges.prototype),Object.addEach(Montage.prototype,PropertyChanges.prototype);var Bindings=exports.Bindings=require("frb"),bindingPropertyDescriptors={defineBinding:{value:function(e,t,r){return Bindings.defineBinding(this,e,t,r)}},defineBindings:{value:function(e,t){return Bindings.defineBindings(this,e,t)}},cancelBinding:{value:function(e){return Bindings.cancelBinding(this,e)}},cancelBindings:{value:function(){return Bindings.cancelBindings(this)}},getBinding:{value:function(e){return Bindings.getBinding(this,e)}},getBindings:{value:function(){return Bindings.getBindings(this)}}};Montage.defineProperties(Montage,bindingPropertyDescriptors),Montage.defineProperties(Montage.prototype,bindingPropertyDescriptors);var parse=require("frb/parse"),evaluate=require("frb/evaluate"),assign=require("frb/assign"),bind=require("frb/bind"),compileObserver=require("frb/compile-observer"),Scope=require("frb/scope"),Observers=require("frb/observers"),autoCancelPrevious=Observers.autoCancelPrevious,PathChangeDescriptor=function(){return this._willChangeListeners=null,this._changeListeners=null,this};Object.defineProperties(PathChangeDescriptor.prototype,{_willChangeListeners:{value:null,writable:!0},willChangeListeners:{get:function(){return this._willChangeListeners||(this._willChangeListeners=new Map)}},_changeListeners:{value:null,writable:!0},changeListeners:{get:function(){return this._changeListeners||(this._changeListeners=new Map)}}});var pathChangeDescriptors=new WeakMap,pathPropertyDescriptors={getPath:{value:function(e,t,r,o){return evaluate(e,this,t||this,r,o)}},setPath:{value:function(e,t,r,o,n){return assign(this,e,t,r||this,o,n)}},observePath:{value:function(e,t){var r=parse(e),o=compileObserver(r);return o(autoCancelPrevious(t),new Scope(this))}},addRangeAtPathChangeListener:{value:function(e,t,r,o,n,a){function i(e,o,n){if(t[r])t[r](e,o,n);else{if(!t.call)throw new Error("Can't dispatch range change to "+t);t.call(null,e,o,n)}}r=r||"handleRangeChange";var s=[];return this.addPathChangeListener(e,function(e){return e&&e.toArray&&e.addRangeChangeListener?(i(e.toArray(),s.toArray(),0),s=e,e.addRangeChangeListener(i)):(e=[],i(e,s,0),s=e,void 0)},void 0,void 0,o,n,a)}},getPathChangeDescriptors:{value:function(){return pathChangeDescriptors.has(this)||pathChangeDescriptors.set(this,new Map),pathChangeDescriptors.get(this)}},getPathChangeDescriptor:{value:function(e,t,r){var o=Montage.getPathChangeDescriptors.call(this);return o.has(e)||o.set(e,new PathChangeDescriptor),o=o.get(e),o=r?o.willChangeListeners:o.changeListeners,o.has(t)||o.set(t,{path:e,handler:t,beforeChange:r,cancel:Function.noop}),o.get(t)}},addPathChangeListener:{value:function(e,t,r,o,n,a,i){var s=this;t=t||Function.noop;var p=Montage.getPathChangeDescriptor.call(this,e,t,o);p.cancel();var u,c,l,g=parse(e);if(t===Function.noop)l=function(t){if(c)throw new Error("Path change handler needs a handler because it emits new values when the source changes: "+JSON.stringify(e));c=!0,u=t};else if(r)l=function(o){return t[r].call(t,o,e,s)};else if(t.handlePathChange)l=function(r){return t.handlePathChange.call(t,r,e,s)};else{if(typeof t!==FUNCTION)throw new Error("Can't recognize handler type: "+t+". Must be function or delegate implementing handlePathChange.");l=function(r){return t.call(s,r,e,s)}}var f=compileObserver(g),d=new Scope(this);d.beforeChange=o,d.parameters=n,d.document=a,d.components=i;var b=f(autoCancelPrevious(l),d);return p.cancel=b,c?u:b}},removePathChangeListener:{value:function(e,t,r){t=t||Function.noop;var o=Montage.getPathChangeDescriptors.call(this),n=r?"willChangeListeners":"changeListeners",a=o.get(e);if(!a)throw new Error("Can't find "+n+" for "+JSON.stringify(e));var i=a[n];if(!i.has(t))throw new Error("Can't find "+n+" for "+JSON.stringify(e));var s=i.get(t);s.cancel(),i["delete"](t),0===a.willChangeListeners.size&&0===a.changeListeners.size&&o["delete"](e),o.size<1&&pathChangeDescriptors["delete"](this)}},addBeforePathChangeListener:{value:function(e,t,r,o,n,a){return Montage.addPathChangeListener.call(this,e,t,r,!0,o,n,a)}},removeBeforePathChangeListener:{value:function(e,t,r){return Montage.removePathChangeListener.call(this,e,t,!0)}}};Montage.defineProperties(Montage,pathPropertyDescriptors),Montage.defineProperties(Montage.prototype,pathPropertyDescriptors),exports._objectDescriptorModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=Montage.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptorModuleId")||!t._objectDescriptorModuleId){e=Montage.getInfoForObject(t);var r=e.moduleId,o=r.lastIndexOf("/"),n=r.lastIndexOf(".");o=o===-1?0:o+1,n=n===-1?r.length:n,n=n<o?r.length:n,Montage.defineProperty(t,"_objectDescriptorModuleId",{enumerable:!1,value:r.slice(0,n)+".mjson"})}return t._objectDescriptorModuleId}},exports._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=Montage.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptorModuleId")||!t._objectDescriptorModuleId){e=Montage.getInfoForObject(t);var r=e.moduleId,o=r.lastIndexOf("/"),n=r.lastIndexOf(".");o=o===-1?0:o+1,n=n===-1?r.length:n,n=n<o?r.length:n,Montage.defineProperty(t,"_objectDescriptorModuleId",{enumerable:!1,value:r.slice(0,n)+".meta"})}return t._objectDescriptorModuleId}},exports._objectDescriptorDescriptor={serializable:!1,enumerable:!1,get:function(){var e=Montage.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptor")||!t._objectDescriptor){var r=t.objectDescriptorModuleId||t.blueprintModuleId;if(!r)throw new TypeError("ObjectDescriptor moduleId undefined for the module '"+JSON.stringify(t)+"'");exports._objectDescriptorDescriptor.ObjectDescriptorModulePromise||(exports._objectDescriptorDescriptor.ObjectDescriptorModulePromise=require.async("./meta/module-object-descriptor").get("ModuleObjectDescriptor")),e=Montage.getInfoForObject(t),Montage.defineProperty(t,"_objectDescriptor",{enumerable:!1,value:exports._objectDescriptorDescriptor.ObjectDescriptorModulePromise.then(function(o){return o.getObjectDescriptorWithModuleId(r,e.require)["catch"](function(e){if(e.message.indexOf("Can't XHR")!==-1)return o.createDefaultObjectDescriptorForObject(t).then(function(e){return e});throw e})})})}return t._objectDescriptor},set:function(e){var t,r=Montage.getInfoForObject(this),o=r&&!r.isInstance?this:this.constructor;if(null===e)t=null;else{if(typeof e.then===FUNCTION)throw new TypeError("Object descriptor should not be a promise");e.objectDescriptorInstanceModule=o.objectDescriptorModule,t=require("./promise").Promise.resolve(e)}Montage.defineProperty(o,"_objectDescriptor",{enumerable:!1,value:t})}},exports._blueprintDescriptor=exports._objectDescriptorDescriptor,require("./serialization/bindings");