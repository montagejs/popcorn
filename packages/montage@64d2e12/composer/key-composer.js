var Montage=require("../core/core").Montage,Composer=require("./composer").Composer,DefaultKeyManager=require("../core/event/key-manager").defaultKeyManager,_keyManagerProxy=null,KeyManagerProxy=Montage.specialize({_defaultKeyManager:{value:null},_loadingDefaultKeyManager:{value:!1},_keysToRegister:{value:[]},registerKey:{value:function(e){var t=this;if(this._defaultKeyManager)this._defaultKeyManager.registerKey(e);else{this._keysToRegister.push(e);var a=t._defaultKeyManager=DefaultKeyManager;t._keysToRegister.forEach(function(e){a.registerKey(e)}),t._keysToRegister.length=0}}},unregisterKey:{value:function(e){this._defaultKeyManager&&this._defaultKeyManager.unregisterKey(e)}}},{defaultKeyManager:{get:function(){return _keyManagerProxy||(_keyManagerProxy=new KeyManagerProxy),this._defaultKeyManager?this._defaultKeyManager:_keyManagerProxy}}}),KEYPRESS_EVENT_TYPE="keyPress",LONGKEYPRESS_EVENT_TYPE="longKeyPress",KEYRELEASE_EVENT_TYPE="keyRelease",KeyComposer=exports.KeyComposer=Composer.specialize({_shouldDispatchEvent:{value:!1},shouldDispatchLongPress:{value:!1},_longPressTimeout:{value:null},_keyRegistered:{value:!1},_keys:{value:null},keys:{get:function(){return this._keys},set:function(e){this._keyRegistered?(KeyManagerProxy.defaultKeyManager.unregisterKey(this),this._keys=e,KeyManagerProxy.defaultKeyManager.registerKey(this)):this._keys=e}},load:{value:function(){this._shouldDispatchEvent&&!this._keyRegistered&&(KeyManagerProxy.defaultKeyManager.registerKey(this),this._keyRegistered=!0)}},unload:{value:function(){KeyManagerProxy.defaultKeyManager.unregisterKey(this),this._keyRegistered=!1}},addEventListener:{value:function(e,t,a){var r=this.component;Composer.prototype.addEventListener.call(this,e,t,a),e!==KEYPRESS_EVENT_TYPE&&e!==LONGKEYPRESS_EVENT_TYPE&&e!==KEYRELEASE_EVENT_TYPE||(this._shouldDispatchEvent=!0,e===LONGKEYPRESS_EVENT_TYPE&&(this._shouldDispatchLongPress=!0),this._isLoaded?this._keyRegistered||(KeyManagerProxy.defaultKeyManager.registerKey(this),this._keyRegistered=!0):r&&"function"!=typeof r.addComposer&&(this.element||(this.element=window),this.component.loadComposer(this)))}},deserializedFromTemplate:{value:function(){var e=this.component;null===this.identifier&&(this.identifier=Montage.getInfoForObject(this).label),e&&("function"==typeof e.addComposer?e.addComposer(this):this._isLoaded||(this.element||(this.element=window),this.component.loadComposer(this)))}}},{createKey:{value:function(e,t,a){var r=this;return this===KeyComposer&&(r=new KeyComposer),a||(a=e.identifier?e.identifier+t.toLowerCase().replace(/[ +]/g).toCapitalized():t.toLowerCase().replace(/[ +]/g)),r.keys=t,r.identifier=a,e.addComposer(r),r}},createGlobalKey:{value:function(e,t,a){var r=this;return this===KeyComposer&&(r=new KeyComposer),r.keys=t,r.identifier=a,e.addComposerForElement(r,window),r}}});