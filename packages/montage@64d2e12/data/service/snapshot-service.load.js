montageDefine("64d2e12","data/service/snapshot-service",{dependencies:["core/core","collections/map"],factory:function(e,t,n){var r=e("core/core").Montage,a=e("collections/map");t.SnapshotService=r.specialize({constructor:{value:function(){this._cache=new a}},_cache:{value:null},saveSnapshotForTypeNameAndId:{value:function(e,t,n){this._cache.has(t)||this._cache.set(t,new a),this._cache.get(t).set(n,this._getClone(e))}},getSnapshotForTypeNameAndId:{value:function(e,t){var n;return this._cache.has(e)&&(n=this._cache.get(e).get(t)),n}},removeSnapshotForTypeNameAndId:{value:function(e,t){this._cache.has(e)&&this._cache.get(e)["delete"](t)}},getDifferenceWithSnapshotForTypeNameAndId:{value:function(e,t,n){var r,a,o,c=this._getClone(e);if(this._cache.has(t)&&(r=this._cache.get(t).get(n)),r){a=Object.keys(r);for(var s=0,l=a.length;s<l;s++)o=a[s],this._areSameValues(e[o],r[o])&&delete c[o]}return c}},_getClone:{value:function(e){var t,n,r;if(e){t=Object.create(null),n=Object.keys(e);for(var a=0,o=n.length;a<o;a++)r=n[a],Array.isArray(e[r])?t[r]=this._getArrayClone(e[r]):"object"==typeof e[r]?t[r]=this._getClone(e[r]):t[r]=e[r]}else t=e;return t}},_getArrayClone:{value:function(e){for(var t,n=[],r=0,a=e.length;r<a;r++)t=e[r],Array.isArray(t)?n.push(this._getArrayClone(t)):"object"==typeof t?n.push(this._getClone(t)):n.push(t);return n}},_areSameValues:{value:function(e,t){var n=e===t;if(!n&&"object"==typeof e&&"object"==typeof t&&null!==e&&null!==t){var r,a,o,c=Object.keys(e).sort(),s=Object.keys(t).sort(),l=c.filter(function(t){return null!==e[t]}).length,u=s.filter(function(e){return null!==t[e]}).length;if(n=l===u)for(var i=0,h=s.length;i<h;i++)if(o=s[i],r=e[o],a=t[o],!this._areSameValues(r,a)){n=!1;break}}return n}},_equals:{value:function(e,t){return"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t?this._compareObjects(e,t):e===t}},_compareObjects:{value:function(e,t){var n,r,a,o=this._sortedNonNullKeysForObject(e),c=this._sortedNonNullKeysForObject(t),s=o.length===c.length;for(n=0,r=c.length;n<r&&s;n+=1)a=c[n],s=this._equals(e[a],t[a]);return s}},_sortedNonNullKeysForObject:{value:function(e){return Object.keys(e).sort().filter(function(t){return null!==e[t]})}}})}});