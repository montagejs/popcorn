var Montage=require("montage").Montage,compile=require("frb/compile-evaluator"),parse=require("frb/parse"),deprecate=require("core/deprecate"),ONE_WAY_BINDING="<-",TWO_WAY_BINDING="<->";exports.MappingRule=Montage.specialize({converter:{value:void 0},expression:{get:function(){return!this._expression&&this.sourcePathSyntax&&(this._expression=compile(this.sourcePathSyntax)),this._expression}},_inversePropertyName:{value:void 0},inversePropertyName:{get:deprecate.deprecateMethod(void 0,function(){return this._inversePropertyName},"MappingRule.inversePropertyName","PropertyDescriptor.inversePropertyName",!0),set:deprecate.deprecateMethod(void 0,function(e){this._inversePropertyName=e},"MappingRule.inversePropertyName","PropertyDescriptor.inversePropertyName",!0)},propertyDescriptor:{value:void 0},requirements:{get:function(){return!this._requirements&&this.sourcePathSyntax&&(this._requirements=this._parseRequirementsFromSyntax(this.sourcePathSyntax)),this._requirements}},reverter:{value:void 0},_parseRequirementsFromSyntax:{value:function(e,r){var t=e.args,i=e.type;if(r=r||[],"property"===i&&"value"===t[0].type)r.push(t[1].value);else if("property"===i&&"property"===t[0].type){var s=[t[1].value];this._parseRequirementsFromSyntax(t[0],s),r.push(s.reverse().join("."))}else"record"===i&&this._parseRequirementsFromRecord(e,r);return r}},_parseRequirementsFromRecord:{value:function(e,r){var t=this,i=e.args,s=Object.keys(i);s.forEach(function(e){t._parseRequirementsFromSyntax(i[e],r)})}},serviceIdentifier:{value:void 0},sourcePath:{value:void 0},sourcePathSyntax:{get:function(){return!this._sourcePathSyntax&&this.sourcePath&&(this._sourcePathSyntax=parse(this.sourcePath)),this._sourcePathSyntax}},targetPath:{value:void 0},evaluate:{value:function(e){var r=this.expression(e);return this.converter?this.converter.convert(r):this.reverter?this.reverter.revert(r):r}}},{withRawRuleAndPropertyName:{value:function(e,r,t){var i=new this,s=t?e[ONE_WAY_BINDING]||e[TWO_WAY_BINDING]:r,a=t&&r||e[TWO_WAY_BINDING];return i.inversePropertyName=e.inversePropertyName,i.serviceIdentifier=e.serviceIdentifier,i.sourcePath=s,i.targetPath=a,i}}});