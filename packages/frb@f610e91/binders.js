function getStackTrace(){return new Error("").stack.replace(/^.*\n.*\n/,"\n")}function bindProperty(e,n,r,t,i,a){return r(autoCancelPrevious(function(r){if(!i.isActive)try{i.isActive=!0,a&&console.log("SET",a.targetPath,"TO",r,"ON",e,"BECAUSE",a.sourcePath,getStackTrace()),Array.isArray(e)&&n>>>0===n?e.set(n,r):e[n]=r}finally{i.isActive=!1}}),t)}function makePropertyBinder(e,n){return function(r,t,i,a,o){return n(autoCancelPrevious(function(n){function u(e){return null==e?void 0:e.bindProperty?e.bindProperty(n,r,t,a,o):u.bindProperty(e,n,r,t,a,o)}if(null!=n)return u.bindProperty=_bindProperty,e(autoCancelPrevious(u),i)}),i)}}function bindGet(e,n,r,t,i,a){return r(autoCancelPrevious(function(r){if(!i.isActive)try{i.isActive=!0,a&&console.log("SET FOR KEY",n,"TO",r,"ON",e,"BECAUSE",a.sourcePath,getStackTrace()),e.set(n,r)}finally{i.isActive=!1}}),t)}function makeGetBinder(e,n){return function(r,t,i,a,o){return e(autoCancelPrevious(function(e){function u(n){return null==n?void 0:u.bindGet(e,n,r,t,a,o)}if(e)return u.bindGet=_bindGet,n(autoCancelPrevious(u),i)}),i)}}function makeHasBinder(e,n){return function(r,t,i,a,o){return e(autoCancelPrevious(function(e){if(e)return n(autoCancelPrevious(function(n){function i(e){if(e)i.set.has(n)||(o&&console.log("ADD",n,"TO",o.targetPath,"BECAUSE",o.sourcePath,getStackTrace()),i.set.add(n));else for(;i.set.has(n);)o&&console.log("REMOVE",n,"FROM",o.targetPath,"BECAUSE",o.sourcePath,getStackTrace()),i.set["delete"](n)}if(null!=n)return i.set=e,r(autoCancelPrevious(i),t)}),i)}),i)}}function makeEqualityBinder(e,n){return function(r,t,i,a,o){return r(autoCancelPrevious(function(r){if(r){o&&console.log("BIND",o.targetPath,"TO",o.sourcePath,getStackTrace());e(n,t,t,a,o);return function(){o&&console.log("UNBIND",o.targetPath,"FROM",o.sourcePath,getStackTrace())}}}),i)}}function makeEveryBlockBinder(e,n,r){return function(t,i,a,o,u){return t(autoCancelPrevious(function(t){if(t)return e(autoCancelPrevious(function(e){function t(e,n,c){t.cancelEach(i.slice(c,c+n.length));for(var s,l=[],d=0,f=e.length;d<f;d++)s=a.nest(e[d]),l.push(t.bindCondition(r,s,s,o,u));i.swap(c,n.length,l)}if(e){var i=[];t.cancelEach=cancelEach,t.bindCondition=n;var c=observeRangeChange(e,t,a);return function(){cancelEach(i),c()}}}),a)}),i)}}function makeAndBinder(e,n,r,t,i,a){var o=makeNotObserver(t),u=makeAndObserver(r,o);return function(r,t,o,c,s){return r(autoCancelPrevious(function(r){if(null!=r){if(r){var t=e(i,trueScope,o,c,s),l=n(a,trueScope,o,c,s);return function(){t(),l()}}return e(u,o,o,c,s)}}),t)}}function makeOrBinder(e,n,r,t,i,a){var o=makeNotObserver(t),u=makeOrObserver(r,o);return function(r,t,o,c,s){return r(autoCancelPrevious(function(r){if(null!=r){if(r)return e(u,o,o,c,s);var t=e(i,falseScope,o,c,s),l=n(a,falseScope,o,c,s);return function(){t(),l()}}}),t)}}function makeConditionalBinder(e,n,r){return function(t,i,a,o,u){return e(autoCancelPrevious(function(e){if(null!=e)return e?n(t,i,a,o,u):r(t,i,a,o,u)}),i)}}function makeOnlyBinder(e){return function(n,r,t,i,a){return e(autoCancelPrevious(function(e){if(e)return n(autoCancelPrevious(function(n){null!=n&&(e.splice?e.splice(0,e.length,n):e.clear&&e.add&&(e.clear(),e.add(n)))}),r)}),t)}}function makeOneBinder(e){return function(n,r,t,i,a){return e(autoCancelPrevious(function(e){if(e)return n(autoCancelPrevious(function(n){null!=n&&n!==e.one()&&(e.splice?e.splice(0,e.length,n):e.clear&&e.add&&(e.clear(),e.add(n)))}),r)}),t)}}function makeRangeContentBinder(e,n){return function(r,t,i,a,o){return e(autoCancelPrevious(function(e){return e?r(autoCancelPrevious(function(n){function r(n,r,t){if(!isActive(e))if(o&&console.log("SWAPPING",r,"FOR",n,"AT",t,"ON",o.targetPath,getStackTrace()),e.swap)e.swap(t,r.length,n);else if(e.add&&(e.remove||e["delete"])){var i,a,u,c;for(i=0,a=n.length,u;u=n[i];i++)e.add(u);for(c=e.remove||e["delete"],i=0,a=r.length,u;u=r[i];i++)e.deleteMethod(u)}}if(n!==e){if(!n)return void e.clear();if(n.addRangeChangeListener)return n.addRangeChangeListener(r),r(Array.from(n),Array.from(e),0),function(){n.removeRangeChangeListener(r)}}}),t):n(Observers.makeLiteralObserver([]),t,i,a,o)}),i)}}function makeMapContentBinder(e){return function(n,r,t,i,a){return e(autoCancelPrevious(function(e){if(e)return n(autoCancelPrevious(function(n){function r(n,r){if(!i.isActive)try{i.isActive=!0,void 0===n?(a&&a&&console.log("DELETED",a.targetPath,"FOR KEY",r,"ON",e,"BECAUSE",a.sourcePath,getStackTrace()),Array.isArray(e)?e.splice(r,1):e["delete"](r)):(a&&a&&console.log("SET",a.targetPath,"FOR KEY",r,"TO",n,"ON",e,"BECAUSE",a.sourcePath,getStackTrace()),e.set(r,n))}finally{i.isActive=!1}}return n?(e.clear(),n.forEach(r),n.addMapChangeListener(r)):void e.clear()}),r)}),t)}}function makeReversedBinder(e){return function(n,r,t,i,a){return e(autoCancelPrevious(function(e){if(e)return n(autoCancelPrevious(function(n){function r(n,r,t){if(!isActive(e)){var i=e.length-t-r.length;e.swap(i,r.length,n.reversed())}}return n?(n.addRangeChangeListener(r),r(n,e,0),function(){n.removeRangeChangeListener(r)}):void e.clear()}),r)}),t)}}function makeDefinedBinder(e){return function(n,r,t,i,a){return n(autoCancelPrevious(function(n){return n?Function.noop:e(observeUndefined,r,t,i,a)}),t)}}function makeParentBinder(e){return function(n,r,t,i,a){if(t.parent)return e(n,r,t.parent,i,a)}}function makeWithBinder(e,n){return function(r,t,i,a,o){return e(autoCancelPrevious(function(e){if(null!=e)return n(r,t,i.nest(e),a,o)}),i)}}function isActive(e){return e.getRangeChangeDescriptor&&e.getRangeChangeDescriptor().isActive}var Scope=require("./scope"),Observers=require("./observers"),autoCancelPrevious=Observers.autoCancelPrevious,observeRangeChange=Observers.observeRangeChange,cancelEach=Observers.cancelEach,makeNotObserver=Observers.makeNotObserver,makeOrObserver=Observers.makeOrObserver,makeAndObserver=Observers.makeAndObserver,observeValue=Observers.observeValue,observeUndefined=Observers.makeLiteralObserver(),trueScope=new Scope((!0)),falseScope=new Scope((!1));exports.bindProperty=bindProperty;var _bindProperty=bindProperty;exports.makePropertyBinder=makePropertyBinder,exports.bindGet=bindGet;var _bindGet=bindGet;exports.makeGetBinder=makeGetBinder,exports.makeHasBinder=makeHasBinder,exports.makeEqualityBinder=makeEqualityBinder,exports.makeEveryBlockBinder=makeEveryBlockBinder,exports.makeAndBinder=makeAndBinder,exports.makeOrBinder=makeOrBinder,exports.makeConditionalBinder=makeConditionalBinder,exports.makeOnlyBinder=makeOnlyBinder,exports.makeOneBinder=makeOneBinder,exports.makeRangeContentBinder=makeRangeContentBinder,exports.makeMapContentBinder=makeMapContentBinder,exports.makeReversedBinder=makeReversedBinder,exports.makeDefinedBinder=makeDefinedBinder,exports.makeParentBinder=makeParentBinder,exports.makeWithBinder=makeWithBinder;