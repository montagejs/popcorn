function bind(e,r,n){n.target=e,n.targetPath=r;var o=n.source=n.source||e,t=n.twoWay=TWO_WAY in n,a=n.sourcePath=t?n[TWO_WAY]||"":n[ONE_WAY],s=n.parameters=n.parameters||o,c=n.document,i=n.components,g=n.trace,l=new Scope(o),u=new Scope(e);if(l.parameters=s,l.document=c,l.components=i,u.parameters=s,u.document=c,u.components=i,n.converter){var v=n.converter;v.convert&&(n.convert=v.convert.bind(v)),v.revert&&(n.revert=v.revert.bind(v))}else if(n.reverter){var E=n.reverter;E.convert&&(n.revert=E.convert.bind(E)),E.revert&&(n.convert=E.revert.bind(E))}var N=n.convert,O=n.revert,T=n.sourceSyntax=parse(a),A=n.targetSyntax=parse(r),p=solve(A,T);if(A=p[0],T=p[1],t&&"rangeContent"===A.type)return bindRangeContent(u,A.args[0],l,T,N,O,n,g?{sourcePath:stringify(T),targetPath:stringify(A.args[0])}:null);g&&console.log("DEFINE BINDING",r,ONE_WAY,a,e);var R=bindOneWay(u,A,l,T,N,n,g),p=solve(T,A);T=p[0],A=p[1];var h=Function.noop;return t&&(g&&console.log("DEFINE BINDING",r,ONE_WAY_RIGHT,a,o),h=bindOneWay(l,T,u,A,O,n,g)),function(){R(),h()}}function bindOneWay(e,r,n,o,t,a,s){var c=compileObserver(o);t&&(c=Observers.makeConverterObserver(c,t,n));var i=compileBinder(r);return i(c,n,e,a,s?{sourcePath:stringify(o),targetPath:stringify(r)}:null)}function bindRangeContent(e,r,n,o,t,a,s,c){function i(e,r,n){E||(E=!0,c&&console.log("RANGE CONTENT PROPAGATED",c.targetPath,ONE_WAY,c.sourcePath,"PLUS",e,"MINUS",r,"AT",n),u.swap(n,r.length,e),E=!1)}function g(e,r,n){E||(E=!0,c&&console.log("RANGE CONTENT PROPAGATED",c.targetPath,ONE_WAY_RIGHT,c.sourcePath,"PLUS",e,"MINUS",r,"AT",n),v.swap(n,r.length,e),E=!1)}function l(){if(v!==u){c&&console.log("RANGE CONTENT BOUND",c.targetPath,TWO_WAY,c.sourcePath),E=!0;var r=observeRangeChange(v,i,n),o=observeRangeChange(u,g,e);return E=!1,function(){c&&console.log("RANGE CONTENT UNBOUND",c.targetPath,TWO_WAY,c.sourcePath),r(),o()}}}var u,v,E,N=compileObserver(o),O=compileObserver(r),T=compileAssigner(o),A=compileAssigner(r),p=Function.noop;E=!0;var R=O(function(e){p(),p=Function.noop,c&&console.log("RANGE CONTENT TARGET",c.targetPath,"SET TO",e),e&&e.addRangeChangeListener&&(u=e,v&&u?(c&&console.log("RANGE CONTENT TARGET REPLACES SOURCE",c.targetPath,ONE_WAY_RIGHT,c.sourcePath,"WITH",u),E=!0,v.swap(0,v.length,u),E=!1,p=l()):v||E||(c&&console.log("RANGE CONTENT TARGET INITIALIZED TO COPY OF SOURCE",c.targetPath,ONE_WAY,tarce.sourcePath,"WITH",v),T(u.clone(),n)))},e);E=!1;var h=N(function(r){p(),p=Function.noop,c&&console.log("RANGE CONTENT SOURCE",c.sourcePath,"SET TO",r),r&&r.addRangeChangeListener&&(v=r,u&&v?(c&&console.log("RANGE CONTENT SOURCE REPLACES TARGET",c.targetPath,ONE_WAY,c.sourcePath,"WITH",v),E=!0,u.swap(0,u.length,v),E=!1,p=l()):u||A(v.clone(),e))},n);return u||v||T([],n),function(){p(),R(),h()}}var parse=require("./parse"),solve=require("./algebra"),stringify=require("./stringify"),compileObserver=require("./compile-observer"),compileBinder=require("./compile-binder"),compileAssigner=require("./compile-assigner"),Observers=require("./observers"),observeRangeChange=Observers.observeRangeChange,Binders=require("./binders"),Scope=require("./scope"),ONE_WAY="<-",ONE_WAY_RIGHT="->",TWO_WAY="<->";module.exports=bind;