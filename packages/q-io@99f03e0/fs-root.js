function RootFs(n,t){function r(r){var e;return e=n.isAbsolute(r)?n.relativeFromDirectory(n.ROOT,r):r,e=n.join(n.ROOT,e),e=n.relativeFromDirectory(n.ROOT,e),e=n.join(t,e),n.canonical(e).then(function(n){return n},function(){return e}).then(function(e){return n.contains(t,e)?{inner:n.join(n.ROOT,n.relativeFromDirectory(t,e)),outer:e}:Q.reject("Can't find: "+JSON.stringify(r))})}function e(){return n.ROOT}var o=Object.create(BOOT);return COMMON.update(o,e),o.list=function(t){return r(t).then(function(t){return n.list(t.outer)}).then(null,function(n){return Q.reject("Can't list "+JSON.stringify(t))})},o.open=function(t,e,o){return r(t).then(function(t){return n.open(t.outer,e,o)}).then(null,function(n){return Q.reject("Can't open "+JSON.stringify(t))})},o.stat=function(t){return r(t).then(function(t){return n.stat(t.outer)}).then(null,function(n){return Q.reject("Can't stat "+JSON.stringify(t))})},o.statLink=function(t){return r(t).then(function(t){return n.statLink(t.outer)}).then(null,function(n){return Q.reject("Can't statLink "+JSON.stringify(t))})},o.canonical=function(n){return r(n).then(function(n){return n.inner}).then(null,function(t){return Q.reject("Can't find canonical of "+JSON.stringify(n))})},o.makeDirectory=function(t){return r(t).then(function(t){return n.makeDirectory(t.outer)})["catch"](function(n){throw new Error("Can't make directory "+JSON.stringify(t))})},o.removeDirectory=function(t){return r(t).then(function(t){return n.removeDirectory(t.outer)})["catch"](function(n){throw new Error("Can't remove directory "+JSON.stringify(t))})},o.remove=function(t){return r(t).then(function(t){return n.remove(t.outer)})["catch"](function(n){throw new Error("Can't remove "+JSON.stringify(t))})},o.makeTree=function(t){return r(t).then(function(t){return n.makeTree(t.outer)})["catch"](function(n){throw new Error("Can't make tree "+JSON.stringify(t))})},o.removeTree=function(t){return r(t).then(function(t){return n.removeTree(t.outer)})["catch"](function(n){throw new Error("Can't remove tree "+JSON.stringify(t))})},Q.when(n.canonical(t),function(n){return t=n,o})}var Q=require("q"),BOOT=require("./fs-boot"),COMMON=require("./fs-common");module.exports=RootFs;