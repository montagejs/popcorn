montageDefine("99f03e0","buffer-stream",{dependencies:["q","./reader"],factory:function(e,t,r){function s(e,t){return this instanceof s?(e?Array.isArray(e)||(e=[e]):e=[],this._charset=t,this._chunks=e,this._close=o.defer(),void(this.closed=this._close.promise)):new s(e,t)}var o=e("q"),n=e("./reader");r.exports=s,s.prototype.forEach=function(e,t){var r=this,s=r._chunks;return o.fcall(function(){s.splice(0,s.length).forEach(e,t)})},s.prototype.read=function(){var e;return e=n.join(this._chunks),this._charset&&(e=e.toString(this._charset)),o.resolve(e)},s.prototype.write=function(e){if(this._charset)e=new Buffer(String(e),this._charset);else if(!(e instanceof Buffer))throw new Error("Can't write strings to buffer stream without a charset: "+e);return this._chunks.push(e),o.resolve()},s.prototype.close=function(){return this._close.resolve(),o.resolve()},s.prototype.destroy=function(){return this._close.resolve(),o.resolve()}}});