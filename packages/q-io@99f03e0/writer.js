function Writer(e,r){var n=Object.create(Writer.prototype);r&&e.setEncoding&&e.setEncoding(r);var o=Q.defer();return e.on("error",function(e){o.reject(e),o=Q.defer()}),e.on("drain",function(){o.resolve(),o=Q.defer()}),n.write=function(r){return e.writeable||e.writable?("string"!=typeof r&&(r=new Buffer(r)),e.write(r)?Q.resolve():o.promise):Q.reject(new Error("Can't write to non-writable (possibly closed) stream"))},n.flush=function(){return o.promise},n.close=function(){var r;return supportsFinish&&(r=Q.defer(),e.on("finish",function(){r.resolve()}),e.on("error",function(e){r.reject(e)})),e.end(),o.resolve(),r?r.promise:Q()},n.destroy=function(){return e.destroy(),o.resolve(),Q.resolve()},n.node=e,Q(n)}var Q=require("q");module.exports=Writer;var version=process.versions.node.split("."),supportsFinish=version[0]>=1||version[1]>=10;