function Reader(e,n){function r(){var e;return e=n?u.join(""):o.constructor.join(u),u.splice(0,u.length),e}var o=Object.create(Reader.prototype);n&&e.setEncoding&&e.setEncoding(n);var t=Q.defer(),i=Q.defer();e.on("error",function(e){t.reject(e)});var c,u=[];return e.on("end",function(){t.resolve(o),i.resolve()}),e.on("data",function(e){t.resolve(o),c?c(e):u.push(e)}),o.read=function(){c=void 0;var e=Q.defer();return Q.done(i.promise,function(){e.resolve(r())}),e.promise},o.forEach=function(e){return u&&u.length&&e(r()),c=e,Q.when(i.promise,function(){c=void 0})},o.close=function(){e.destroy()},o.node=e,t.promise}function read(e,n){var r=[];return e.forEach(function(e){r.push(e)}),n?r.join(""):join(r)}function join(e){var n,r,o,t,i=0,c=e.length;for(r=0;r<c;r++)o=e[r],i+=o.length;for(t=new Buffer(i),n=0,r=0;r<c;r++)o=e[r],o.copy(t,n,0),n+=o.length;return e.splice(0,c,t),t}var Q=require("q");module.exports=Reader,Reader.read=read,Reader.join=join;