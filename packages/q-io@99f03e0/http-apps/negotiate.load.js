montageDefine("99f03e0","http-apps/negotiate",{dependencies:["q","mimeparse","./status"],factory:function(e,t,n){function r(e,t,n){var r=Object.keys(t),a=e.headers[n||"accept"]||"*",o=c.bestMatch(r,a);return t[o]}var a=e("q"),c=e("mimeparse"),o=e("./status");t.negotiate=r,t.Method=function(e,t){return t||(t=o.methodNotAllowed),function(n){var r=n.method;return Object.prototype.hasOwnProperty.call(e,r)!==-1?e[r](n):t(n)}};var u=function(e,t,n){return function(r,u){var s=Object.keys(r);return u||(u=o.notAcceptable),function(o){var i=o.headers[e]||"*",p=c.bestMatch(s,i);return o.terms=o.terms||{},o.terms[t]=p,s.indexOf(p)!==-1?a.when(r[p](o),function(e){return null!==n&&e&&200===e.status&&e.headers&&(e.headers[t]=p),e}):u(o)}}};t.ContentType=u("accept","content-type"),t.Language=u("accept-language","language"),t.Charset=u("accept-charset","charset"),t.Encoding=u("accept-encoding","encoding"),t.Host=function(e,t){var n=Object.keys(e).map(function(t){var n=t.split(":");return[t,n[0]||"*",n[1]||"*",e[t]]});return t||(t=o.notAcceptable),function(e){for(var r=0;r<n.length;r++){var a=n[r],c=a[0],o=a[1],u=a[2],s=a[3];if(!("*"!==o&&o!==e.hostname||"*"!==u&&u!==""+e.port))return e.terms=e.terms||{},e.terms.host=c,s(e)}return t(e)}},t.Select=function(e){return function(t){return a.when(e(t),function(e){return e(t)})}}}});