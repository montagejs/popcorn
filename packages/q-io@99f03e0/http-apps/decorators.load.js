montageDefine("99f03e0","http-apps/decorators",{dependencies:["q","../http","./route","./status"],factory:function(e,n,t){var r=e("q"),o=e("../http"),u=e("./route"),a=e("./status");n.Normalize=function(e){return function(n,t){var n=o.normalizeRequest(n);return r.when(e(n,t),function(e){return o.normalizeResponse(e)})}},n.Date=function(e,n){return n=n||function(){return new Date},u.Trap(e,function(e,t){e.headers.date=""+n()})},n.Error=function(e,n){return function(t,o){return r.when(e(t,o),null,function(e){return n||(e=void 0),a.responseForStatus(t,500,e&&e.stack||e)})}},n.Debug=function(e){return n.Error(e,!0)},n.Log=function(e,n,t){return n=n||console.log,t=t||function(e){return(new Date).toISOString()+" "+e},function(o,u){var a=o.remoteHost+":"+o.remotePort,i=o.method+" "+o.path+" HTTP/"+o.version.join(".");return n(t(a+" -->     "+i)),r.when(e(o,u),function(e){return n(t(e?a+" <== "+e.status+" "+i+" "+(e.headers["content-length"]||"-"):a+" ... ... "+i+" (response undefined / presumed streaming)")),e},function(e){return n(t(a+" !!!     "+i+" "+(e&&e.message||e))),r.reject(e)})}},n.Time=function(e){return function(n,t){var o=new Date;return r.when(e(n,t),function(e){var n=new Date;return e&&e.headers&&(e.headers["x-response-time"]=""+(n-o)),e})}},n.Headers=function(e,n){return function(t,o){return r.when(e(t,o),function(e){return e&&e.headers&&Object.keys(n).forEach(function(t){t in e.headers||(e.headers[t]=n[t])}),e})}};var i=31536e7;n.Permanent=function(e,n){return n=n||function(){return new Date((new Date).getTime()+i)},e=u.Tap(e,function(e,t){e.permanent=n}),e=u.Trap(e,function(e,t){e.headers.expires=""+n()})},n.Decorators=function(e,n){return e.reversed().forEach(function(e){n=e(n)}),n}}});