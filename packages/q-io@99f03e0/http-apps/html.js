function escapeHtml(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}var Q=require("q");exports.HandleHtmlFragmentResponses=function(e,t){return t=t||exports.handleHtmlFragmentResponse,function(n){return n.handleHtmlFragmentResponse=t,Q.fcall(e,n).then(function(e){return e.htmlFragment?Q.fcall(t,e):e})}},exports.handleHtmlFragmentResponse=function(e){var t=e.htmlFragment;return delete e.htmlFragment,e.headers["content-type"]="text/html; charset=utf-8",e.body={forEach:function(n){n("<!doctype html>\n"),n("<html>\n"),n("    <head>\n"),void 0!==e.htmlTitle&&n("        <title>"+escapeHtml(e.htmlTitle)+"</title>\n"),n("    </head>\n"),n("    <body>\n"),t.forEach(function(e){n("        "+e)}),n("    </body>\n"),n("</html>\n")}},e},exports.escapeHtml=escapeHtml;