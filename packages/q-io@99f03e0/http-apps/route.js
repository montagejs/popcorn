var Q=require("q"),StatusApps=require("./status");exports.Cap=function(t,n){return n=n||StatusApps.notFound,function(r,e){return""===r.pathInfo||"/"===r.pathInfo?t(r,e):n(r,e)}},exports.Tap=function(t,n){return function(r,e){var u=this,o=arguments;return Q.when(n.apply(this,arguments),function(n){return n?n:t.apply(u,o)})}},exports.Trap=function(t,n){return function(r,e){return Q.when(t.apply(this,arguments),function(t){if(t)return t.headers=t.headers||{},n(t,r)||t})}},exports.Branch=function(t,n){return t||(t={}),n||(n=StatusApps.notFound),function(r,e){if(!/^\//.test(r.pathInfo))return n(r,e);var u=r.pathInfo.slice(1),o=u.split("/"),p=decodeURIComponent(o.shift());return hasOwnProperty.call(t,p)?(r.scriptName=r.scriptName+p+"/",r.pathInfo=u.slice(p.length),t[p](r,e)):n(r,e)}},exports.FirstFound=function(t){return function(n,r){function e(){var r=t[u++](n,r);return u<o?Q.when(r,function(t){return 404===t.status?e():t}):r}var u=0,o=t.length;return e()}};