function negotiate(t,e,r){var n=Object.keys(e),a=t.headers[r||"accept"]||"*",o=MimeParse.bestMatch(n,a);return e[o]}var Q=require("q"),MimeParse=require("mimeparse"),Status=require("./status");exports.negotiate=negotiate,exports.Method=function(t,e){return e||(e=Status.methodNotAllowed),function(r){var n=r.method;return Object.prototype.hasOwnProperty.call(t,n)!==-1?t[n](r):e(r)}};var Negotiator=function(t,e,r){return function(n,a){var o=Object.keys(n);return a||(a=Status.notAcceptable),function(s){var c=s.headers[t]||"*",u=MimeParse.bestMatch(o,c);return s.terms=s.terms||{},s.terms[e]=u,o.indexOf(u)!==-1?Q.when(n[u](s),function(t){return null!==r&&t&&200===t.status&&t.headers&&(t.headers[e]=u),t}):a(s)}}};exports.ContentType=Negotiator("accept","content-type"),exports.Language=Negotiator("accept-language","language"),exports.Charset=Negotiator("accept-charset","charset"),exports.Encoding=Negotiator("accept-encoding","encoding"),exports.Host=function(t,e){var r=Object.keys(t).map(function(e){var r=e.split(":");return[e,r[0]||"*",r[1]||"*",t[e]]});return e||(e=Status.notAcceptable),function(t){for(var n=0;n<r.length;n++){var a=r[n],o=a[0],s=a[1],c=a[2],u=a[3];if(!("*"!==s&&s!==t.hostname||"*"!==c&&c!==""+t.port))return t.terms=t.terms||{},t.terms.host=o,u(t)}return e(t)}},exports.Select=function(t){return function(e){return Q.when(t(e),function(t){return t(e)})}};