var Q=require("q"),Content=require("./content"),Status=require("./status");exports.HandleJsonResponses=function(n,t,e){return function(r){return r.handleJsonResponse=exports.handleJsonResponse,Q.fcall(n,r).then(function(n){return void 0!==n.data?Q.fcall(exports.handleJsonResponse,n,t,e):n})}},exports.handleJsonResponse=function(n,t,e){return n.headers["content-type"]="application/json",n.body={forEach:function(r){r(JSON.stringify(n.data,t,e))}},n},exports.Json=function(n,t,e){return function(r,o){return Q.when(n(r,o),function(n){return exports.json(n,t,e)})}},exports.json=function(n,t,e){try{var r=JSON.stringify(n,t,e)}catch(o){return Q.reject(o)}return Content.ok([r],"application/json")},exports.JsonRequest=function(n,t){return t||(t=Status.badRequest),Content.ContentRequest(function(e,r,o){try{var s=JSON.parse(e)}catch(u){return t(r,u)}return n(s,r,o)})};