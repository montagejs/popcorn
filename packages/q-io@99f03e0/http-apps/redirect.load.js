montageDefine("99f03e0","http-apps/redirect",{dependencies:["q","url2","../http","./negotiate","./html"],factory:function(e,r,t){var n=e("q"),i=e("url2"),c=e("../http"),u=e("./negotiate"),o=e("./html");r.PermanentRedirect=function(e,t,n){return function(i,c){return r.permanentRedirect(i,e,t,n)}},r.PermanentRedirectTree=function(e,t){return function(n,i){return r.permanentRedirect(n,e,t,!0)}},r.TemporaryRedirect=function(e,t,n){return function(i,c){return r.temporaryRedirect(i,e,t,n)}},r.TemporaryRedirectTree=function(e,t){return function(n,i){return r.temporaryRedirect(n,e,t,!0)}},r.Redirect=function(e,t,n){return function(i,c){return r.redirect(i,e,t,n)}},r.RedirectTree=function(e,t){return function(n,i){return r.redirect(n,e,t,!0)}},r.permanentRedirect=function(e,t,n){return r.redirect(e,t,n||301)},r.permanentRedirectTree=function(e,t,n){return r.redirect(e,t,n||301,!0)},r.temporaryRedirect=function(e,t,n){return r.redirect(e,t,n||307)},r.temporaryRedirectTree=function(e,t,n){return r.redirect(e,t,n||307,!0)},r.redirectTree=function(e,t,n){return r.redirect(e,t,n,!0)},r.redirect=function(e,t,n,c){n=n||(e.permanent?301:307),t=i.resolve(e.url,t),c&&(t=i.resolve(t,e.pathInfo.replace(/^\//,"")));var o={};o["text/plain"]=r.redirectText,e.handleHtmlFragmentResponse&&(o["text/html"]=r.redirectHtml);var a=u.negotiate(e,o)||r.redirectText;return a(e,t,n)},r.redirectText=function(e,r,t){var n=(e.permanent?"Permanent redirect\n":"Temporary redirect\n")+"See: "+r+"\n";n.length;return{status:t,headers:{location:r,"content-type":"text/plain"},body:[n]}},r.redirectHtml=function(e,r,t){var n=e.permanent?"Permanent redirect":"Temporary redirect";return{status:t,headers:{location:r,"content-type":"text/html"},htmlTitle:n,htmlFragment:{forEach:function(e){e("<h1>"+o.escapeHtml(n)+"</h1>\n"),e('<p>See: <a href="'+o.escapeHtml(r)+'">'+o.escapeHtml(r)+"</a></p>\n")}}}},r.RedirectTrap=function(e,t){return t=t||20,function(i,u){function o(){n.fcall(function(){return e(i,u)}).then(function(e){if(r.isRedirect(e)){if(!a--)throw new Error("Maximum redirects.");i.url=e.headers.location,o()}else d.resolve(e)}).fail(d.reject)}var a=t,d=n.defer();return i=c.normalizeRequest(i),o(),d.promise}},r.isRedirect=function(e){return a[e.status]||!1};var a={301:!0,302:!0,303:!0,307:!0}}});