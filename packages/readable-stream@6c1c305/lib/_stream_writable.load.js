montageDefine("6c1c305","lib/_stream_writable",{dependencies:["buffer","core-util-is","inherits","stream","./_stream_duplex"],factory:function(e,t,n){function i(e,t,n){this.chunk=e,this.encoding=t,this.callback=n}function r(e,t){e=e||{};var n=e.highWaterMark;this.highWaterMark=n||0===n?n:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=e.decodeStrings===!1;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){d(t,e)},this.writecb=null,this.writelen=0,this.buffer=[],this.errorEmitted=!1}function f(t){var n=e("./_stream_duplex");return this instanceof f||this instanceof n?(this._writableState=new r(t,this),this.writable=!0,void _.call(this)):new f(t)}function o(e,t,n){var i=new Error("write after end");e.emit("error",i),process.nextTick(function(){n(i)})}function s(e,t,n,i){var r=!0;if(!k.isBuffer(n)&&"string"!=typeof n&&null!==n&&void 0!==n&&!t.objectMode){var f=new TypeError("Invalid non-string/buffer chunk");e.emit("error",f),process.nextTick(function(){i(f)}),r=!1}return r}function c(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new k(t,n)),t}function u(e,t,n,r,f){n=c(t,n,r),k.isBuffer(n)&&(r="buffer");var o=t.objectMode?1:n.length;t.length+=o;var s=t.length<t.highWaterMark;return s||(t.needDrain=!0),t.writing?t.buffer.push(new i(n,r,f)):h(e,t,o,n,r,f),s}function h(e,t,n,i,r,f){t.writelen=n,t.writecb=f,t.writing=!0,t.sync=!0,e._write(i,r,t.onwrite),t.sync=!1}function a(e,t,n,i,r){n?process.nextTick(function(){r(i)}):r(i),e._writableState.errorEmitted=!0,e.emit("error",i)}function l(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function d(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if(l(n),t)a(e,n,i,t,r);else{var f=p(e,n);f||n.bufferProcessing||!n.buffer.length||w(e,n),i?process.nextTick(function(){g(e,n,f,r)}):g(e,n,f,r)}}function g(e,t,n,i){n||b(e,t),i(),n&&v(e,t)}function b(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function w(e,t){t.bufferProcessing=!0;for(var n=0;n<t.buffer.length;n++){var i=t.buffer[n],r=i.chunk,f=i.encoding,o=i.callback,s=t.objectMode?1:r.length;if(h(e,t,s,r,f,o),t.writing){n++;break}}t.bufferProcessing=!1,n<t.buffer.length?t.buffer=t.buffer.slice(n):t.buffer.length=0}function p(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function v(e,t){var n=p(e,t);return n&&(t.finished=!0,e.emit("finish")),n}function y(e,t,n){t.ending=!0,v(e,t),n&&(t.finished?process.nextTick(n):e.once("finish",n)),t.ended=!0}n.exports=f;var k=e("buffer").Buffer;f.WritableState=r;var m=e("core-util-is");m.inherits=e("inherits");var _=e("stream");m.inherits(f,_),f.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},f.prototype.write=function(e,t,n){var i=this._writableState,r=!1;return"function"==typeof t&&(n=t,t=null),k.isBuffer(e)?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=function(){}),i.ended?o(this,i,n):s(this,i,e,n)&&(r=u(this,i,e,t,n)),r},f.prototype._write=function(e,t,n){n(new Error("not implemented"))},f.prototype.end=function(e,t,n){var i=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),"undefined"!=typeof e&&null!==e&&this.write(e,t),i.ending||i.finished||y(this,i,n)}}});