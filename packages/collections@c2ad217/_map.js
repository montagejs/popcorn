"use strict";var Shim=require("./shim"),GenericCollection=require("./generic-collection"),Map,GlobalMap,CollectionsMap;if(void 0!==global.Map&&"function"==typeof global.Set.prototype.values){Map=module.exports=global.Map,GlobalMap=Map,Map.Map=Map;var protoIsSupported={}.__proto__===Object.prototype,map_makeObservable;map_makeObservable=protoIsSupported?function(){this.__proto__=ChangeDispatchMap}:function(){Object.defineProperties(this,observableSetProperties)},Object.defineProperty(Map.prototype,"makeObservable",{value:map_makeObservable,writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Map.prototype,"makePropertyObservable",{value:function(){},writable:!0,configurable:!0,enumerable:!1}),Map.prototype.constructClone=function(e){return new this.constructor(e)},Map.prototype.isMap=!0,Map.prototype.addEach=function(e){if(e&&Object(e)===e)if("function"==typeof e.forEach)e.isMap===!0?e.forEach(function(e,t){this.set(t,e)},this):e.forEach(function(e){this.set(e[0],e[1])},this);else if("number"==typeof e.length)for(var t=0;t<e.length;t++)this.add(e[t],t);else Object.keys(e).forEach(function(t){this.set(t,e[t])},this);else if(e&&"number"==typeof e.length)for(var t=0;t<e.length;t++)this.add(e[t],t);return this},Map.prototype.add=function(e,t){return this.set(t,e)},Map.prototype.reduce=function(e,t){var a=arguments[2];return this.forEach(function(r,o,i){t=e.call(a,t,r,o,this)}),t},Map.prototype.reduceRight=function(e,t){for(var a,r=arguments[2],o=this.keys(),i=this.size,n=new Array(this.size),p=0;a=o.next().value;)n[--i]=a;for(;p++<i;)t=e.call(r,t,this.get(n[p]),n[p],this);return t},Map.prototype.equals=function(e,t){if(t=t||Object.equals,this===e)return!0;if(e&&"function"==typeof e.every)return e.size===this.size&&e.every(function(e,a){return t(this.get(a),e)},this);var a=Object.keys(e);return a.length===this.size&&Object.keys(e).every(function(a){return t(this.get(a),e[a])},this)};var _keysArrayFunction=function(e,t){return t};Map.prototype.keysArray=function(){return this.map(_keysArrayFunction)};var _valuesArrayFunction=function(e,t){return e};Map.prototype.valuesArray=function(){return this.map(_valuesArrayFunction)};var _entriesArrayFunction=function(e,t){return[t,e]};Map.prototype.entriesArray=function(){return this.map(_entriesArrayFunction)},Map.prototype.toJSON=function(){return this.entriesArray()},Map.prototype.items=function(){return this.entriesArray()},Map.from=function(e){var t=new this;return t.addEach(e),t},Object.defineProperty(Map.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0});var map_clear=Map.prototype.clear,map_set=Map.prototype.set,map_delete=Map.prototype["delete"],observableMapProperties={clear:{value:function(){var e;this.dispatchesMapChanges&&(this.forEach(function(e,t){this.dispatchBeforeMapChange(t,e)},this),e=this.keysArray()),map_clear.call(this),this.dispatchesMapChanges&&e.forEach(function(e){this.dispatchMapChange(e)},this)},writable:!0,configurable:!0},set:{value:function(e,t){var a=this.get(e);return a?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,a),map_set.call(this,e,t),this.dispatchesMapChanges&&this.dispatchMapChange(e,t)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,void 0),map_set.call(this,e,t),this.dispatchesMapChanges&&this.dispatchMapChange(e,t)),this},writable:!0,configurable:!0},"delete":{value:function(e){return!!this.has(e)&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(e,this.get(e)),map_delete.call(this,e),this.dispatchesMapChanges&&this.dispatchMapChange(e,void 0),!0)}}};Object.addEach(Map.prototype,GenericCollection.prototype,!1);var ChangeDispatchMap=Object.create(Map.prototype,observableMapProperties)}var Set=require("./_set").CollectionsSet,GenericMap=require("./generic-map");CollectionsMap=Map=function e(t,a,r,o){return this instanceof e?(a=a||Object.equals,r=r||Object.hash,o=o||Function.noop,this.contentEquals=a,this.contentHash=r,this.getDefault=o,this.store=new Set((void 0),function(e,t){return a(e.key,t.key)},function(e){return r(e.key)}),this.length=0,void this.addEach(t)):new e(t,a,r,o)},Map.Map=Map,Object.addEach(Map.prototype,GenericCollection.prototype),Object.addEach(Map.prototype,GenericMap.prototype),Object.defineProperty(Map.prototype,"size",GenericCollection._sizePropertyDescriptor),Map.from=GenericCollection.from,Map.prototype.constructClone=function(e){return new this.constructor(e,this.contentEquals,this.contentHash,this.getDefault)},Map.prototype.log=function(e,t,a,r){t=t||this.logNode,this.store.log(e,function(e,a,r){t(e.value.value,a,r)},a,r)},Map.prototype.logNode=function(e,t){t(" key: "+e.key),t(" value: "+e.value)},GlobalMap?(module.exports=GlobalMap,GlobalMap.CollectionsMap=CollectionsMap):module.exports=CollectionsMap;