"use strict";var Shim=require("./shim"),GenericCollection=require("./generic-collection"),GenericSet=require("./generic-set"),Set,GlobalSet,CollectionsSet;void 0!==global.Set&&"function"==typeof global.Set.prototype.values&&(GlobalSet=module.exports=global.Set,GlobalSet.Set=GlobalSet,GlobalSet.prototype.reduce=function(t,e){var o=arguments[2];return this.forEach(function(r){e=t.call(o,e,r,this)}),e},GlobalSet.prototype.reduceRight=function(t,e){for(var o,r=arguments[2],n=this.values(),i=this.size,l=new Array(this.size),s=i;o=n.next().value;)l[--s]=o;for(;s<i;)e=t.call(r,e,l[s++],this);return e},GlobalSet.prototype.equals=function(t,e){var o=this;return t&&"function"==typeof t.reduce&&this.size===(t.size||t.length)&&t.reduce(function(t,r){return t&&o.has(r,e)},!0)},GlobalSet.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},GlobalSet.prototype.toJSON=function(){return this.entriesArray()},GlobalSet.prototype.one=function(){if(this.size>0)return this.values().next().value},GlobalSet.prototype.pop=function(){if(this.size){for(var t,e,o=this.values();t=o.next().value;)e=t;return this["delete"](e,this.size-1),e}},GlobalSet.prototype.shift=function(){if(this.size){var t=this.values().next().value;return this["delete"](t,0),t}},Object.defineProperty(GlobalSet.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),GlobalSet.from=function(t){var e=new this;return e.addEach(t),e},Object.addEach(GlobalSet.prototype,GenericCollection.prototype,!1),Object.addEach(GlobalSet.prototype,GenericSet.prototype,!1));var List=require("./_list"),FastSet=require("./_fast-set"),Iterator=require("./iterator");CollectionsSet=function t(e,o,r,n){return t._init(t,this,e,o,r,n)},CollectionsSet._init=function(t,e,o,r,n,i){return e instanceof t?(r=r||Object.equals,n=n||Object.hash,i=i||Function.noop,e.contentEquals=r,e.contentHash=n,e.getDefault=i,e.order=new e.Order((void 0),r),e.store=new e.Store((void 0),function(t,e){return r(t.value,e.value)},function(t){return n(t.value)}),e.length=0,void e.addEach(o)):new t(o,r,n,i)},CollectionsSet.Set=CollectionsSet,CollectionsSet.CollectionsSet=CollectionsSet,Object.addEach(CollectionsSet.prototype,GenericCollection.prototype),Object.addEach(CollectionsSet.prototype,GenericSet.prototype),CollectionsSet.from=GenericCollection.from,Object.defineProperty(CollectionsSet.prototype,"size",GenericCollection._sizePropertyDescriptor),CollectionsSet.prototype.Order=List,CollectionsSet.prototype.Store=FastSet,CollectionsSet.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},CollectionsSet.prototype.has=function(t){var e=new this.order.Node(t);return this.store.has(e)},CollectionsSet.prototype.get=function(t,e){if(e)throw new Error("Set#get does not support second argument: equals");var o=new this.order.Node(t);return o=this.store.get(o),o?o.value:this.getDefault(t)},CollectionsSet.prototype.add=function(t){var e=new this.order.Node(t);if(!this.store.has(e)){this.length;return this.order.add(t),e=this.order.head.prev,this.store.add(e),this.length++,!0}return!1},CollectionsSet.prototype["delete"]=function(t,e){if(e)throw new Error("Set#delete does not support second argument: equals");var o=new this.order.Node(t);return!!this.store.has(o)&&(o=this.store.get(o),this.store["delete"](o),this.order.splice(o,1),this.length--,!0)},CollectionsSet.prototype.pop=function(){if(this.length){var t=this.order.head.prev.value;return this["delete"](t),t}},CollectionsSet.prototype.shift=function(){if(this.length){var t=this.order.head.next.value;return this["delete"](t),t}},CollectionsSet.prototype.one=function(){if(this.length>0)return this.store.one().value},CollectionsSet.prototype.clear=function(){this.store.clear(),this.order.clear(),this.length=0},Object.defineProperty(CollectionsSet.prototype,"_clear",{value:CollectionsSet.prototype.clear}),CollectionsSet.prototype.reduce=function(t,e){var o=arguments[2],r=this.order,n=0;return r.reduce(function(e,r){return t.call(o,e,r,n++,this)},e,this)},CollectionsSet.prototype.reduceRight=function(t,e){var o=arguments[2],r=this.order,n=this.length-1;return r.reduceRight(function(e,r){return t.call(o,e,r,n--,this)},e,this)},CollectionsSet.prototype.iterate=function(){return this.order.iterate()},CollectionsSet.prototype.values=function(){return new Iterator(this.valuesArray(),(!0))},CollectionsSet.prototype.log=function(){var t=this.store;return t.log.apply(t,arguments)},GlobalSet?(GlobalSet.prototype.valuesArray=GenericSet.prototype.valuesArray,GlobalSet.prototype.entriesArray=GenericSet.prototype.entriesArray,module.exports=GlobalSet,GlobalSet.CollectionsSet=CollectionsSet):module.exports=CollectionsSet;