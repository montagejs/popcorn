"use strict";function Deque(t,e){return this instanceof Deque?(this.capacity=this.snap(e),this.init(),this.length=0,this.front=0,void this.addEach(t)):new Deque(t,e)}function deprecatedWarn(t,e){"undefined"!=typeof console&&"function"==typeof console.warn&&e!==!0&&deprecatedWarnNonce.hasOwnProperty(t)===!1&&(console.warn(t),deprecatedWarnNonce[t]++)}function copy(t,e,i,n,h){for(var r=0;r<h;++r)i[r+n]=t[r+e]}function pow2AtLeast(t){return t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t+1}require("./shim-object");var GenericCollection=require("./generic-collection"),GenericOrder=require("./generic-order"),RangeChanges=require("./listen/range-changes");module.exports=Deque,Object.addEach(Deque.prototype,GenericCollection.prototype),Object.addEach(Deque.prototype,GenericOrder.prototype),Object.addEach(Deque.prototype,RangeChanges.prototype),Deque.from=GenericCollection.from,Deque.prototype.maxCapacity=1<<30|0,Deque.prototype.minCapacity=16,Deque.prototype.constructClone=function(t){return new this.constructor(t,this.capacity)},Deque.prototype.add=function(t){this.push(t)},Deque.prototype.push=function(t){var e=arguments.length,i=this.length;if(this.dispatchesRangeChanges){for(var n=new Array(e),h=0;h<e;++h)n[h]=arguments[h];var r=[];this.dispatchBeforeRangeChange(n,r,i)}if(e>1){var s=this.capacity;if(i+e>s)for(var h=0;h<e;++h){this.ensureCapacity(i+1);var a=this.front+i&this.capacity-1;this[a]=arguments[h],i++,this.length=i}else{for(var a=this.front,h=0;h<e;++h)this[a+i&s-1]=arguments[h],a++;this.length=i+e}}else if(1===e){this.ensureCapacity(i+1);var o=this.front+i&this.capacity-1;this[o]=t,this.length=i+1}return this.dispatchesRangeChanges&&this.dispatchRangeChange(n,r,i),this.length},Deque.prototype.pop=function(){var t=this.length;if(0!==t){var e=this.front+t-1&this.capacity-1,i=this[e];return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[i],t-1),this[e]=void 0,this.length=t-1,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[i],t-1),i}},Deque.prototype.shift=function(){if(0!==this.length){var t=this.front,e=this[t];return this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],0),this[t]=void 0,this.front=t+1&this.capacity-1,this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],0),e}},Deque.prototype.unshift=function(t){var e=this.length,i=arguments.length;if(this.dispatchesRangeChanges){for(var n=new Array(i),h=0;h<i;++h)n[h]=arguments[h];var r=[];this.dispatchBeforeRangeChange(n,r,0)}if(i>1){var s=this.capacity;if(e+i>s)for(var h=i-1;h>=0;h--){this.ensureCapacity(e+1);var s=this.capacity,a=(this.front-1&s-1^s)-s;this[a]=arguments[h],e++,this.front=a,this.length=e}else{for(var o=this.front,h=i-1;h>=0;h--){var a=(o-1&s-1^s)-s;this[a]=arguments[h],o=a}this.front=o,this.length=e+i}}else if(1===i){this.ensureCapacity(e+1);var s=this.capacity,a=(this.front-1&s-1^s)-s;this[a]=t,this.length=e+1,this.front=a}return this.dispatchesRangeChanges&&this.dispatchRangeChange(n,r,0),this.length},Deque.prototype.clear=function(){this.length=0,this.front=0,this.init()},Deque.prototype.ensureCapacity=function(t){this.capacity<t&&this.grow(this.snap(1.5*this.capacity+16))},Deque.prototype.grow=function(t){var e=this.front,i=this.capacity,n=new Array(i),h=this.length;if(copy(this,0,n,0,i),this.capacity=t,this.init(),this.front=0,e+h<=i)copy(n,e,this,0,h);else{var r=h-(e+h&i-1);copy(n,e,this,0,r),copy(n,0,this,r,h-r)}},Deque.prototype.init=function(){for(var t=0;t<this.capacity;++t)this[t]="nil"},Deque.prototype.snap=function(t){return"number"!=typeof t?this.minCapacity:pow2AtLeast(Math.min(this.maxCapacity,Math.max(this.minCapacity,t)))},Deque.prototype.one=function(){if(this.length>0)return this[this.front]},Deque.prototype.peek=function(){if(0!==this.length)return this[this.front]},Deque.prototype.poke=function(t){0!==this.length&&(this[this.front]=t)},Deque.prototype.peekBack=function(){var t=this.length;if(0!==t){var e=this.front+t-1&this.capacity-1;return this[e]}},Deque.prototype.pokeBack=function(t){var e=this.length;if(0!==e){var i=this.front+e-1&this.capacity-1;this[i]=t}},Deque.prototype.get=function(t){if(t===(0|t)&&(t<0&&(t+=this.length),!(t<0||t>=this.length)))return this[this.front+t&this.capacity-1]},Deque.prototype.indexOf=function(t,e){null==e&&(e=0),e<0&&(e+=this.length);for(var i=this.capacity-1;e<this.length;e++){var n=this.front+e&i;if(this[n]===t)return e}return-1},Deque.prototype.lastIndexOf=function(t,e){null==e&&(e=this.length-1),e<0&&(e+=this.length);for(var i=this.capacity-1;e>=0;e--){var n=this.front+e&i;if(this[n]===t)return e}return-1};var deprecatedWarnNonce={};Deque.prototype.find=function(){return deprecatedWarn("Deque#find function is deprecated please use Deque#findValue instead."),this.findValue.apply(this,arguments)},Deque.prototype.findValue=function(t,e,i){e=e||Object.equals,null==i&&(i=0),i<0&&(i+=this.length);for(var n=this.capacity-1;i<this.length;i++){var h=this.front+i&n;if(e(t,this[h]))return i}return-1},Deque.prototype.findLast=function(){return deprecatedWarn("Deque#findLast function is deprecated please use Deque#findLastValue instead."),this.findLastValue.apply(this,arguments)},Deque.prototype.findLastValue=function(t,e,i){e=e||Object.equals,null==i&&(i=this.length-1),i<0&&(i+=this.length);for(var n=this.capacity-1;i>=0;i--){var h=this.front+i&n;if(e(t,this[h]))return i}return-1},Deque.prototype.has=function(t,e){e=e||Object.equals;for(var i=this.capacity-1,n=0;n<this.length;n++){var h=this.front+n&i;if(this[h]===t)return!0}return!1},Deque.prototype.reduce=function(t,e){for(var i=arguments[2],n=this.capacity-1,h=0;h<this.length;h++){var r=this.front+h&n;e=t.call(i,e,this[r],h,this)}return e},Deque.prototype.reduceRight=function(t,e){for(var i=arguments[2],n=this.capacity-1,h=this.length-1;h>=0;h--){var r=this.front+h&n;e=t.call(i,e,this[r],h,this)}return e};