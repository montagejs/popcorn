require("../shim");var array_splice=Array.prototype.splice,array_spliceOne=Array.prototype.spliceOne,array_slice=Array.prototype.slice,array_reverse=Array.prototype.reverse,array_sort=Array.prototype.sort,array_swap=Array.prototype.swap,array_push=Array.prototype.push,protoIsSupported={}.__proto__===Object.prototype,array_makeObservable,LENGTH="length";array_makeObservable=protoIsSupported?function(){this.__proto__=ChangeDispatchArray}:function(){Object.defineProperties(this,observableArrayProperties)},Object.defineProperty(Array.prototype,"makeObservable",{value:array_makeObservable,writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Array.prototype,"makePropertyObservable",{value:function(){},writable:!0,configurable:!0,enumerable:!1});var observableArrayProperties={isObservable:{value:!0,writable:!0,configurable:!0},makeObservable:{value:Function.noop,writable:!0,configurable:!0},reverse:{value:function(){var e=this.constructClone(this);return e.reverse(),this.swap(0,this.length,e),this},writable:!0,configurable:!0},sort:{value:function(){var e,r;for(this.dispatchBeforeRangeChange(this,this,0),e=0,r=this.length;e<r;e++)PropertyChanges.dispatchBeforeOwnPropertyChange(this,e,this[e]),this.dispatchBeforeMapChange(e,this[e]);for(array_sort.apply(this,arguments),e=0,r=this.length;e<r;e++)PropertyChanges.dispatchOwnPropertyChange(this,e,this[e]),this.dispatchMapChange(e,this[e]);return this.dispatchRangeChange(this,this,0),this},writable:!0,configurable:!0},_dispatchBeforeOwnPropertyChange:{value:function(e,r){for(var t=e,a=e+r;t<a;t++)PropertyChanges.dispatchBeforeOwnPropertyChange(this,t,this[t]),this.dispatchBeforeMapChange(t,this[t])}},_dispatchOwnPropertyChange:{value:function(e,r){for(var t=e,a=e+r;t<a;t++)this.dispatchOwnPropertyChange(t,this[t]),this.dispatchMapChange(t,this[t])}},swap:{value:function(e,r,t){var a,h,i,s;if(t?Array.isArray(t)||(t=array_slice.call(t)):t=Array.empty,s=t.length,e<0)e=this.length+e;else if(e>this.length){var n=e-this.length,p=Array(n+s);for(h=0,i=n;h<s;h++,i++)h in t&&(p[i]=t[h]);t=p,s=t.length,e=this.length}var o;if(0===r){if(0===s)return[];o=Array.empty}else o=array_slice.call(this,e,e+r);var l=s-o.length,g=this.length,y=Math.max(this.length+l,e+s),c=g>y?g:y;l&&PropertyChanges.dispatchBeforeOwnPropertyChange(this,LENGTH,this.length),this.dispatchBeforeRangeChange(t,o,e),0===l?this._dispatchBeforeOwnPropertyChange(e,s):(a=PropertyChanges.hasOwnPropertyChangeDescriptor(this))&&this._dispatchBeforeOwnPropertyChange(e,c-e),e>g&&(this.length=e);var u=array_swap.call(this,e,r,t);return 0===l?this._dispatchOwnPropertyChange(e,s):a&&this._dispatchOwnPropertyChange(e,c-e),this.dispatchRangeChange(t,o,e),l&&this.dispatchOwnPropertyChange(LENGTH,this.length),u},writable:!0,configurable:!0},splice:{value:function(e,r){return e>this.length&&(e=this.length),this.swap.call(this,e,r,array_slice.call(arguments,2))},writable:!0,configurable:!0},spliceOne:{value:function(e,r){var t,a,h,i,s,n=this.length,p=arguments.length;1===p?(PropertyChanges.dispatchBeforeOwnPropertyChange(this,LENGTH,this.length),h=this.length-1,t=Array.empty):(t=[r],h=this.length),a=[this[e]],i=n>h?n:h,this.dispatchBeforeRangeChange(t,a,e),2===p?this._dispatchBeforeOwnPropertyChange(e,1):(s=PropertyChanges.hasOwnPropertyChangeDescriptor(this))&&this._dispatchBeforeOwnPropertyChange(e,i-e),1===p?array_spliceOne.call(this,e):array_spliceOne.call(this,e,r),2===p?this._dispatchOwnPropertyChange(e,1):s&&this._dispatchOwnPropertyChange(e,i-e),this.dispatchRangeChange(t,a,e),1===p&&this.dispatchOwnPropertyChange(LENGTH,this.length)},writable:!0,configurable:!0},_setSwapBuffer:{get:function(){return this.__setSwapBuffer||Object.defineProperty(this,"__setSwapBuffer",{value:[],writable:!0,configurable:!0,enumerable:!1}).__setSwapBuffer},enumerable:!1},set:{value:function(e,r){var t,a,h,i,s=void 0!==typeof r,n=s?[]:Array.empty;return e>=this.length?(n[e-this.length]=r,t=e+1-this.length,h=this.length):(n[0]=r,t=0,h=e),a=0===t?[this[e]]:Array.empty,t>0&&PropertyChanges.dispatchBeforeOwnPropertyChange(this,LENGTH,this.length),this.dispatchBeforeRangeChange(n,a,h),0===t?this._dispatchBeforeOwnPropertyChange(h,1):(i=PropertyChanges.hasOwnPropertyChangeDescriptor(this))&&this._dispatchBeforeOwnPropertyChange(h,t),this[e]=r,0===t?this._dispatchOwnPropertyChange(h,1):i&&this._dispatchOwnPropertyChange(h,t),this.dispatchRangeChange(n,a,h),t&&this.dispatchOwnPropertyChange(LENGTH,this.length),!0},writable:!0,configurable:!0},shift:{value:function(){return this.splice(0,1)[0]},writable:!0,configurable:!0},pop:{value:function(){if(this.length)return this.splice(this.length-1,1)[0]},writable:!0,configurable:!0},push:{value:function(e){var r,t,a=this.length,h=arguments.length;r=1===h?[arguments[0]]:Array.apply(null,arguments),h>0&&(PropertyChanges.dispatchBeforeOwnPropertyChange(this,LENGTH,a),this.dispatchBeforeRangeChange(r,Array.empty,a),(t=PropertyChanges.hasOwnPropertyChangeDescriptor(this))&&this._dispatchBeforeOwnPropertyChange(a,h)),array_push.apply(this,arguments),h>0&&(t&&this._dispatchOwnPropertyChange(a,h),this.dispatchRangeChange(r,Array.empty,a),this.dispatchOwnPropertyChange(LENGTH,this.length))},writable:!0,configurable:!0},unshift:{value:function(e){if(1===arguments.length)return this.splice(0,0,e);var r=array_slice.call(arguments);return this.swap(0,0,r)},writable:!0,configurable:!0},clear:{value:function(){return this.splice(0,this.length)},writable:!0,configurable:!0}},ChangeDispatchArray=Object.create(Array.prototype,observableArrayProperties);exports.observableArrayProperties=observableArrayProperties;var PropertyChanges=require("./property-changes"),RangeChanges=require("./range-changes"),MapChanges=require("./map-changes");Object.defineEach(Array.prototype,PropertyChanges.prototype,!1,!0,!1,!0),Object.defineEach(Array.prototype,RangeChanges.prototype,!1,!0,!1,!0),Object.defineEach(Array.prototype,MapChanges.prototype,!1,!0,!1,!0);