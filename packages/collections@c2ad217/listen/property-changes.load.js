montageDefine("c2ad217","listen/property-changes",{dependencies:["../shim","../_map","../weak-map","./change-descriptor"],factory:function(e,r,t){function n(){throw new Error("This is an abstract interface. Mix it. Don't construct it")}function i(e,r,t,n){if(e&&e._current){var i,o,a,s,c,h=e.specificHandlerMethodName,l=e.genericHandlerMethodName,g=p;if(Array.isArray(e._current)){for(i=e.removeCurrentGostListenersIfNeeded(),a=0,s=i.length;a<s;a++)if((c=i[a])!==g){if(o=c[h]||c[l]||c,!o.call)throw new Error("No event listener for "+e.specificHandlerName+" or "+e.genericHandlerName+" or call on "+o);o.call(c,t,r,n)}}else{if(c=e._current,o=c[h]||c[l]||c,!o.call)throw new Error("No event listener for "+e.specificHandlerName+" or "+e.genericHandlerName+" or call on "+o);o.call(c,t,r,n)}}}Object.prototype.hasOwnProperty;t.exports=n,e("../shim");var o=e("../_map"),a=e("../weak-map"),s=e("./change-descriptor"),c=s.ObjectChangeDescriptor,p=s.ListenerGhost;n.debug=!0;var h=new a,l=new o;n.ObjectChangeDescriptor=function(){},n.prototype.getOwnPropertyChangeDescriptor=function(e){var r,t=h.get(this);if(t||(t=Object.create(null),h.set(this,t)),void 0===(r=t[e])){var n=l.get(e);return n||(n=String(e),n=n&&n[0].toUpperCase()+n.slice(1),l.set(e,n)),t[e]=new c(n)}return r},n.prototype.hasOwnPropertyChangeDescriptor=function(e){var r=h.get(this);return!!r&&(!e||void 0!==r[e])},n.prototype.addOwnPropertyChangeListener=function(e,r,t){this.makeObservable&&!this.isObservable&&this.makeObservable();var i=n.getOwnPropertyChangeDescriptor(this,e),o=t?i.willChangeListeners:i.changeListeners;n.makePropertyObservable(this,e),o._current?Array.isArray(o._current)?o._current.push(r):o._current=[o._current,r]:o._current=r;var a=this;return function(){n.removeOwnPropertyChangeListener(a,e,r,t),a=null}},n.prototype.addBeforeOwnPropertyChangeListener=function(e,r){return n.addOwnPropertyChangeListener(this,e,r,!0)},n.prototype.removeOwnPropertyChangeListener=function d(e,r,t){var i,o=n.getOwnPropertyChangeDescriptor(this,e);if(i=t?o._willChangeListeners:o._changeListeners,i&&i._current)if(i._current===r)i._current=null;else{var a=i._current.lastIndexOf(r);if(a===-1)throw new Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(e));o.isActive?(i.ghostCount=i.ghostCount+1,i._current[a]=d.ListenerGhost):i._current.spliceOne(a)}},n.prototype.removeOwnPropertyChangeListener.ListenerGhost=p,n.prototype.removeBeforeOwnPropertyChangeListener=function(e,r){return n.removeOwnPropertyChangeListener(this,e,r,!0)},n.prototype.dispatchOwnPropertyChange=function u(e,r,t){var i,o=n.getOwnPropertyChangeDescriptor(this,e);if(!o.isActive){o.isActive=!0,i=t?o._willChangeListeners:o._changeListeners;try{u.dispatchEach(i,e,r,this)}finally{o.isActive=!1}}},n.prototype.dispatchOwnPropertyChange.dispatchEach=i,i.ListenerGhost=p,n.prototype.dispatchBeforeOwnPropertyChange=function(e,r){return n.dispatchOwnPropertyChange(this,e,r,!0)};var g=new a,y=(new a,{get:void 0,set:void 0,configurable:!0,enumerable:!1});n.prototype.makePropertyObservable=function(e){var r=g.get(this);if(!r||void 0===r.get(e)){if(!r){if(Array.isArray(this))return;if(!Object.isExtensible(this))throw new Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");r=new o,g.set(this,r)}var t,n=this;do{if(t=Object.getOwnPropertyDescriptor(n,e))break;n=Object.getPrototypeOf(n)}while(n);if(t){if(!t.configurable)return;if(!t.writable&&!t.set)return}else t={value:void 0,enumerable:!0,writable:!0,configurable:!0};r.set(e,t),"value"in t?(y.get=function a(){return a.overriddenDescriptor.value},y.set=function s(e){var r,t,n=s.overriddenDescriptor;if(e!==n.value){if(!(t=(r=s.descriptor).isActive)){r.isActive=!0;try{s.dispatchEach(r._willChangeListeners,s.key,n.value,this)}finally{}}if(n.value=e,!t)try{s.dispatchEach(r._changeListeners,s.key,e,this)}finally{r.isActive=!1}}},y.set.dispatchEach=i,y.set.key=e,y.get.overriddenDescriptor=y.set.overriddenDescriptor=t,y.set.descriptor=h.get(this)[e],y.enumerable=t.enumerable,y.configurable=!0):(y.get=t.get,y.set=function c(){var r,t,n,i=c.overriddenGetter.call(this);if(1===arguments.length?c.overriddenSetter.call(this,arguments[0]):2===arguments.length?c.overriddenSetter.call(this,arguments[0],arguments[1]):c.overriddenSetter.apply(this,arguments),(n=c.overriddenGetter.call(this))!==i){if(r=c.descriptor,!(t=r.isActive)){r.isActive=!0;try{c.dispatchEach(r._willChangeListeners,e,i,this)}finally{}}if(!t)try{c.dispatchEach(r._changeListeners,e,n,this)}finally{r.isActive=!1}}},y.enumerable=t.enumerable,y.configurable=!0,y.set.dispatchEach=i,y.set.overriddenSetter=t.set,y.set.overriddenGetter=t.get,y.set.descriptor=h.get(this)[e]),Object.defineProperty(this,e,y)}},n.getOwnPropertyChangeDescriptor=function(e,r){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(r):n.prototype.getOwnPropertyChangeDescriptor.call(e,r)},n.hasOwnPropertyChangeDescriptor=function(e,r){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(r):n.prototype.hasOwnPropertyChangeDescriptor.call(e,r)},n.addOwnPropertyChangeListener=function(e,r,t,n){if(Object.isObject(e))return e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(r,t,n):this.prototype.addOwnPropertyChangeListener.call(e,r,t,n)},n.removeOwnPropertyChangeListener=function(e,r,t,i){if(Object.isObject(e))return e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(r,t,i):n.prototype.removeOwnPropertyChangeListener.call(e,r,t,i)},n.dispatchOwnPropertyChange=function(e,r,t,i){if(Object.isObject(e))return e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(r,t,i):n.prototype.dispatchOwnPropertyChange.call(e,r,t,i)},n.addBeforeOwnPropertyChangeListener=function(e,r,t){return n.addOwnPropertyChangeListener(e,r,t,!0)},n.removeBeforeOwnPropertyChangeListener=function(e,r,t){return n.removeOwnPropertyChangeListener(e,r,t,!0)},n.dispatchBeforeOwnPropertyChange=function(e,r,t){return n.dispatchOwnPropertyChange(e,r,t,!0)},n.makePropertyObservable=function(e,r){return e.makePropertyObservable?e.makePropertyObservable(r):n.prototype.makePropertyObservable.call(e,r)}}});