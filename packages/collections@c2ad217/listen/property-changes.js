function PropertyChanges(){throw new Error("This is an abstract interface. Mix it. Don't construct it")}function dispatchEach(e,r,t,n){if(e&&e._current){var s,o,i,a,p,h=e.specificHandlerMethodName,c=e.genericHandlerMethodName,y=ListenerGhost;if(Array.isArray(e._current)){for(s=e.removeCurrentGostListenersIfNeeded(),i=0,a=s.length;i<a;i++)if((p=s[i])!==y){if(o=p[h]||p[c]||p,!o.call)throw new Error("No event listener for "+e.specificHandlerName+" or "+e.genericHandlerName+" or call on "+o);o.call(p,t,r,n)}}else{if(p=e._current,o=p[h]||p[c]||p,!o.call)throw new Error("No event listener for "+e.specificHandlerName+" or "+e.genericHandlerName+" or call on "+o);o.call(p,t,r,n)}}}var objectHasOwnProperty=Object.prototype.hasOwnProperty;module.exports=PropertyChanges,require("../shim");var Map=require("../_map"),WeakMap=require("../weak-map"),ChangeDescriptor=require("./change-descriptor"),ObjectChangeDescriptor=ChangeDescriptor.ObjectChangeDescriptor,ListenerGhost=ChangeDescriptor.ListenerGhost;PropertyChanges.debug=!0;var ObjectsPropertyChangeListeners=new WeakMap,ObjectChangeDescriptorName=new Map;PropertyChanges.ObjectChangeDescriptor=function(){},PropertyChanges.prototype.getOwnPropertyChangeDescriptor=function(e){var r,t=ObjectsPropertyChangeListeners.get(this);if(t||(t=Object.create(null),ObjectsPropertyChangeListeners.set(this,t)),void 0===(r=t[e])){var n=ObjectChangeDescriptorName.get(e);return n||(n=String(e),n=n&&n[0].toUpperCase()+n.slice(1),ObjectChangeDescriptorName.set(e,n)),t[e]=new ObjectChangeDescriptor(n)}return r},PropertyChanges.prototype.hasOwnPropertyChangeDescriptor=function(e){var r=ObjectsPropertyChangeListeners.get(this);return!!r&&(!e||void 0!==r[e])},PropertyChanges.prototype.addOwnPropertyChangeListener=function(e,r,t){this.makeObservable&&!this.isObservable&&this.makeObservable();var n=PropertyChanges.getOwnPropertyChangeDescriptor(this,e),s=t?n.willChangeListeners:n.changeListeners;PropertyChanges.makePropertyObservable(this,e),s._current?Array.isArray(s._current)?s._current.push(r):s._current=[s._current,r]:s._current=r;var o=this;return function(){PropertyChanges.removeOwnPropertyChangeListener(o,e,r,t),o=null}},PropertyChanges.prototype.addBeforeOwnPropertyChangeListener=function(e,r){return PropertyChanges.addOwnPropertyChangeListener(this,e,r,!0)},PropertyChanges.prototype.removeOwnPropertyChangeListener=function e(r,t,n){var s,o=PropertyChanges.getOwnPropertyChangeDescriptor(this,r);if(s=n?o._willChangeListeners:o._changeListeners,s&&s._current)if(s._current===t)s._current=null;else{var i=s._current.lastIndexOf(t);if(i===-1)throw new Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(r));o.isActive?(s.ghostCount=s.ghostCount+1,s._current[i]=e.ListenerGhost):s._current.spliceOne(i)}},PropertyChanges.prototype.removeOwnPropertyChangeListener.ListenerGhost=ListenerGhost,PropertyChanges.prototype.removeBeforeOwnPropertyChangeListener=function(e,r){return PropertyChanges.removeOwnPropertyChangeListener(this,e,r,!0)},PropertyChanges.prototype.dispatchOwnPropertyChange=function r(e,t,n){var s,o=PropertyChanges.getOwnPropertyChangeDescriptor(this,e);if(!o.isActive){o.isActive=!0,s=n?o._willChangeListeners:o._changeListeners;try{r.dispatchEach(s,e,t,this)}finally{o.isActive=!1}}},PropertyChanges.prototype.dispatchOwnPropertyChange.dispatchEach=dispatchEach,dispatchEach.ListenerGhost=ListenerGhost,PropertyChanges.prototype.dispatchBeforeOwnPropertyChange=function(e,r){return PropertyChanges.dispatchOwnPropertyChange(this,e,r,!0)};var ObjectsOverriddenPropertyDescriptors=new WeakMap,Objects__state__=new WeakMap,propertyListener={get:void 0,set:void 0,configurable:!0,enumerable:!1};PropertyChanges.prototype.makePropertyObservable=function(e){var r=ObjectsOverriddenPropertyDescriptors.get(this);if(!r||void 0===r.get(e)){if(!r){if(Array.isArray(this))return;if(!Object.isExtensible(this))throw new Error("Can't make property "+JSON.stringify(e)+" observable on "+this+" because object is not extensible");r=new Map,ObjectsOverriddenPropertyDescriptors.set(this,r)}var t,n=this;do{if(t=Object.getOwnPropertyDescriptor(n,e))break;n=Object.getPrototypeOf(n)}while(n);if(t){if(!t.configurable)return;if(!t.writable&&!t.set)return}else t={value:void 0,enumerable:!0,writable:!0,configurable:!0};r.set(e,t),"value"in t?(propertyListener.get=function s(){return s.overriddenDescriptor.value},propertyListener.set=function o(e){var r,t,n=o.overriddenDescriptor;if(e!==n.value){if(!(t=(r=o.descriptor).isActive)){r.isActive=!0;try{o.dispatchEach(r._willChangeListeners,o.key,n.value,this)}finally{}}if(n.value=e,!t)try{o.dispatchEach(r._changeListeners,o.key,e,this)}finally{r.isActive=!1}}},propertyListener.set.dispatchEach=dispatchEach,propertyListener.set.key=e,propertyListener.get.overriddenDescriptor=propertyListener.set.overriddenDescriptor=t,propertyListener.set.descriptor=ObjectsPropertyChangeListeners.get(this)[e],propertyListener.enumerable=t.enumerable,propertyListener.configurable=!0):(propertyListener.get=t.get,propertyListener.set=function i(){var r,t,n,s=i.overriddenGetter.call(this);if(1===arguments.length?i.overriddenSetter.call(this,arguments[0]):2===arguments.length?i.overriddenSetter.call(this,arguments[0],arguments[1]):i.overriddenSetter.apply(this,arguments),(n=i.overriddenGetter.call(this))!==s){if(r=i.descriptor,!(t=r.isActive)){r.isActive=!0;try{i.dispatchEach(r._willChangeListeners,e,s,this)}finally{}}if(!t)try{i.dispatchEach(r._changeListeners,e,n,this)}finally{r.isActive=!1}}},propertyListener.enumerable=t.enumerable,propertyListener.configurable=!0,propertyListener.set.dispatchEach=dispatchEach,propertyListener.set.overriddenSetter=t.set,propertyListener.set.overriddenGetter=t.get,propertyListener.set.descriptor=ObjectsPropertyChangeListeners.get(this)[e]),Object.defineProperty(this,e,propertyListener)}},PropertyChanges.getOwnPropertyChangeDescriptor=function(e,r){return e.getOwnPropertyChangeDescriptor?e.getOwnPropertyChangeDescriptor(r):PropertyChanges.prototype.getOwnPropertyChangeDescriptor.call(e,r)},PropertyChanges.hasOwnPropertyChangeDescriptor=function(e,r){return e.hasOwnPropertyChangeDescriptor?e.hasOwnPropertyChangeDescriptor(r):PropertyChanges.prototype.hasOwnPropertyChangeDescriptor.call(e,r)},PropertyChanges.addOwnPropertyChangeListener=function(e,r,t,n){if(Object.isObject(e))return e.addOwnPropertyChangeListener?e.addOwnPropertyChangeListener(r,t,n):this.prototype.addOwnPropertyChangeListener.call(e,r,t,n)},PropertyChanges.removeOwnPropertyChangeListener=function(e,r,t,n){if(Object.isObject(e))return e.removeOwnPropertyChangeListener?e.removeOwnPropertyChangeListener(r,t,n):PropertyChanges.prototype.removeOwnPropertyChangeListener.call(e,r,t,n)},PropertyChanges.dispatchOwnPropertyChange=function(e,r,t,n){if(Object.isObject(e))return e.dispatchOwnPropertyChange?e.dispatchOwnPropertyChange(r,t,n):PropertyChanges.prototype.dispatchOwnPropertyChange.call(e,r,t,n)},PropertyChanges.addBeforeOwnPropertyChangeListener=function(e,r,t){return PropertyChanges.addOwnPropertyChangeListener(e,r,t,!0)},PropertyChanges.removeBeforeOwnPropertyChangeListener=function(e,r,t){return PropertyChanges.removeOwnPropertyChangeListener(e,r,t,!0)},PropertyChanges.dispatchBeforeOwnPropertyChange=function(e,r,t){return PropertyChanges.dispatchOwnPropertyChange(e,r,t,!0)},PropertyChanges.makePropertyObservable=function(e,r){return e.makePropertyObservable?e.makePropertyObservable(r):PropertyChanges.prototype.makePropertyObservable.call(e,r)};