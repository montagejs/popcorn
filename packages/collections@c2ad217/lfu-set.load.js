montageDefine("c2ad217","lfu-set",{dependencies:["./shim","./set","./generic-collection","./generic-set","./listen/property-changes","./listen/range-changes"],factory:function(e,t,n){"use strict";function r(e,t,n,s,i){return this instanceof r?(t=t||1/0,n=n||Object.equals,s=s||Object.hash,i=i||Function.noop,this.store=new o((void 0),function(e,t){return n(e.value,t.value)},function(e){return s(e.value)}),this.frequencyHead=new this.FrequencyNode(0),this.contentEquals=n,this.contentHash=s,this.getDefault=i,this.capacity=t,this.length=0,void this.addEach(e)):new r(e,t,n,s,i)}function s(e,t){this.value=e,this.frequencyNode=t}function i(e,t,n){this.frequency=e,this.values=new o,this.prev=t||this,this.next=n||this,t&&(t.next=this),n&&(n.prev=this)}var o=(e("./shim"),e("./set").CollectionsSet),h=e("./generic-collection"),a=e("./generic-set"),u=e("./listen/property-changes"),c=e("./listen/range-changes");n.exports=r,r.LfuSet=r,Object.addEach(r.prototype,h.prototype),Object.addEach(r.prototype,a.prototype),Object.addEach(r.prototype,u.prototype),Object.addEach(r.prototype,c.prototype),Object.defineProperty(r.prototype,"size",h._sizePropertyDescriptor),r.from=h.from,r.prototype.constructClone=function(e){return new this.constructor(e,this.capacity,this.contentEquals,this.contentHash,this.getDefault)},r.prototype.has=function(e){return this.store.has(new this.Node(e))},r.prototype.get=function(e,t){if(t)throw new Error("LfuSet#get does not support second argument: equals");var n=this.store.get(new this.Node(e));if(void 0!==n){var r=n.frequencyNode,s=r.next;return s.frequency!==r.frequency+1&&(s=new this.FrequencyNode(r.frequency+1,r,s)),s.values.add(n),n.frequencyNode=s,r.values["delete"](n),0===r.values.length&&(r.prev.next=r.next,r.next.prev=r.prev),n.value}return this.getDefault(e)},r.prototype.add=function(e){if(this.has(e))return this.get(e),!1;var t,n,r=[],s=[];if(this.capacity>0){r.push(e),this.length+1>this.capacity&&(t=this.frequencyHead.next,n=t.values.order.head.next.value,s.push(n.value)),this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange(r,s,0),s.length>0&&(this.store["delete"](n),t.values["delete"](n),1!==t.value&&0===t.values.length&&(this.frequencyHead.next=t.next,t.next.prev=this.frequencyHead));var i=new this.Node(e),o=this.frequencyHead.next;1!==o.frequency&&(o=new this.FrequencyNode(1,this.frequencyHead,o)),this.store.add(i),o.values.add(i),i.frequencyNode=o,this.length=this.length+r.length-s.length,this.dispatchesRangeChanges&&this.dispatchRangeChange(r,s,0)}return r.length!==s.length},r.prototype["delete"]=function(e,t){if(t)throw new Error("LfuSet#delete does not support second argument: equals");var n=this.store.get(new this.Node(e)),r=!!n;if(r){this.dispatchesRangeChanges&&this.dispatchBeforeRangeChange([],[e],0);var s=n.frequencyNode;this.store["delete"](n),s.values["delete"](n),0===s.values.length&&(s.prev.next=s.next,s.next.prev=s.prev),this.length--,this.dispatchesRangeChanges&&this.dispatchRangeChange([],[e],0)}return r},r.prototype.one=function(){if(this.length>0)return this.frequencyHead.next.values.one().value},r.prototype.clear=function(){this.store.clear(),this.frequencyHead.next=this.frequencyHead,this.length=0},r.prototype.reduce=function(e,t){for(var n=arguments[2],r=0,s=this.frequencyHead.next;0!==s.frequency;){var i=s.values;t=i.reduce(function(t,s){return e.call(n,t,s.value,r++,this)},t,this),s=s.next}return t},r.prototype.reduceRight=function(e,t){for(var n=arguments[2],r=this.length-1,s=this.frequencyHead.prev;0!==s.frequency;){var i=s.values;t=i.reduceRight(function(t,s){return e.call(n,t,s.value,r--,this)},t,this),s=s.prev}return t},r.prototype.iterate=function(){return this.store.map(function(e){return e.value}).iterate()},r.prototype.Node=s,r.prototype.FrequencyNode=i}});