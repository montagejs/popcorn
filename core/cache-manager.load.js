montageDefine("0e99770","core/cache-manager",{dependencies:["./service-worker"],factory:function(e,t,a){var r=e("./service-worker").ServiceWorker,n={supportServiceWorker:!!window.applicationCache,hasCacheManifest:!!document.querySelector("html").getAttribute("manifest"),cacheStaleEvents:["checking","progress","updating","cached","noUpdate","updateReady"],appCache:window.applicationCache,appUpdateTimer:null,options:{reloadOnUpdateReady:!1,confirmOnUpdateReady:!0,offlineWorkerScope:location.pathname,offlineWorkerFile:"cache-worker.js",updateCheckInterval:9e5,updateRetryInterval:18e5},events:{},lastEventType:null,emit:function(e,t){var a=this,r=(t&&t.currentTarget!==a.appCache,a.options),n=a.events;"function"==typeof n[e]&&n[e](t),"updateReady"!==a.lastEventType&&"updateReady"===e&&(r.confirmOnUpdateReady?window.confirm("A new version is available. Install now!")&&window.location.reload():r.reloadOnUpdateReady&&window.location.reload()),a.lastEventType=e},isAppCacheStale:function(){var e=this,t=e.hasCacheManifest,a=e.appCache;return t&&a&&(a.status===a.UPDATEREADY||a.status===a.CHECKING||a.status===a.DOWNLOADING)},getCacheWorker:function(){var e=this.options;return r.getWorkerRegistration(e.offlineWorkerFile,{scope:e.offlineWorkerScope})},listenToUpdate:function(){var e=this,t=e.options,a=e.hasCacheManifest,n=e.appCache;t.updateCheckInterval&&(clearTimeout(e.appUpdateTimer),e.appUpdateTimer=setTimeout(function i(){e.checkForUpdate(),t.updateRetryInterval&&(clearTimeout(e.appUpdateTimer),e.appUpdateTimer=setTimeout(i,t.updateRetryInterval))},t.updateCheckInterval)),r.supportServiceWorker&&a&&e.getCacheWorker().then(function(t){return r.getServiceWorker().then(function(a){a.addEventListener("message",function(a){if(a.source&&t.active&&a.source.scriptURL===t.active.scriptURL){var r=a.data;"error"===r?e.emit("error",a):e.cacheStaleEvents.indexOf(r)!==-1&&e.isAppCacheStale()===!1&&e.emit(r,a)}})})},e.emit.bind(e,"error")),n&&(n.status===n.UPDATEREADY?e.emit("updateReady",event):n.status===n.DOWNLOADING&&e.emit("downloading",event),n.addEventListener("cached",e.emit.bind(e,"cached"),!1),n.addEventListener("checking",e.emit.bind(e,"checking"),!1),n.addEventListener("downloading",e.emit.bind(e,"downloading"),!1),n.addEventListener("error",e.emit.bind(e,"error"),!1),n.addEventListener("noupdate",e.emit.bind(e,"noUpdate"),!1),n.addEventListener("obsolete",e.emit.bind(e,"error"),!1),n.addEventListener("progress",e.emit.bind(e,"progress"),!1),n.addEventListener("updateready",function(t){n.status===n.UPDATEREADY&&e.emit("updateReady",t)},!1))},checkForUpdate:function(){var e=this,t=e.hasCacheManifest,a=e.appCache;try{r.supportServiceWorker&&t&&e.getCacheWorker().then(function(e){return r.sendWorkerMsg(e,"Update")}),t&&a&&a.update&&a.status!==a.UNCACHED&&a.status!==a.UPDATEREADY&&a.status!==a.CHECKING&&a.status!==a.DOWNLOADING&&a.update()}catch(n){e.emit("error",n)}},clearCache:function(){var e=this,t=e.hasCacheManifest,a=e.appCache;try{e.emit("progress"),r.supportServiceWorker&&e.getCacheWorker().then(function(e){return r.sendWorkerMsg(e,"CacheClear")["finally"](function(){return e.unregister()})}),t&&a&&a.abort&&a.status!==a.UNCACHED&&a.abort(),e.emit("uncached")}catch(n){e.emit("error",n)}}};t.CacheManager=n,window.checkForUpdate=n.checkForUpdate.bind(n),window.clearCache=n.clearCache.bind(n),t.eventCache=n.events,t.listenToUpdate=n.listenToUpdate.bind(n),t.clearCache=n.clearCache.bind(n),t.checkForUpdate=n.checkForUpdate.bind(n)}});